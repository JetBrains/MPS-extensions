package com.mbeddr.mpsutil.blutil.migration;

/*Generated by MPS */

import jetbrains.mps.lang.migration.runtime.base.MigrationScriptBase;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.module.SModule;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.migration.runtime.base.MigrationScriptReference;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.smodel.ModelImports;
import de.slisson.mps.richtext.behavior.Text__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class BLDocToJavaDoc extends MigrationScriptBase {
  private final String description = "BLDocToJavaDoc";
  public String getCaption() {
    return description;
  }
  @Override
  public boolean isRerunnable() {
    return true;
  }
  public SNode execute(final SModule m) {
    doExecute(m);
    return null;
  }
  public void doExecute(final SModule m) {
    Iterable<SModel> models = m.getModels();
    for (SModel model : models) {
      ListSequence.fromList(SModelOperations.nodes(model, CONCEPTS.BLDoc$UI)).where((it) -> {
        return !(TestCaseDetection.isInMigrationTestCase(it)) && ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(it, LINKS.text$Lu49), LINKS.words$C8QZ)).all(new _FunctionTypes._return_P1_E0<Boolean, SNode>() {
          public Boolean invoke(SNode it) {
            return SNodeOperations.isInstanceOf(it, CONCEPTS.Word$5r);
          }
        });
      }).visitAll((it) -> replaceNode(it));
    }
  }
  public MigrationScriptReference getReference() {
    return new MigrationScriptReference(MetaAdapterFactory.getLanguage(0x63e0e5665131447eL, 0x90e312ea330e1a00L, "com.mbeddr.mpsutil.blutil"), 2);
  }

  /*package*/ void replaceNode(SNode node) {
    new ModelImports(SNodeOperations.getModel(node)).addUsedLanguage(MetaAdapterFactory.getLanguage(0xf280165065d5424eL, 0xbb1b463a8781b786L, "jetbrains.mps.baseLanguage.javadoc"));

    SNode nodeWithAnnotation = SNodeOperations.getParent(node);
    Iterable<String> lines = Text__BehaviorDescriptor.getTextLines_id7T88Na6$wwy.invoke(SLinkOperations.getTarget(node, LINKS.text$Lu49));

    {
      final SNode declaration = nodeWithAnnotation;
      if (SNodeOperations.isInstanceOf(declaration, CONCEPTS.StaticFieldDeclaration$jR)) {
        SNodeOperations.deleteNode(node);
        new IAttributeDescriptor.NodeAttribute(CONCEPTS.FieldDocComment$wl).set(declaration, createFieldDocComment_ra7ppi_a0a1a5a8(createComments(lines)));
        return;
      }
    }

    {
      final SNode declaration = nodeWithAnnotation;
      if (SNodeOperations.isInstanceOf(declaration, CONCEPTS.FieldDeclaration$ie)) {
        SNodeOperations.deleteNode(node);
        new IAttributeDescriptor.NodeAttribute(CONCEPTS.FieldDocComment$wl).set(declaration, createFieldDocComment_ra7ppi_a0a1a7a8(createComments(lines)));
        return;
      }
    }


    {
      final SNode classifier = nodeWithAnnotation;
      if (SNodeOperations.isInstanceOf(classifier, CONCEPTS.Classifier$Ix)) {
        SNodeOperations.deleteNode(node);
        new IAttributeDescriptor.NodeAttribute(CONCEPTS.ClassifierDocComment$mh).set(classifier, createClassifierDocComment_ra7ppi_a0a1a01a8(createComments(lines)));
        return;
      }
    }
  }

  /*package*/ Iterable<SNode> createComments(Iterable<String> lines) {
    return Sequence.fromIterable(lines).select((it) -> createCommentLine_ra7ppi_a0a0a0a0k(it));
  }

  private static SNode createFieldDocComment_ra7ppi_a0a1a5a8(Iterable<? extends SNode> p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.FieldDocComment$wl);
    n0.forChild(LINKS.body$OAGp).initNodeList(p0, CONCEPTS.CommentLine$hJ);
    return n0.getResult();
  }
  private static SNode createFieldDocComment_ra7ppi_a0a1a7a8(Iterable<? extends SNode> p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.FieldDocComment$wl);
    n0.forChild(LINKS.body$OAGp).initNodeList(p0, CONCEPTS.CommentLine$hJ);
    return n0.getResult();
  }
  private static SNode createClassifierDocComment_ra7ppi_a0a1a01a8(Iterable<? extends SNode> p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ClassifierDocComment$mh);
    n0.forChild(LINKS.body$OAGp).initNodeList(p0, CONCEPTS.CommentLine$hJ);
    return n0.getResult();
  }
  private static SNode createCommentLine_ra7ppi_a0a0a0a0k(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.CommentLine$hJ);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.part$QuzQ).init(CONCEPTS.TextCommentLinePart$Eb);
      n1.setProperty(PROPS.text$aOLd, p0);
    }
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept BLDoc$UI = MetaAdapterFactory.getConcept(0x63e0e5665131447eL, 0x90e312ea330e1a00L, 0x3342faffb9e8d4deL, "com.mbeddr.mpsutil.blutil.structure.BLDoc");
    /*package*/ static final SConcept Word$5r = MetaAdapterFactory.getConcept(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9f2e0cL, "de.slisson.mps.richtext.structure.Word");
    /*package*/ static final SConcept StaticFieldDeclaration$jR = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf93c84351fL, "jetbrains.mps.baseLanguage.structure.StaticFieldDeclaration");
    /*package*/ static final SConcept FieldDocComment$wl = MetaAdapterFactory.getConcept(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x5ed0d79d7dc44bf2L, "jetbrains.mps.baseLanguage.javadoc.structure.FieldDocComment");
    /*package*/ static final SConcept FieldDeclaration$ie = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c108ca68L, "jetbrains.mps.baseLanguage.structure.FieldDeclaration");
    /*package*/ static final SConcept Classifier$Ix = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x101d9d3ca30L, "jetbrains.mps.baseLanguage.structure.Classifier");
    /*package*/ static final SConcept ClassifierDocComment$mh = MetaAdapterFactory.getConcept(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x1cb65d9fe66a764cL, "jetbrains.mps.baseLanguage.javadoc.structure.ClassifierDocComment");
    /*package*/ static final SConcept CommentLine$hJ = MetaAdapterFactory.getConcept(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x757ba20a4c87f96cL, "jetbrains.mps.baseLanguage.javadoc.structure.CommentLine");
    /*package*/ static final SConcept TextCommentLinePart$Eb = MetaAdapterFactory.getConcept(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x7c7f5b2f31990287L, "jetbrains.mps.baseLanguage.javadoc.structure.TextCommentLinePart");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink text$Lu49 = MetaAdapterFactory.getContainmentLink(0x63e0e5665131447eL, 0x90e312ea330e1a00L, 0x3342faffb9e8d4deL, 0x3342faffb9e8d4dfL, "text");
    /*package*/ static final SContainmentLink words$C8QZ = MetaAdapterFactory.getContainmentLink(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9e4e61L, 0x237c8da86a9e7aeeL, "words");
    /*package*/ static final SContainmentLink body$OAGp = MetaAdapterFactory.getContainmentLink(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x4a3c146b7fae70d3L, 0x757ba20a4c87f96eL, "body");
    /*package*/ static final SContainmentLink part$QuzQ = MetaAdapterFactory.getContainmentLink(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x757ba20a4c87f96cL, 0x7c7f5b2f3199028dL, "part");
  }

  private static final class PROPS {
    /*package*/ static final SProperty text$aOLd = MetaAdapterFactory.getProperty(0xf280165065d5424eL, 0xbb1b463a8781b786L, 0x7c7f5b2f31990287L, 0x7c7f5b2f31990288L, "text");
  }
}
