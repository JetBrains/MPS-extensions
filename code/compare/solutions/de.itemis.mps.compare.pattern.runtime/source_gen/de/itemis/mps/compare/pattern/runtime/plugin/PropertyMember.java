package de.itemis.mps.compare.pattern.runtime.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class PropertyMember extends PatternBuilderInitPart<Object> {

  protected SNode property;

  public PropertyMember(SNode property, Expression<Object> inner, String annotation, boolean negated) {
    super(inner, annotation, negated);
    this.property = property;
  }

  public PropertyMember(SNode property, Expression<Object> inner, String annotation) {
    this(property, inner, annotation, false);
  }

  public PropertyMember(SNode property, Expression<Object> inner) {
    this(property, inner, null);
  }

  @Override
  public String toString() {
    return SPropertyOperations.getString(this.property, PROPS.name$MnvL) + "@" + this.annotation + " = " + this.inner.getFirst();
  }

  @Override
  public MatchResult match(SNode node) {
    if (node != null) {
      String stringValue = node.getProperty(SPropertyOperations.getString(property, PROPS.name$MnvL));
      Object value;
      MatchResult result;

      if (SLinkOperations.getTarget(property, LINKS.dataType$5j5Y) == SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)", "1082983657062")) {
        value = SPropertyOperations.getInteger(stringValue);
      } else if (SLinkOperations.getTarget(property, LINKS.dataType$5j5Y) == SNodeOperations.getNode("r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)", "1082983657063")) {
        value = SPropertyOperations.getBoolean(stringValue);
      } else {
        value = stringValue;
      }

      boolean c1 = inner.getFirst() == null;
      boolean c2 = !(c1) && (value != null && value.toString().equals(inner.getFirst().toString())) || (value == null && inner.getFirst() == null);

      if ((c1 || c2)) {
        result = new MatchResult(true, null);
      } else {
        result = MatchResult.noMatch();
      }
      result = result.xor(negated);

      if (result.isMatch() && shouldAnnotate()) {
        result.put(annotation, value);
      }

      return result;
    }
    return MatchResult.noMatch();
  }

  @Override
  public SNode build(SNode node) {
    String value = inner.getFirst().toString();
    node.setProperty(SPropertyOperations.getString(this.property, PROPS.name$MnvL), value);
    return node;
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink dataType$5j5Y = MetaAdapterFactory.getReferenceLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979bd086bL, 0xfc26f42fe5L, "dataType");
  }
}
