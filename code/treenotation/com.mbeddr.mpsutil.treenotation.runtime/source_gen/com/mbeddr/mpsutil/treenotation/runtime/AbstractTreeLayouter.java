package com.mbeddr.mpsutil.treenotation.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.style.StyleAttribute;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import java.awt.Color;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.awt.geom.Point2D;
import java.awt.Graphics2D;
import java.awt.geom.Line2D;
import java.util.List;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Horizontal;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Vertical;

public abstract class AbstractTreeLayouter implements ITreeLayouter {
  protected static final StyleAttribute<Integer> LEVEL_SPACING = StyleAttributes.getInstance().<Integer>getAttribute("com.mbeddr.mpsutil.treenotation.styles", "tree-level-spacing");
  protected static final StyleAttribute<Integer> NODE_SPACING = StyleAttributes.getInstance().<Integer>getAttribute("com.mbeddr.mpsutil.treenotation.styles", "tree-node-spacing");
  protected static final StyleAttribute<Float> INCOMING_LINE_WIDTH = StyleAttributes.getInstance().<Float>getAttribute("com.mbeddr.mpsutil.treenotation.styles", "tree-incoming-line-width");
  protected static final StyleAttribute<Color> INCOMING_LINE_COLOR = StyleAttributes.getInstance().<Color>getAttribute("com.mbeddr.mpsutil.treenotation.styles", "tree-incoming-line-color");
  public static final int BUTTON_MARGIN = 3;

  protected TreeCell myTreeCell;

  public AbstractTreeLayouter(TreeCell treeCell) {
    myTreeCell = treeCell;
  }

  protected EditorCell getTreeRoot() {
    return myTreeCell.getTreeRoot();
  }

  protected Iterable<EditorCell> getTreeChildren() {
    return myTreeCell.getTreeChildren();
  }

  protected <T> T getStyleForChild(EditorCell child, StyleAttribute<T> attribute) {
    return myTreeCell.getStyleForChild(child, attribute);
  }

  protected Point2D getStartPoint(EditorCell cell) {
    return myTreeCell.getStartPoint(cell);
  }

  protected Point2D getEndPoint(EditorCell cell) {
    return myTreeCell.getEndPoint(cell);
  }

  protected void drawChildIncomingShape(Graphics2D _g, EditorCell child, Line2D line) {
    myTreeCell.drawChildIncomingShape(_g, child, line);
  }

  protected void drawOutgoingShape(Graphics2D _g, List<Line2D> lines) {
    myTreeCell.drawOutgoingShape(_g, lines);
  }

  protected Integer getLevelSpacing() {
    int configuredSpacing = myTreeCell.getStyle().get(LEVEL_SPACING);

    int spaceBetweenRootAndCollapseButton = BUTTON_MARGIN;
    int collapseButtonSize = Button.BUTTON_SIZE;
    int spaceBetweenCollapseButtonAndDeleteButton = BUTTON_MARGIN;
    int deleteButtonSize = Button.BUTTON_SIZE;
    int spaceBetweenDeleteButtonAndChild = BUTTON_MARGIN;
    int spaceForButtons = spaceBetweenRootAndCollapseButton + collapseButtonSize + spaceBetweenCollapseButtonAndDeleteButton + deleteButtonSize + spaceBetweenDeleteButtonAndChild;

    return Math.max(configuredSpacing, spaceForButtons);
  }

  @Override
  public void layoutCollapsed() {
    ((myTreeCell.isLeftToRight() ? new CellLayout_Horizontal() : new CellLayout_Vertical())).doLayout(myTreeCell);
  }
}
