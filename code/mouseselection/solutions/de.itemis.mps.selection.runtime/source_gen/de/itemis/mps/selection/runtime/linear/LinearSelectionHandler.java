package de.itemis.mps.selection.runtime.linear;

/*Generated by MPS */

import de.itemis.mps.selection.runtime.mouse.AbstractDragSelectionHandler;
import jetbrains.mps.openapi.editor.selection.Selection;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.openapi.editor.EditorComponent;
import jetbrains.mps.nodeEditor.cells.EditorCell_Label;
import jetbrains.mps.openapi.editor.cells.CellTraversalUtil;
import de.itemis.mps.selection.runtime.SelectionUtil;

public class LinearSelectionHandler extends AbstractDragSelectionHandler {
  public Selection createSelection(EditorCell fromCell, EditorCell toCell, int fromX, int fromY, int toX, int toY, EditorComponent editorComponent) {
    return null;
  }
  @Override
  public Selection createAlternativeSelection(EditorCell fromCell, EditorCell toCell, int fromX, int fromY, int toX, int toY, EditorComponent editorComponent) {

    if (!(fromCell instanceof EditorCell_Label)) {
      return null;
    }
    if (!(toCell instanceof EditorCell_Label)) {
      return null;
    }

    EditorCell_Label fromLabel = ((EditorCell_Label) fromCell);
    EditorCell_Label toLabel = ((EditorCell_Label) toCell);

    int numLeafs = 1;
    boolean found = false;
    boolean leftToRight = true;

    for (EditorCell nextLeaf = fromLabel; nextLeaf != null; nextLeaf = CellTraversalUtil.getNextLeaf(nextLeaf, LinearSelection.CELL_CONDITION)) {
      if (nextLeaf == toLabel) {
        found = true;
        leftToRight = true;
        break;
      }
      numLeafs++;
    }
    if (!(found)) {
      numLeafs = 1;
      for (EditorCell prevLeaf = fromLabel; prevLeaf != null; prevLeaf = CellTraversalUtil.getPrevLeaf(prevLeaf, LinearSelection.CELL_CONDITION)) {
        if (prevLeaf == toLabel) {
          found = true;
          leftToRight = false;
          break;
        }
        numLeafs++;
      }
    }
    if (!(found)) {
      return null;
    }

    int startPos = SelectionUtil.xCoordToCaretPos(fromLabel, fromX);
    int endPos = SelectionUtil.xCoordToCaretPos(toLabel, toX);

    return new LinearSelection(editorComponent, fromLabel, numLeafs, startPos, endPos, leftToRight);

  }
}
