package de.itemis.mps.editor.celllayout.styles.behavior;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.cells.EditorCell_Component;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.annotations.NotNull;
import javax.swing.JComponent;
import org.jetbrains.annotations.Nullable;
import javax.swing.JButton;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import com.intellij.ui.components.JBOptionButton;
import java.awt.Font;
import javax.swing.border.Border;
import jetbrains.mps.nodeEditor.AbstractCellProvider;
import jetbrains.mps.nodeEditor.cells.EditorCell;

public class EditorCell_IntelliJComponent extends EditorCell_Component {

  private boolean overwriteAscent = true;


  public EditorCell_IntelliJComponent(EditorContext editorContext, SNode node, @NotNull JComponent component) {
    this(editorContext, node, component, FontHelper.Style.Default);
  }

  public EditorCell_IntelliJComponent(EditorContext editorContext, SNode node, @NotNull JComponent component, @Nullable FontHelper.Style style) {
    super(editorContext, node, component);
    if (!(component instanceof JButton)) {
      getStyle().set(StyleAttributes.PUNCTUATION_LEFT, true);
      getStyle().set(StyleAttributes.PUNCTUATION_RIGHT, true);
    }
    component.setOpaque(false);
    if (!(component instanceof JBOptionButton)) {
      component.putClientProperty("ActionToolbar.smallVariant", true);
    }
    if (style == null) {
      style = FontHelper.Style.Default;
    }
    Font deriveFont = FontHelper.deriveFont(style);
    component.setFont(deriveFont);

  }

  public void setOverwriteAscent(boolean flag) {
    overwriteAscent = flag;
  }

  @Override
  public int getAscent() {
    if (!(overwriteAscent)) {
      return super.getAscent();
    }
    JComponent component = getComponent();
    Border border = component.getBorder();
    int additionalAscent = (border != null ? border.getBorderInsets(component).top : 0);
    return component.getBaseline(component.getWidth(), component.getHeight()) + additionalAscent;
  }

  public AbstractCellProvider createProvider() {
    return new AbstractCellProvider(getSNode()) {
      @Override
      public EditorCell createEditorCell(EditorContext context) {
        return EditorCell_IntelliJComponent.this;
      }
    };
  }
}
