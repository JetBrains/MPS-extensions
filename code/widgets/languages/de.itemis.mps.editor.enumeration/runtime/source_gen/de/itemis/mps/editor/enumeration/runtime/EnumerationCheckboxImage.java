package de.itemis.mps.editor.enumeration.runtime;

/*Generated by MPS */

import jetbrains.mps.logging.Logger;
import java.awt.Image;
import org.jetbrains.mps.openapi.model.SNode;
import java.awt.image.ImageObserver;
import jetbrains.mps.project.AbstractModule;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.util.MacrosFactory;
import org.jetbrains.mps.openapi.module.SModule;
import jetbrains.mps.vfs.IFile;
import java.awt.Toolkit;
import java.net.MalformedURLException;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.smodel.Language;
import jetbrains.mps.project.Solution;

public class EnumerationCheckboxImage {
  private static final Logger LOG = Logger.getLogger(EnumerationCheckboxImage.class);
  private Image image;
  private double scale;
  private String next;
  private String state;

  public EnumerationCheckboxImage(String path, double scale, String state, String next, SNode node) {
    image = loadImage(path, node);
    this.scale = scale;
    this.state = state;
    this.next = next;
  }
  public String getNext() {
    return next;
  }
  public String getState() {
    return state;
  }
  public Image getImage() {
    return image;
  }
  public double getScale() {
    return scale;
  }
  public double getWidth(ImageObserver o) {
    double result = image.getWidth(o);
    return result;
  }
  public double getHeight(ImageObserver o) {
    return image.getHeight(o);
  }

  private Image loadImage(String fileName, SNode node) {
    if (fileName == null) {
      return null;
    }
    AbstractModule module = findAnchorModule(SNodeOperations.getModel(SNodeOperations.asNode(SNodeOperations.getConcept(node))));
    if (module == null) {
      return null;
    }
    fileName = MacrosFactory.forModule((SModule) module).expandPath(fileName);
    IFile imageFile = module.getFileSystem().getFile(fileName);
    if (imageFile.exists()) {
      try {
        return Toolkit.getDefaultToolkit().getImage(imageFile.getUrl());
      } catch (MalformedURLException e) {
        if (LOG.isErrorLevel()) {
          LOG.error("Failed to load enum checkbox image", e);
        }
      }
    }
    return null;
  }

  private static AbstractModule findAnchorModule(SModel model) {
    SModule module = model.getModule();
    if (module instanceof Language || module instanceof Solution) {
      return (AbstractModule) module;
    } else {
      return null;
    }
  }


}
