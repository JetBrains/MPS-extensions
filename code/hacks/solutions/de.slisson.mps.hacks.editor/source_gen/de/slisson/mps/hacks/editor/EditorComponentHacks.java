package de.slisson.mps.hacks.editor;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.nodeEditor.EditorComponent;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import java.awt.Window;
import java.awt.Component;
import javax.swing.JTabbedPane;
import com.intellij.ui.tabs.JBTabs;
import java.awt.Container;
import jetbrains.mps.nodeEditor.actions.CursorPositionTracker;
import jetbrains.mps.openapi.editor.cells.CellActionType;
import jetbrains.mps.nodeEditor.NodeEditorActions;
import java.util.HashMap;
import jetbrains.mps.openapi.editor.cells.CellAction;
import de.slisson.mps.reflection.runtime.ReflectionUtil;

public class EditorComponentHacks {

  public static List<EditorComponent> findAllInstances() {
    final List<EditorComponent> instances = ListSequence.fromList(new ArrayList<EditorComponent>());

    new Object() {
      public void collect() {
        for (Window window : Window.getWindows()) {
          collect(window);
        }
      }
      public void collect(Component component) {
        if (component instanceof EditorComponent) {
          ListSequence.fromList(instances).addElement((EditorComponent) component);
        } else if (component instanceof JTabbedPane) {
          JTabbedPane tabPane = ((JTabbedPane) component);
          for (int i = 0; i < tabPane.getTabCount(); i++) {
            collect(tabPane.getTabComponentAt(i));
          }
        } else if (component instanceof JBTabs) {
          JBTabs tabPane = ((JBTabs) component);
          for (int i = 0; i < tabPane.getTabCount(); i++) {
            collect(tabPane.getTabAt(i).getComponent());
          }
        } else if (component instanceof Container) {
          for (Component child : ((Container) component).getComponents()) {
            collect(child);
          }
        }
      }
    }.collect();

    return instances;
  }

  public static CursorPositionTracker getPositionTracker(jetbrains.mps.openapi.editor.EditorComponent editorComponent) {
    // Initialize myEditorComponentAction CLIC action should not lead to exceptions
    editorComponent.getComponentAction(CellActionType.CLICK);
    NodeEditorActions.MoveDown downAction = (NodeEditorActions.MoveDown) ((HashMap<CellActionType, CellAction>) ReflectionUtil.readField(ReflectionUtil.getClass("jetbrains.mps.nodeEditor.EditorComponentActions"), ((Object) ReflectionUtil.readField(EditorComponent.class, ((EditorComponent) editorComponent), "myEditorComponentActions")), "myActionMap")).get(CellActionType.DOWN);
    return ((CursorPositionTracker) ReflectionUtil.readField(NodeEditorActions.MoveDown.class, downAction, "myPositionTracker"));
  }

}
