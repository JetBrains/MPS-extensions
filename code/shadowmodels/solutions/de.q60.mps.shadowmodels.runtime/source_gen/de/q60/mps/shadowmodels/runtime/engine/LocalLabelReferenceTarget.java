package de.q60.mps.shadowmodels.runtime.engine;

/*Generated by MPS */

import java.util.Objects;

public class LocalLabelReferenceTarget implements IReferenceTarget {
  private ContainmentTargetRootNodes<TransformationCall> resultRef;
  private String label;

  private LocalLabelReferenceTarget() {
    // for deserialization
  }

  public LocalLabelReferenceTarget(ContainmentTargetRootNodes<TransformationCall> resultRef, String label) {
    this.resultRef = resultRef;
    this.label = label;
  }

  @Override
  public IOutputNodeReference resolve(IScope sourceScope, ITransformationEngine engine) {
    if (Objects.equals(resultRef.getStageRef(), sourceScope.getStage())) {
      ITransformationResult tresult = sourceScope.getStage(engine).getTransformationResult(resultRef.getContainmentTarget());
      return tresult.getLabeledElement(label).getCanonicalReference();
    } else {
      // TODO
      throw new RuntimeException("Local label '" + label + "' not found");
    }
  }

  @Override
  public String toString() {
    return resultRef + "#" + label;
  }

  private transient int _cachedHashCode;
  private transient boolean _hashCodeInitialized = false;
  @Override
  public int hashCode() {
    if (!(_hashCodeInitialized)) {
      int c = 0;
      c = 31 * c + Objects.hashCode(label);
      c = 31 * c + Objects.hashCode(resultRef);
      _cachedHashCode = c;
      _hashCodeInitialized = true;
    }
    return _cachedHashCode;
  }
  @Override
  public boolean equals(Object o) {
    if (this == o) {
      return true;
    }
    if (o == null || this.getClass() != o.getClass()) {
      return false;
    }
    LocalLabelReferenceTarget that = (LocalLabelReferenceTarget) o;
    if (!(Objects.equals(label, that.label))) {
      return false;
    }
    if (!(Objects.equals(resultRef, that.resultRef))) {
      return false;
    }
    return true;
  }
}
