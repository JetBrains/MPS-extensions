package de.q60.mps.shadowmodels.debugview.plugin;

/*Generated by MPS */

import de.q60.mps.shadowmodels.debugview.pf.ITraceBuilderContext;
import de.q60.mps.shadowmodels.runtime.engine.ITransformationEngine;
import org.jetbrains.mps.openapi.module.SRepository;
import jetbrains.mps.project.Project;
import jetbrains.mps.ide.project.ProjectHelper;
import org.jetbrains.mps.openapi.model.SNode;
import de.q60.mps.shadowmodels.runtime.engine.IResultElement;
import org.jetbrains.mps.openapi.model.SNodeReference;
import jetbrains.mps.smodel.SNodePointer;

public class TraceBuilderContext implements ITraceBuilderContext {
  private ITransformationEngine engine;
  private SRepository repository;

  public TraceBuilderContext(ITransformationEngine engine, SRepository repository) {
    this.engine = engine;
    this.repository = repository;
  }
  public TraceBuilderContext(ITransformationEngine engine, Project project) {
    this(engine, project.getRepository());
  }
  public TraceBuilderContext(ITransformationEngine engine, com.intellij.openapi.project.Project project) {
    this(engine, ProjectHelper.fromIdeaProject(project));
  }

  public ITransformationEngine getTransformationEngine() {
    return engine;
  }
  public SNode resolveTransformationDeclaration(final IResultElement element) {
    if (element == null) {
      return null;
    }
    SNode decl = resolveTraceInfo(element.getTraceInfo());
    if (decl != null) {
      return decl;
    }
    decl = resolveTraceInfo(element.getTransformationResult().getTraceInfo());
    return decl;
  }
  public SNode resolveTraceInfo(String info) {
    if (info == null) {
      return null;
    }
    SNodeReference declRef;
    try {
      declRef = SNodePointer.deserialize(info);
    } catch (Exception ex) {
      return null;
    }
    return declRef.resolve(getRepository());
  }
  public SRepository getRepository() {
    return repository;
  }

}
