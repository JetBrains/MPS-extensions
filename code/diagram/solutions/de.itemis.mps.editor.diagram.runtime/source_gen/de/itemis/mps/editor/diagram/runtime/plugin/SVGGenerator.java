package de.itemis.mps.editor.diagram.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import java.awt.Graphics2D;
import java.io.File;
import java.io.IOException;
import org.w3c.dom.DOMImplementation;
import org.apache.batik.dom.GenericDOMImplementation;
import org.w3c.dom.Document;
import org.apache.batik.svggen.SVGGeneratorContext;
import org.apache.batik.svggen.GenericImageHandler;
import org.apache.batik.svggen.CachedImageHandlerBase64Encoder;
import org.apache.batik.svggen.SVGGraphics2D;
import java.io.Writer;
import java.io.BufferedWriter;
import java.io.FileWriter;

public class SVGGenerator {

  public static void generateImage(_FunctionTypes._void_P1_E0<? super Graphics2D> painter, File destination) throws IOException {
    // Get a DOMImplementation.
    DOMImplementation domImpl = GenericDOMImplementation.getDOMImplementation();
    // Create an instance of org.w3c.dom.Document.
    String svgNS = "http://www.w3.org/2000/svg";
    Document document = domImpl.createDocument(svgNS, "svg", null);

    SVGGeneratorContext ctx = SVGGeneratorContext.createDefault(document);
    ctx.setEmbeddedFontsOn(true);
    GenericImageHandler ihandler = new CachedImageHandlerBase64Encoder();
    ctx.setGenericImageHandler(ihandler);
    // Create an instance of the SVG Generator.
    SVGGraphics2D svgGenerator = new SVGGraphics2D(ctx, true);
    // Ask the test to render into the SVG Graphics2D implementation.
    painter.invoke(svgGenerator);
    // Finally, stream out SVG to the standard output using
    // UTF-8 encoding.
    boolean useCSS = true;
    // we want to use CSS style attributes
    Writer out = new BufferedWriter(new FileWriter(destination));
    try {
      svgGenerator.stream(out, useCSS);
    } finally {
      out.close();
    }
  }

}
