package de.itemis.mps.editor.diagram.runtime.coordinates;

/*Generated by MPS */

import java.awt.geom.AffineTransform;
import java.awt.geom.NoninvertibleTransformException;
import java.awt.geom.Point2D;

public class AffineTransformCoordinateSystem implements ICoordinateSystem {
  private ICoordinateSystem myParent;

  public AffineTransformCoordinateSystem(ICoordinateSystem parent) {
    myParent = parent;
  }

  protected AffineTransform getTransformation() {
    return AffineTransform.getTranslateInstance(0.0, 0.0);
  }

  public ICoordinates toGlobal(ICoordinates coordinates) {
    if (coordinates.getCoordinateSystem() != this) {
      throw new RuntimeException("Coordinates are not in this coordinate system (" + this.getClass().getName() + " != " + this.getClass().getName() + ")");
    }
    try {
      return transform(getTransformation().createInverse(), coordinates, myParent);
    } catch (NoninvertibleTransformException ex) {
      throw new RuntimeException(ex);
    }
  }

  public ICoordinates toLocal(ICoordinates coordinates) {
    return transform(getTransformation(), coordinates.toGlobal(), this);
  }

  private static ICoordinates transform(AffineTransform transformation, ICoordinates coordinates, ICoordinateSystem newCoordinateSystem) {
    Point2D result = new Point2D.Double();
    transformation.transform(new Point2D.Double(coordinates.getX(), coordinates.getY()), result);
    return new Coordinates(result.getX(), result.getY(), newCoordinateSystem);
  }
}
