package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import java.util.List;
import com.mxgraph.view.mxCellState;
import com.mxgraph.view.mxGraphView;
import de.itemis.mps.editor.diagram.runtime.model.Point;
import java.util.Collections;

public abstract class SmartGuide_PointPair extends AbstractSmartGuide implements ISmartGuide {

  @Override
  protected List<SnapResult> snap(double dx, double dy, double distanceLimit, mxCellState movingState, mxCellState otherState, mxGraphView view) {
    if (otherState == movingState) {
      return null;
    }
    if (otherState.getCell() instanceof BoxDCell) {
      SnapResult result = new SnapResult();

      Point pointOnMoving = getPointOnMoving(dx, dy, movingState, otherState);
      Point pointOnOther = getPointOnOther(dx, dy, movingState, otherState);

      pointOnMoving = new Point(pointOnMoving.getX() + dx, pointOnMoving.getY() + dy);

      result.setSnapDistanceX(0);
      result.setSnapDistanceY(0);
      if (snapVertical()) {
        result.setSnapDistanceY(pointOnOther.getY() - pointOnMoving.getY());
      }
      if (snapHorizontal()) {
        result.setSnapDistanceX(pointOnOther.getX() - pointOnMoving.getX());
      }

      if (Math.abs(result.getSnapDistance()) <= distanceLimit) {
        double x1 = pointOnMoving.getX() + result.getSnapDistanceX();
        double y1 = pointOnMoving.getY() + result.getSnapDistanceY();
        double x2 = pointOnOther.getX();
        double y2 = pointOnOther.getY();
        result.setGuideLine(x1, y1, x2, y2);
        return Collections.singletonList(result);
      }
    }

    return Collections.emptyList();
  }


  public abstract Point getPointOnMoving(double dx, double dy, mxCellState moving, mxCellState other);
  public abstract Point getPointOnOther(double dx, double dy, mxCellState moving, mxCellState other);
  public abstract boolean snapVertical();
  public abstract boolean snapHorizontal();
}
