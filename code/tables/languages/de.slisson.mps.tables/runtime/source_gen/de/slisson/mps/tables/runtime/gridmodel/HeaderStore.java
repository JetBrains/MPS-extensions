package de.slisson.mps.tables.runtime.gridmodel;

/*Generated by MPS */

import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.Set;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import jetbrains.mps.internal.collections.runtime.ListSequence;

public class HeaderStore {
  private Map<HeaderReference, Header> myHeaders = new HashMap<HeaderReference, Header>();
  private List<HeaderStore> myChildStores = new ArrayList<HeaderStore>();
  private HeaderStore myParentStore;

  public HeaderStore() {
  }

  public HeaderStore(HeaderStore other) {
    putAll(other);
  }

  public void putAll(HeaderStore other) {
    for (Header header : SetSequence.fromSet(other.getAllHeaders())) {
      storeHeader(header);
    }
  }

  public Set<Header> getHeaders() {
    return SetSequence.fromSetWithValues(new HashSet<Header>(), myHeaders.values());
  }

  public Set<Header> getAllHeaders() {
    Set<Header> accumulator = SetSequence.fromSet(new HashSet<Header>());
    getAllHeaders(accumulator);
    return accumulator;
  }

  protected void getAllHeaders(Set<Header> accumulator) {
    SetSequence.fromSet(accumulator).addSequence(CollectionSequence.fromCollection(myHeaders.values()));
    for (HeaderStore child : ListSequence.fromList(myChildStores)) {
      child.getAllHeaders(accumulator);
    }
  }

  public Header getHeader(HeaderReference reference) {
    return myHeaders.get(reference);
  }

  public void storeHeader(Header header) {
    Header existing = myHeaders.get(header.getReference());
    if (existing != null) {
      header.combine(existing);
    }
    myHeaders.put(header.getReference(), header);
  }

  public void addChild(HeaderStore child) {
    myChildStores.add(child);
    child.setParent(this);
  }

  private void setParent(HeaderStore parent) {
    myParentStore = parent;
  }

  private HeaderStore getRoot() {
    return (myParentStore == null ? this : myParentStore.getRoot());
  }

  public Header findHeader(HeaderReference reference) {
    return getRoot().findHeaderInSelfAndDescendants(reference);
  }

  private Header findHeaderInSelfAndDescendants(HeaderReference reference) {
    Header result = null;
    result = findHeaderInSelf(reference);
    if (result != null) {
      return result;
    }
    for (HeaderStore child : ListSequence.fromList(myChildStores)) {
      result = child.findHeaderInSelfAndDescendants(reference);
      if (result != null) {
        return result;
      }
    }
    return null;
  }

  private Header findHeaderInSelf(HeaderReference reference) {
    return myHeaders.get(reference);
  }

}
