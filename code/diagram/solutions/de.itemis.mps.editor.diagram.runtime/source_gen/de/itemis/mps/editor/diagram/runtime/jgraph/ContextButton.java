package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import java.awt.Color;
import jetbrains.mps.nodeEditor.EditorSettings;
import com.intellij.ui.JBColor;
import de.itemis.mps.editor.diagram.runtime.model.Bounds;
import com.mxgraph.view.mxCellState;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import java.awt.Graphics2D;
import java.awt.BasicStroke;
import java.awt.event.MouseEvent;
import de.itemis.mps.editor.diagram.runtime.model.Point;
import java.awt.geom.Line2D;

public class ContextButton {
  public static final double DEFAULT_BUTTON_SPACING = 5.0;
  public static final double DEFAULT_BUTTON_SIZE = 16.0;

  public static final Color HIGHLIGHT_COLOR = EditorSettings.getInstance().getSelectionBackgroundColor();
  public static final Color BACKGROUND_COLOR = RootDiagramECell.DEFAULT_BACKGROUND_COLOR;
  public static final Color LINE_COLOR = JBColor.GRAY;

  protected Bounds myBounds;
  protected mxCellState myCellState;
  private List<ContextButton> myChildButtons = ListSequence.fromList(new ArrayList<ContextButton>());
  private double mySpacing = DEFAULT_BUTTON_SPACING;

  public ContextButton(double size, mxCellState state) {
    this(size, size, state);
  }

  public ContextButton(double xsize, double ysize, mxCellState state) {
    myBounds = new Bounds(0.0, 0.0, xsize, ysize);
    myCellState = state;
  }

  public ContextButton(double size, mxCellState state, double spacing) {
    this(size, state);
    setSpacing(spacing);
  }

  public ContextButton(double xsize, double ysize, mxCellState state, double spacing) {
    this(xsize, ysize, state);
    setSpacing(spacing);
  }

  public double getSpacing() {
    return mySpacing;
  }

  public void setSpacing(double spacing) {
    mySpacing = spacing;
  }

  public void addChildButton(ContextButton child) {
    ListSequence.fromList(myChildButtons).addElement(child);
  }

  public List<ContextButton> getChildButtons() {
    return myChildButtons;
  }

  public Bounds getBounds() {
    return myBounds.clone();
  }

  public void setPos(double x, double y) {
    myBounds.setX(x);
    myBounds.setY(y);
  }

  public double getWidth() {
    return myBounds.getWidth();
  }

  public double getLineWidth() {
    return DEFAULT_BUTTON_SIZE * 0.1;
  }

  public void paint(Graphics2D g, boolean highlighted) {
    g.setColor(LINE_COLOR);
    g.setStroke(new BasicStroke((float) getLineWidth()));
    paintBackground(g, highlighted);
    paintBorder(g);
    paintSymbol(g);
  }

  protected void paintSymbol(Graphics2D g) {
  }

  protected void paintBackground(Graphics2D g, boolean highlighted) {
    g.setColor((highlighted ? HIGHLIGHT_COLOR : BACKGROUND_COLOR));
    g.fill(ExtensionMethods.toRectangle2D(getBounds()));
  }

  public void paintBorder(Graphics2D g) {
    g.setColor(LINE_COLOR);
    g.setStroke(new BasicStroke((float) getLineWidth()));
    g.draw(ExtensionMethods.toRectangle2D(myBounds));
  }

  protected void execute() {
    System.out.println("Executed " + this);
  }

  public void mouseDragged(MouseEvent event) {
    System.out.println("Dragged to (" + event.getX() + ", " + event.getY() + ") " + this);
  }

  public String getTooltip() {
    return getClass().getSimpleName();
  }

  protected void drawLine(Graphics2D g, Point p1, Point p2) {
    g.draw(new Line2D.Double(ExtensionMethods.toPoint2D(p1), ExtensionMethods.toPoint2D(p2)));
  }

  public void repaint() {
    MyGraph graph = (MyGraph) myCellState.getView().getGraph();
    MyGraphComponent graphComponent = graph.getGraphComponent();
    Bounds bounds = getBounds();
    bounds.expand(1);
    graphComponent.repaint(bounds.getXInt(), bounds.getYInt(), bounds.getWidthInt(), bounds.getHeightInt());
  }

  public MyGraph getGraph() {
    return ((BaseDCell) getCell())._getGraph();
  }

  public Object getCell() {
    return myCellState.getCell();
  }
}
