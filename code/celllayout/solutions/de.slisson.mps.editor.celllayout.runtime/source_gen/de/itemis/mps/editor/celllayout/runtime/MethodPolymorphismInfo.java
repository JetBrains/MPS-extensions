package de.itemis.mps.editor.celllayout.runtime;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.WeakHashMap;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import jetbrains.mps.nodeEditor.cells.EditorCell_Basic;

public class MethodPolymorphismInfo {

  private static MethodPolymorphismInfo ourInstance = new MethodPolymorphismInfo();

  public static MethodPolymorphismInfo getInstance() {
    return ourInstance;
  }

  private Map<Class, Boolean> ourCache = MapSequence.fromMap(new WeakHashMap<Class, Boolean>());

  public boolean overridesLayoutMethod(Class cellClass) {
    Boolean result = MapSequence.fromMap(ourCache).get(cellClass);
    if (result == null) {
      result = calcOverridesLayoutMethod(cellClass);
      MapSequence.fromMap(ourCache).put(cellClass, result);
    }
    return result;
  }

  protected boolean calcOverridesLayoutMethod(Class cellClass) {
    for (Class superClass = cellClass; superClass != null; superClass = superClass.getSuperclass()) {
      if (cellClass == EditorCell_Collection.class) {
        break;
      }
      if (cellClass == EditorCell_Basic.class) {
        break;
      }
      try {
        if (cellClass.getDeclaredMethod("relayoutImpl") != null) {
          return true;
        }
      } catch (NoSuchMethodException e) {
      }
    }
    return false;
  }

}
