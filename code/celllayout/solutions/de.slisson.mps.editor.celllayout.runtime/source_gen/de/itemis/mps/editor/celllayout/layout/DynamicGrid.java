package de.itemis.mps.editor.celllayout.layout;

/*Generated by MPS */


public class DynamicGrid<E> {
  protected int mySizeX = 0;
  protected int mySizeY = 0;

  private int myInternalSizeX = 2;
  private int myInternalSizeY = 2;
  protected Object[] myElements = new Object[2 * 2];

  public DynamicGrid() {
  }

  public DynamicGrid(E initalElement) {
    setElement(0, 0, initalElement);
  }

  private static int toIndex(int x, int y, int sizeX) {
    return y * sizeX + x;
  }

  public int getSizeX() {
    return mySizeX;
  }

  public int getSizeY() {
    return mySizeY;
  }

  public E getElement(int x, int y) {
    if (x >= getSizeX()) {
      throw new IndexOutOfBoundsException("IndexX: " + x + ", SizeX: " + getSizeX());
    }
    if (y >= getSizeY()) {
      throw new IndexOutOfBoundsException("IndexY: " + y + ", SizeY: " + getSizeY());
    }

    return (E) myElements[toIndex(x, y, myInternalSizeX)];
  }

  public void setElement(int x, int y, E element) {
    ensureSize(x + 1, y + 1);
    myElements[toIndex(x, y, myInternalSizeX)] = element;
  }

  public void setElements(int offsetX, int offsetY, DynamicGrid<E> elements) {
    ensureSize(elements.getSizeX() + offsetX, elements.getSizeY() + offsetY);
    for (int x = 0; x < elements.getSizeX(); x++) {
      for (int y = 0; y < elements.getSizeY(); y++) {
        setElement(x + offsetX, y + offsetY, elements.getElement(x, y));
      }
    }
  }

  private void ensureSize(int minSizeX, int minSizeY) {
    setSize(Math.max(minSizeX, mySizeX), Math.max(minSizeY, mySizeY));
  }

  private void setSize(int newSizeX, int newSizeY) {
    if (newSizeX == mySizeX && newSizeY == mySizeY) {
      return;
    }

    ensureInternalSize(newSizeX, newSizeY);

    mySizeX = newSizeX;
    mySizeY = newSizeY;
  }

  private void ensureInternalSize(int sizeX, int sizeY) {
    if (sizeX <= myInternalSizeX && sizeY <= myInternalSizeY) {
      return;
    }
    int newSizeX = myInternalSizeX;
    int newSizeY = myInternalSizeY;
    while (newSizeX < sizeX) {
      newSizeX *= 2;
    }
    while (newSizeY < sizeY) {
      newSizeY *= 2;
    }
    setInternalSize(newSizeX, newSizeY);
  }

  private void setInternalSize(int newSizeX, int newSizeY) {
    Object[] newElements = new Object[newSizeX * newSizeY];
    for (int y = 0; y < Math.min(myInternalSizeY, newSizeY); y++) {
      for (int x = 0; x < Math.min(myInternalSizeX, newSizeX); x++) {
        newElements[toIndex(x, y, newSizeX)] = myElements[toIndex(x, y, myInternalSizeX)];
      }
    }
    myElements = newElements;
    myInternalSizeX = newSizeX;
    myInternalSizeY = newSizeY;
  }
}
