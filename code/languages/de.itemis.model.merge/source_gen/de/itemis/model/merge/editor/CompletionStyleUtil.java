package de.itemis.model.merge.editor;

/*Generated by MPS */

import jetbrains.mps.editor.runtime.completion.CompletionItemInformation;
import jetbrains.mps.openapi.editor.menus.style.EditorMenuItemStyle;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import de.itemis.model.merge.behavior.DeclarationPolicy__BehaviorDescriptor;
import java.util.Collection;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Collections;
import com.intellij.ui.JBColor;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class CompletionStyleUtil {


  public static void apply(CompletionItemInformation itemInformation, EditorMenuItemStyle style, SNode childPolicy) {
    List<SNode> alreadyDefined = ListSequence.fromList(SLinkOperations.getChildren((SNodeOperations.getNodeAncestor(childPolicy, CONCEPTS.ConceptMergingPolicy$RB, true, false)), LINKS.childPolicies$7ocQ)).select((it) -> (SNode) DeclarationPolicy__BehaviorDescriptor.childLink_id1VmHfRx_0K2.invoke(it)).where((it) -> (it != null)).toList();
    setStyle(alreadyDefined, itemInformation, style);
  }


  public static void apply(CompletionItemInformation itemInformation, EditorMenuItemStyle style, Collection<SNode> itemPolicies) {
    Iterable<SNode> linkDeclarations = CollectionSequence.fromCollection(itemPolicies).select((it) -> (SNode) DeclarationPolicy__BehaviorDescriptor.childLink_id1VmHfRx_0K2.invoke(it));

    List<SNode> alreadyDefined = Sequence.fromIterable(linkDeclarations).where((it) -> (it != null)).toList();
    List<SNode> list = (alreadyDefined == null ? Collections.<SNode>emptyList() : alreadyDefined);
    setStyle(list, itemInformation, style);
  }

  public static void applyToItemPolices(CompletionItemInformation itemInformation, EditorMenuItemStyle style, Collection<SNode> itemPolicies) {
    Iterable<SNode> linkDeclarations = CollectionSequence.fromCollection(itemPolicies).select((it) -> (SNode) DeclarationPolicy__BehaviorDescriptor.childLink_id1VmHfRx_0K2.invoke(it));

    List<SNode> alreadyDefined = Sequence.fromIterable(linkDeclarations).where((it) -> (it != null)).toList();
    List<SNode> list = (alreadyDefined == null ? Collections.<SNode>emptyList() : alreadyDefined);
    setStyle(list, itemInformation, style);
  }

  public static void setNewStyle(EditorMenuItemStyle style) {
    style.setPriority(2);
    style.setDescriptionText("(new)");
  }

  public static void setChosenStyle(EditorMenuItemStyle style) {
    style.setTextColor(JBColor.LIGHT_GRAY);
    style.setStrikeout();
    style.setTextColor(JBColor.RED);
    style.setPriority(1);
    style.setDescriptionText("(already chosen)");

  }

  public static void setStyle(List<? extends SNode> alreadyDefined, CompletionItemInformation itemInformation, EditorMenuItemStyle style) {
    Object parameterObject = itemInformation.getParameterObject();
    if (parameterObject instanceof SNode) {
      SNode n = ((SNode) parameterObject);
      if (ListSequence.fromList(alreadyDefined).contains(n)) {
        CompletionStyleUtil.setChosenStyle(style);
      } else {
        CompletionStyleUtil.setNewStyle(style);
      }
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConceptMergingPolicy$RB = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, "de.itemis.model.merge.structure.ConceptMergingPolicy");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink childPolicies$7ocQ = MetaAdapterFactory.getContainmentLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, 0x74e2e0579b2effc5L, "childPolicies");
  }
}
