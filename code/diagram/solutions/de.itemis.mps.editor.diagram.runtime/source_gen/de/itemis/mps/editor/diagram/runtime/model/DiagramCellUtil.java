package de.itemis.mps.editor.diagram.runtime.model;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.util.Map;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import java.util.List;
import de.itemis.mps.editor.diagram.runtime.EditorUtil;
import jetbrains.mps.internal.collections.runtime.ListSequence;

public class DiagramCellUtil {
  public static void disablePreferredSize(EditorCell c, Runnable runnable) {
    final Map<IDiagramCell, Tuples._2<Double, Double>> preferredSizes = MapSequence.fromMap(new HashMap<IDiagramCell, Tuples._2<Double, Double>>());
    List<IDiagramCell> subdiagrams = EditorUtil.firstLevelDescendants(c, IDiagramCell.class);
    ListSequence.fromList(subdiagrams).visitAll((it) -> MapSequence.fromMap(preferredSizes).put(it, it.getFixedSize()));

    try {
      ListSequence.fromList(subdiagrams).visitAll((it) -> it.clearFixedSize());
      runnable.run();
    } finally {
      ListSequence.fromList(subdiagrams).visitAll((it) -> {
        Tuples._2<Double, Double> preferredSize = MapSequence.fromMap(preferredSizes).get(it);
        if (preferredSize != null) {
          it.setFixedSize((double) preferredSize._0(), (double) preferredSize._1());
        }
      });
    }
  }
}
