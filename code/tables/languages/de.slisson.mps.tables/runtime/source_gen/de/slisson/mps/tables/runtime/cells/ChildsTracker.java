package de.slisson.mps.tables.runtime.cells;

/*Generated by MPS */

import java.util.Set;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.util.HashSet;
import java.util.Deque;
import jetbrains.mps.internal.collections.runtime.DequeSequence;
import java.util.LinkedList;

public class ChildsTracker {

  private Set<EditorCell> myChilds = new HashSet<EditorCell>();
  private Set<EditorCell> myHeaderChilds = new HashSet<EditorCell>();

  public void registerHeader(EditorCell child) {
    myHeaderChilds.add(child);
    myChilds.remove(child);
  }

  public void registerChild(EditorCell child) {
    if (myHeaderChilds.contains(child)) {
      return;
    }
    myChilds.add(child);
  }

  public boolean isRegistered(EditorCell cell) {
    return myChilds.contains(cell);
  }

  public boolean isRegisteredHeader(EditorCell cell) {
    return myHeaderChilds.contains(cell);
  }

  public Set<EditorCell> getRegisteredCells() {
    return new HashSet<EditorCell>(myChilds);
  }

  public Set<EditorCell> getRegisteredHeaders() {
    return new HashSet<EditorCell>(myHeaderChilds);
  }

  private static ThreadLocal<Deque<ChildsTracker>> instances = new ThreadLocal<Deque<ChildsTracker>>();

  public static ChildsTracker getInstance() {
    initStack();
    return DequeSequence.fromDequeNew(instances.get()).peekElement();
  }

  public static ChildsTracker pushNewInstance() {
    initStack();
    DequeSequence.fromDequeNew(instances.get()).pushElement(new ChildsTracker());
    return getInstance();
  }

  public static ChildsTracker popInstance() {
    return popInstance(false);
  }

  public static ChildsTracker popInstance(boolean popHeaders) {
    initStack();
    ChildsTracker removed = DequeSequence.fromDequeNew(instances.get()).popElement();
    ChildsTracker current = getInstance();
    if (current != null && !(popHeaders)) {
      current.myHeaderChilds.addAll(removed.myHeaderChilds);
    }
    return removed;
  }

  private static void initStack() {
    if (instances.get() == null) {
      instances.set(DequeSequence.fromDeque(new LinkedList<ChildsTracker>()));
    }
  }


}
