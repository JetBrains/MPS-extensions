package de.q60.mps.shadowmodels.runtime.smodel;

/*Generated by MPS */

import org.modelix.model.mpsadapters.mps.SNodeAPI;
import org.jetbrains.mps.openapi.model.SNode;
import org.modelix.model.mpsadapters.mps.NodeToSNodeAdapter;
import de.q60.mps.shadowmodels.runtime.model.SM_SimpleNode;
import org.modelix.model.mpsadapters.mps.SConceptAdapter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import de.q60.mps.shadowmodels.runtime.engine.DependencyTrackingNode;
import org.modelix.model.mpsadapters.mps.SNodeToNodeAdapter;
import org.jetbrains.mps.openapi.model.SModel;
import org.modelix.model.mpsadapters.mps.ANode;
import de.q60.mps.shadowmodels.runtime.engine.IOperation;
import de.q60.mps.shadowmodels.runtime.engine.IResultElement;

public class SM_SNodeAPI extends SNodeAPI {

  public static <T extends SNode> T copyAsSimpleNode(T sourceNode) {
    return (T) SNodeAPI.copyRootNode(sourceNode, NodeToSNodeAdapter.wrap(new SM_SimpleNode(SConceptAdapter.wrap(SNodeOperations.getConcept(sourceNode)))));
  }

  public static String uniqueString(SNode node) {
    node = NodeToSNodeAdapter.wrap(DependencyTrackingNode.unwrap(SNodeToNodeAdapter.wrap(node)));
    if (node instanceof jetbrains.mps.smodel.SNode) {
      return node.getReference().toString();
    }
    throw new RuntimeException("Cannot calculate unique string for " + node);
  }

  public static SModel getOriginalModel(SNode node) {
    return check_bryxed_a0a5(getOriginalNode(node));
  }

  public static SNode getOriginalNode(SNode node) {
    return as_bryxed_a0a0h(SNodeAPI.tryGetUnwrappedNode(NodeToSNodeAdapter.wrap(DependencyTrackingNode.unwrap(SNodeToNodeAdapter.wrap(ANode.unwrap(SNodeAPI.tryGetUnwrappedNode(node)))))), jetbrains.mps.smodel.SNode.class);
  }

  public static SNode tryGetUnwrappedNode(SNode node) {
    SNode unwrapped = getOriginalNode(node);
    return (unwrapped != null ? unwrapped : node);
  }

  public static IOperation getOperation(SNode node, String operationId) {
    IOperation op = tryGetOperation(node, operationId);
    if (op == null) {
      throw new RuntimeException(SNodeOperations.present(node) + " doesn't implement the operation " + operationId);
    }
    return op;
  }

  public static IOperation tryGetOperation(SNode node, String operationId) {
    IResultElement resultElement = SM_TransformationTrace.getResultElement(node);
    return check_bryxed_a1a31(resultElement, operationId);
  }
  private static SModel check_bryxed_a0a5(SNode checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getModel();
    }
    return null;
  }
  private static IOperation check_bryxed_a1a31(IResultElement checkedDotOperand, String operationId) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getOperation(operationId);
    }
    return null;
  }
  private static <T> T as_bryxed_a0a0h(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
