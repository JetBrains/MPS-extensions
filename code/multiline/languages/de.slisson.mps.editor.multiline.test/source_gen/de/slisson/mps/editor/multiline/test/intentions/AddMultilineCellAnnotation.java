package de.slisson.mps.editor.multiline.test.intentions;

/*Generated by MPS */

import de.itemis.mps.selection.runtime.intentions.AbstractSelectionIntentionFactory;
import java.util.List;
import de.itemis.mps.selection.runtime.intentions.ISelectionIntentionExecutable;
import de.slisson.mps.editor.multiline.cells.MultilineSelection;
import de.itemis.mps.selection.runtime.intentions.AbstractSelectionIntentionExecutable;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.action.SNodeFactoryOperations;
import jetbrains.mps.nodeEditor.inspector.InspectorEditorComponent;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.editor.runtime.selection.SelectionUtil;
import java.util.Collections;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public class AddMultilineCellAnnotation extends AbstractSelectionIntentionFactory {
  public AddMultilineCellAnnotation() {
  }

  @Override
  public List<ISelectionIntentionExecutable> getInstances(Object selection) {
    if (selection instanceof MultilineSelection) {
      ISelectionIntentionExecutable intention = new AbstractSelectionIntentionExecutable<MultilineSelection>() {
        @Override
        public void execute(MultilineSelection selection) {
          SNode node = selection.getSelectedNodes().get(0);
          EditorContext editorContext = selection.getEditorComponent().getEditorContext();

          SNode ancessor = node;
          while (ancessor != null && !(SNodeOperations.isInstanceOf(SNodeOperations.getParent(ancessor), CONCEPTS.EditorTestCase$DN))) {
            ancessor = SNodeOperations.getParent(ancessor);
          }
          SNode newAnnotation = SNodeFactoryOperations.createNewNode(CONCEPTS.MultilineCellAnnotation$RZ, null);
          if (editorContext.getEditorComponent() instanceof InspectorEditorComponent) {
            SPropertyOperations.assign(newAnnotation, PROPS.isInInspector$2I_a, true);
          }

          SPropertyOperations.assign(newAnnotation, PROPS.selectionStart$gMsM, selection.getSelectionStart());
          SPropertyOperations.assign(newAnnotation, PROPS.selectionEnd$gMUO, selection.getSelectionEnd());
          SPropertyOperations.assign(newAnnotation, PROPS.caretPosition$2w8S, selection.getCaretPosition());

          SPropertyOperations.assign(newAnnotation, PROPS.name$MnvL, "multiline");
          ListSequence.fromList(new IAttributeDescriptor.NodeAttribute(CONCEPTS.MultilineCellAnnotation$RZ).list(node)).addElement(newAnnotation);
          SelectionUtil.selectNode(editorContext, newAnnotation);
        }
        @Override
        public String getDescription(MultilineSelection selection) {
          return "Add Multiline Test Annotation (Record Cursor State)";
        }
        @Override
        public boolean isApplicable(MultilineSelection selection) {
          SNode node = selection.getSelectedNodes().get(0);
          return SNodeOperations.isInstanceOf(SNodeOperations.getParent(SNodeOperations.getNodeAncestor(node, CONCEPTS.TestNode$zF, false, false)), CONCEPTS.EditorTestCase$DN);
        }
      };
      return Collections.singletonList(intention);
    } else {
      return Collections.<ISelectionIntentionExecutable>emptyList();
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept EditorTestCase$DN = MetaAdapterFactory.getConcept(0x8585453e6bfb4d80L, 0x98deb16074f1d86cL, 0x11e314b20e0L, "jetbrains.mps.lang.test.structure.EditorTestCase");
    /*package*/ static final SConcept MultilineCellAnnotation$RZ = MetaAdapterFactory.getConcept(0xf2ccb7a482c4ebfL, 0xbf26faa5b895afe4L, 0x2bd382fd31f23fd6L, "de.slisson.mps.editor.multiline.test.structure.MultilineCellAnnotation");
    /*package*/ static final SConcept TestNode$zF = MetaAdapterFactory.getConcept(0x8585453e6bfb4d80L, 0x98deb16074f1d86cL, 0x11b5a38fc01L, "jetbrains.mps.lang.test.structure.TestNode");
  }

  private static final class PROPS {
    /*package*/ static final SProperty isInInspector$2I_a = MetaAdapterFactory.getProperty(0xf2ccb7a482c4ebfL, 0xbf26faa5b895afe4L, 0x2bd382fd31f23fd6L, 0x1b73330fb1241e01L, "isInInspector");
    /*package*/ static final SProperty selectionStart$gMsM = MetaAdapterFactory.getProperty(0xf2ccb7a482c4ebfL, 0xbf26faa5b895afe4L, 0x2bd382fd31f23fd6L, 0x56ffc0a94fe5fc33L, "selectionStart");
    /*package*/ static final SProperty selectionEnd$gMUO = MetaAdapterFactory.getProperty(0xf2ccb7a482c4ebfL, 0xbf26faa5b895afe4L, 0x2bd382fd31f23fd6L, 0x56ffc0a94fe5fc35L, "selectionEnd");
    /*package*/ static final SProperty caretPosition$2w8S = MetaAdapterFactory.getProperty(0xf2ccb7a482c4ebfL, 0xbf26faa5b895afe4L, 0x2bd382fd31f23fd6L, 0x11e31babe14L, "caretPosition");
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
