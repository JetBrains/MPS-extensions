package de.q60.mps.incremental.runtime;

/*Generated by MPS */

import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;

public class TrackableSet<V> {

  private Set<V> values = SetSequence.fromSet(new HashSet<V>());

  public void add(V value) {
    if (SetSequence.fromSet(values).contains(value)) {
      return;
    }
    SetSequence.fromSet(values).addElement(value);
    DependencyBroadcaster.INSTANCE.dependenciesChanged(Sequence.<DependencyKey>singleton(new SetContainsDependency(this, value)));
  }

  public void remove(V value) {
    if (!(SetSequence.fromSet(values).contains(value))) {
      return;
    }
    SetSequence.fromSet(values).removeElement(value);
    DependencyBroadcaster.INSTANCE.dependenciesChanged(Sequence.<DependencyKey>singleton(new SetContainsDependency(this, value)));
  }

  public boolean contains(V value) {
    boolean contains = SetSequence.fromSet(values).contains(value);
    DependencyBroadcaster.INSTANCE.dependencyAccessed(new SetContainsDependency(this, value));
    return contains;
  }

  public void replaceValues(Set<V> newValues) {
    List<V> changes = SetSequence.fromSet(values).disjunction(SetSequence.fromSet(newValues)).toList();
    SetSequence.fromSet(values).clear();
    SetSequence.fromSet(values).addSequence(SetSequence.fromSet(newValues));
    DependencyBroadcaster.INSTANCE.dependenciesChanged(ListSequence.fromList(changes).select((it) -> new SetContainsDependency(TrackableSet.this, it)));
  }

  public static class SetContainsDependency extends DependencyKey {
    private TrackableSet state;
    private Object value;

    public SetContainsDependency(TrackableSet state, Object value) {
      this.state = state;
      this.value = value;
    }

    @Override
    public boolean equals(Object o) {
      if (this == o) {
        return true;
      }
      if (o == null || this.getClass() != o.getClass()) {
        return false;
      }

      SetContainsDependency that = (SetContainsDependency) o;
      if ((state != null ? !(state.equals(that.state)) : that.state != null)) {
        return false;
      }
      if ((value != null ? !(((Object) value).equals(that.value)) : that.value != null)) {
        return false;
      }

      return true;
    }

    @Override
    public int hashCode() {
      int result = 0;
      result = 31 * result + ((state != null ? ((Object) state).hashCode() : 0));
      result = 31 * result + ((value != null ? value.hashCode() : 0));
      return result;
    }
  }
}
