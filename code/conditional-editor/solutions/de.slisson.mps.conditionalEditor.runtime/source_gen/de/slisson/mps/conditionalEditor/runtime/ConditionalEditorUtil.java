package de.slisson.mps.conditionalEditor.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.descriptor.BaseConceptEditor;
import de.slisson.mps.reflection.runtime.ReflectionUtil;
import java.util.Comparator;
import java.util.logging.Logger;
import java.util.logging.LogManager;
import java.util.logging.Level;

public class ConditionalEditorUtil {
  private static final String editorRegistryClassName = "jetbrains.mps.nodeEditor.cells.AbstractEditorHintsSpecificRegistry";

  public static int getPriority(BaseConceptEditor editor) {
    if (editor instanceof IConditionalEditor) {
      return ((IConditionalEditor) editor).getPriority();
    } else {
      return 0;
    }
  }

  public static void installComparator() {
    Class registryClass = ReflectionUtil.getClass(editorRegistryClassName);
    Comparator<BaseConceptEditor> comp;

    comp = ((Comparator<BaseConceptEditor>) ReflectionUtil.callStaticMethod(registryClass, "compareByHintsSizeDescAndClassName", new Class[0], new Object[0]));
    comp = new PriorityEditorComparator(((Comparator<BaseConceptEditor>) comp));
    ReflectionUtil.writeField(registryClass, null, "ourCompareByHintsSizeDescAndClassName", comp);

    comp = ((Comparator<BaseConceptEditor>) ReflectionUtil.callStaticMethod(registryClass, "compareByHintsSizeDesc", new Class[0], new Object[0]));
    comp = new PriorityEditorComparator(((Comparator<BaseConceptEditor>) comp));
    ReflectionUtil.writeField(registryClass, null, "ourCompareByHintsSizeDesc", comp);

    // disable logging
    Logger logger = LogManager.getLogManager().getLogger(editorRegistryClassName);
    logger.setLevel(Level.OFF);
  }

  public static void uninstallComparator() {
    Class registryClass = ReflectionUtil.getClass(editorRegistryClassName);

    ReflectionUtil.writeField(registryClass, null, "ourCompareByHintsSizeDescAndClassName", null);
    ReflectionUtil.callStaticMethod(registryClass, "compareByHintsSizeDescAndClassName", new Class[0], new Object[0]);

    ReflectionUtil.writeField(registryClass, null, "ourCompareByHintsSizeDesc", null);
    ReflectionUtil.callStaticMethod(registryClass, "compareByHintsSizeDesc", new Class[0], new Object[0]);
  }


}
