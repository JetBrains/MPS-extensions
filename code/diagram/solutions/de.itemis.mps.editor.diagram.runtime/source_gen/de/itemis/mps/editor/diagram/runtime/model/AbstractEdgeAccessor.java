package de.itemis.mps.editor.diagram.runtime.model;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.cells.EditorCell;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import de.itemis.mps.editor.diagram.runtime.DiagramUtil;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.annotations.NotNull;
import java.util.Iterator;
import java.util.Objects;
import de.itemis.mps.editor.diagram.runtime.shape.IShape;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Collections;
import de.itemis.mps.editor.diagram.runtime.jgraph.MyEdgeStyle;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public abstract class AbstractEdgeAccessor extends AbstractDiagramElementAccessor implements IEdgeAccessor {

  protected EditorCell label;

  public AbstractEdgeAccessor(IAccessorKey id) {
    super(id);
  }

  @Override
  public void delete() {
  }
  @Override
  public SNode getSNode() {
    return null;
  }

  @Override
  public boolean hasLayoutData() {
    return getLayoutData() != null;
  }

  @Nullable
  public SNode getLayoutData() {
    return SNodeOperations.as(myDiagramAccessor.getLayoutData(getId()), CONCEPTS.Layout_Connection$zR);
  }

  @Override
  public List<Point> readAnchorPoints() {
    List<Point> result = new ArrayList<Point>();

    SNode data = getLayoutData();
    if (data != null) {
      for (SNode point : ListSequence.fromList(SLinkOperations.getChildren(data, LINKS.anchors$c7Jb))) {
        result.add(new Point(DiagramUtil.parseDoubleSafe(SPropertyOperations.getString(point, PROPS.x$S8bA), 0.0), DiagramUtil.parseDoubleSafe(SPropertyOperations.getString(point, PROPS.y$S8DC), 0.0)));
      }
    }

    return result;
  }

  @NotNull
  protected SNode getOrCreateLayoutData() {
    return SNodeOperations.cast(getOrCreateLayoutData(CONCEPTS.Layout_Connection$zR), CONCEPTS.Layout_Connection$zR);
  }

  @Override
  public void writeAnchorPoints(List<Point> points) {
    SNode layout = getOrCreateLayoutData();

    // write points
    while (points.size() > ListSequence.fromList(SLinkOperations.getChildren(layout, LINKS.anchors$c7Jb)).count()) {
      SLinkOperations.addNewChild(layout, LINKS.anchors$c7Jb, null);
    }
    while (points.size() < ListSequence.fromList(SLinkOperations.getChildren(layout, LINKS.anchors$c7Jb)).count()) {
      ListSequence.fromList(SLinkOperations.getChildren(layout, LINKS.anchors$c7Jb)).removeLastElement();
    }
    {
      Iterator<Point> my_it = ListSequence.fromList(points).iterator();
      Iterator<SNode> theirs_it = ListSequence.fromList(SLinkOperations.getChildren(layout, LINKS.anchors$c7Jb)).iterator();
      Point my_var;
      SNode theirs_var;
      while (my_it.hasNext() && theirs_it.hasNext()) {
        my_var = my_it.next();
        theirs_var = theirs_it.next();
        String x = Double.toString(my_var.getX());
        String y = Double.toString(my_var.getY());
        if (!(x.equals(SPropertyOperations.getString(theirs_var, PROPS.x$S8bA)))) {
          SPropertyOperations.assign(theirs_var, PROPS.x$S8bA, x);
        }
        if (!(y.equals(SPropertyOperations.getString(theirs_var, PROPS.y$S8DC)))) {
          SPropertyOperations.assign(theirs_var, PROPS.y$S8DC, y);
        }
      }
    }
  }

  @Nullable
  @Override
  public RelativePosition readLabelPosition(final EdgeLabelType type) {
    SNode layout = SNodeOperations.as(myDiagramAccessor.getLayoutData(getId()), CONCEPTS.Layout_Connection$zR);
    if (layout == null) {
      return null;
    }
    SNode labelLayout = ListSequence.fromList(SLinkOperations.getChildren(layout, LINKS.labels$sKbi)).findFirst((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.type$QAIl), type.getId()));
    if ((labelLayout == null)) {
      return null;
    }
    SNode labelPosition = SLinkOperations.getTarget(labelLayout, LINKS.position$QG7G);
    if (labelPosition == null) {
      return null;
    }

    Point offset = new Point(DiagramUtil.parseDoubleSafe(SPropertyOperations.getString(SLinkOperations.getTarget(labelPosition, LINKS.offset$C8hI), PROPS.x$S8bA), 0.0), DiagramUtil.parseDoubleSafe(SPropertyOperations.getString(SLinkOperations.getTarget(labelPosition, LINKS.offset$C8hI), PROPS.y$S8DC), 0.0));
    Point referencePoint = new Point(DiagramUtil.parseDoubleSafe(SPropertyOperations.getString(SLinkOperations.getTarget(labelPosition, LINKS.referencePoint$C7NG), PROPS.x$S8bA), 0.0), DiagramUtil.parseDoubleSafe(SPropertyOperations.getString(SLinkOperations.getTarget(labelPosition, LINKS.referencePoint$C7NG), PROPS.y$S8DC), 0.0));
    return new RelativePosition(offset, referencePoint);
  }
  @Override
  public void writeLabelPosition(final EdgeLabelType type, @Nullable RelativePosition pos) {
    SNode layout = getOrCreateLayoutData();
    SNode labelLayout = ListSequence.fromList(SLinkOperations.getChildren(layout, LINKS.labels$sKbi)).findFirst((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.type$QAIl), type.getId()));
    if ((labelLayout == null)) {
      labelLayout = SLinkOperations.addNewChild(layout, LINKS.labels$sKbi, null);
      SPropertyOperations.assign(labelLayout, PROPS.type$QAIl, type.getId());
    }
    if (pos == null) {
      SNodeOperations.deleteNode(SLinkOperations.getTarget(labelLayout, LINKS.position$QG7G));
    } else {

      SNode relPosNode = SLinkOperations.getTarget(labelLayout, LINKS.position$QG7G);
      if ((relPosNode == null)) {
        relPosNode = SLinkOperations.setNewChild(labelLayout, LINKS.position$QG7G, null);
      }
      SNode offset = SLinkOperations.getTarget(relPosNode, LINKS.offset$C8hI);
      if ((offset == null)) {
        offset = SLinkOperations.setNewChild(relPosNode, LINKS.offset$C8hI, null);
      }
      SNode referencePoint = SLinkOperations.getTarget(relPosNode, LINKS.referencePoint$C7NG);
      if ((referencePoint == null)) {
        referencePoint = SLinkOperations.setNewChild(relPosNode, LINKS.referencePoint$C7NG, null);
      }

      if (!(ExtensionMethods.isNear(pos.getOffset().getX(), SPropertyOperations.getString(offset, PROPS.x$S8bA)))) {
        SPropertyOperations.assign(offset, PROPS.x$S8bA, ExtensionMethods.toString(pos.getOffset().getX()));
      }
      if (!(ExtensionMethods.isNear(pos.getOffset().getY(), SPropertyOperations.getString(offset, PROPS.y$S8DC)))) {
        SPropertyOperations.assign(offset, PROPS.y$S8DC, ExtensionMethods.toString(pos.getOffset().getY()));
      }
      if (!(ExtensionMethods.isNear(pos.getReferencePoint().getX(), SPropertyOperations.getString(referencePoint, PROPS.x$S8bA)))) {
        SPropertyOperations.assign(referencePoint, PROPS.x$S8bA, ExtensionMethods.toString(pos.getReferencePoint().getX()));
      }
      if (!(ExtensionMethods.isNear(pos.getReferencePoint().getY(), SPropertyOperations.getString(referencePoint, PROPS.y$S8DC)))) {
        SPropertyOperations.assign(referencePoint, PROPS.y$S8DC, ExtensionMethods.toString(pos.getReferencePoint().getY()));
      }
    }
  }

  @Override
  public IConnectionEndpointReference readFrom() {
    return null;
  }
  @Override
  public IConnectionEndpointReference readTo() {
    return null;
  }
  @Override
  public void writeFrom(IConnectionEndpoint_Internal endpoint) {
  }
  @Override
  public void writeTo(IConnectionEndpoint_Internal endpoint) {
  }
  @Override
  public boolean canWriteFrom(IConnectionEndpoint_Internal endpoint) {
    return false;
  }
  @Override
  public boolean canWriteTo(IConnectionEndpoint_Internal endpoint) {
    return false;
  }

  @Override
  public IShape getStartShape() {
    return null;
  }
  @Override
  public IShape getEndShape() {
    return null;
  }
  @Nullable
  @Override
  public Double getStartShapeSize() {
    return null;
  }
  @Nullable
  @Override
  public Double getEndShapeSize() {
    return null;
  }
  @Override
  public EditorCell getLabelCell() {
    return null;
  }
  @Override
  public EditorCell getStartRoleCell() {
    return null;
  }
  @Override
  public EditorCell getEndRoleCell() {
    return null;
  }
  @Nullable
  @Override
  public EditorCell getLabelCell(EdgeLabelType type) {
    switch (type) {
      case START_ROLE:
        return getStartRoleCell();
      case LABEL:
        return getLabelCell();
      case END_ROLE:
        return getEndRoleCell();
      default:
        throw new RuntimeException("Unknown EdgeLabelType: " + type);
    }
  }

  @Override
  public boolean canSplit(@NotNull SAbstractConcept concept) {
    return false;
  }

  @Override
  public void split(@NotNull Box boxToInsert) {
  }

  @NotNull
  @Override
  public Iterable<SNode> getNavigationTargets() {
    return Sequence.fromIterable(Collections.<SNode>emptyList());
  }

  @Override
  public boolean anySideAllowedFrom() {
    return false;
  }

  @Override
  public boolean anySideAllowedTo() {
    return false;
  }

  @Override
  public boolean isCurved() {
    return false;
  }

  @Override
  public String getEdgeStyle() {
    return MyEdgeStyle.EDGESTYLE;
  }

  public boolean canDrop(Object data) {
    return false;
  }
  public void drop(Object data) {
  }
  public boolean pullAnnotations() {
    return false;
  }

  @Override
  public boolean isVisible() {
    SNode data = getLayoutData();
    return !(SPropertyOperations.getBoolean(data, PROPS.isHidden$qcrQ));
  }

  @Override
  public void setVisible(boolean flag) {
    SNode layout = getOrCreateLayoutData();
    SPropertyOperations.assign(layout, PROPS.isHidden$qcrQ, !(flag));
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Layout_Connection$zR = MetaAdapterFactory.getConcept(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x20308aec9b01dc84L, "de.itemis.mps.editor.diagram.layout.structure.Layout_Connection");
  }

  private static final class PROPS {
    /*package*/ static final SProperty x$S8bA = MetaAdapterFactory.getProperty(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x20308aec9b01dc07L, 0x20308aec9b01dc8dL, "x");
    /*package*/ static final SProperty y$S8DC = MetaAdapterFactory.getProperty(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x20308aec9b01dc07L, 0x20308aec9b01dc8fL, "y");
    /*package*/ static final SProperty type$QAIl = MetaAdapterFactory.getProperty(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x4229f8fa9c7da3bbL, 0x4229f8fa9c7da3d7L, "type");
    /*package*/ static final SProperty isHidden$qcrQ = MetaAdapterFactory.getProperty(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x20308aec9b01dc84L, 0xfac989e07bb1b6aL, "isHidden");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink anchors$c7Jb = MetaAdapterFactory.getContainmentLink(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x20308aec9b01dc84L, 0x20308aec9b01dd7dL, "anchors");
    /*package*/ static final SContainmentLink labels$sKbi = MetaAdapterFactory.getContainmentLink(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x20308aec9b01dc84L, 0x4229f8fa9c7da3dbL, "labels");
    /*package*/ static final SContainmentLink position$QG7G = MetaAdapterFactory.getContainmentLink(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x4229f8fa9c7da3bbL, 0x4229f8fa9c7da3d9L, "position");
    /*package*/ static final SContainmentLink offset$C8hI = MetaAdapterFactory.getContainmentLink(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x2d252180cd404e41L, 0x2d252180cd404e77L, "offset");
    /*package*/ static final SContainmentLink referencePoint$C7NG = MetaAdapterFactory.getContainmentLink(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x2d252180cd404e41L, 0x2d252180cd404e75L, "referencePoint");
  }
}
