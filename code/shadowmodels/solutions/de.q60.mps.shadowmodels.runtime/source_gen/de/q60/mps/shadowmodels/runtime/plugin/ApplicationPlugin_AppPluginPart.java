package de.q60.mps.shadowmodels.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.plugins.part.ApplicationPluginPart;
import de.q60.mps.shadowmodels.runtime.smodel.SM_RepositoryChangeTranslator;
import de.q60.mps.incremental.runtime.DependencyKey;
import de.q60.mps.incremental.runtime.DependencyBroadcaster;
import de.q60.mps.shadowmodels.runtime.concurrentrepo.RepositoryMirror;
import jetbrains.mps.smodel.MPSModuleRepository;
import jetbrains.mps.ide.MPSCoreComponents;
import jetbrains.mps.persistence.PersistenceRegistry;
import de.q60.mps.shadowmodels.runtime.editor.TransformationEngineForEditor;
import de.q60.mps.shadowmodels.runtime.smodel.SM_TransformationsFromGlobalRepository;
import de.q60.mps.shadowmodels.runtime.smodel.ShadowModelsAPI;

public class ApplicationPlugin_AppPluginPart extends ApplicationPluginPart {
  private SM_RepositoryChangeTranslator changeTranslator = new SM_RepositoryChangeTranslator() {
    protected void dependenciesChanged(Iterable<DependencyKey> deps) {
      DependencyBroadcaster.INSTANCE.dependenciesChanged(deps);
    }
  };
  private RepositoryMirror mirror;
  public ApplicationPlugin_AppPluginPart() {
  }
  @Override
  public void init() {
    OptionalPlugin_ShadowRepository.INSTANCE.moduleInitialized();
    MPSModuleRepository moduleRepository = MPSCoreComponents.getInstance().getPlatform().findComponent(MPSModuleRepository.class);
    ApplicationPlugin_AppPluginPart.this.changeTranslator.start(moduleRepository);
    MPSCoreComponents.getInstance().getPlatform().findComponent(PersistenceRegistry.class).addFindUsagesParticipant(ShadowModelFindUsagesParticipant.INSTANCE);
    ApplicationPlugin_AppPluginPart.this.mirror = new RepositoryMirror(moduleRepository);
    RepositoryMirror.setInstance(ApplicationPlugin_AppPluginPart.this.mirror);
  }
  @Override
  public void dispose() {
    ApplicationPlugin_AppPluginPart.this.changeTranslator.stop();
    TransformationEngineForEditor.disposeAll();
    OptionalPlugin_ShadowRepository.INSTANCE.moduleDisposed();
    MPSCoreComponents.getInstance().getPlatform().findComponent(PersistenceRegistry.class).removeFindUsagesParticipant(ShadowModelFindUsagesParticipant.INSTANCE);
    SM_TransformationsFromGlobalRepository.getInstance().dispose();
    ApplicationPlugin_AppPluginPart.this.mirror.dispose();
    ApplicationPlugin_AppPluginPart.this.mirror = null;
    RepositoryMirror.setInstance(null);
    ShadowModelsAPI.dispose();
  }
}
