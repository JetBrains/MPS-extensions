package de.itemis.mps.editor.bool.runtime;

/*Generated by MPS */

import org.jetbrains.mps.openapi.module.SRepository;
import java.awt.Image;
import java.awt.image.ImageObserver;
import org.jetbrains.mps.openapi.model.SNode;
import java.awt.Graphics;
import jetbrains.mps.nodeEditor.EditorComponent;
import java.awt.Graphics2D;
import java.awt.BasicStroke;
import com.intellij.ui.JBColor;

public class CheckboxImages {
  private final SRepository myRepository;
  private Image myImageTrue;
  private Image myImageFalse;
  private double myWidthScaled;
  private double myHeightScaled;
  private boolean myIsChecked;
  private double myScaleTrue = 1.0;
  private double myScaleFalse = 1.0;

  private ImageObserver sizeObserver = new ImageObserver() {
    public boolean imageUpdate(Image img, int infoflags, int x, int y, int width, int height) {
      boolean widthOrHeightChanged = (infoflags & (HEIGHT | WIDTH)) != 0;
      if (widthOrHeightChanged) {
        updateSize();
      }
      return widthOrHeightChanged;
    }
  };

  public CheckboxImages(SRepository repository) {
    myRepository = repository;
    updateSize();
  }

  public void setScaleTrue(double scale) {
    myScaleTrue = scale;
    updateSize();
  }

  public void setScaleFalse(double scale) {
    myScaleFalse = scale;
    updateSize();
  }

  public void setImageTrue(String path, SNode node) {
    myImageTrue = ImageLoading.loadImage(myRepository, path, node);
    updateSize();
  }

  public void setImageFalse(String path, SNode node) {
    myImageFalse = ImageLoading.loadImage(myRepository, path, node);
    updateSize();
  }

  protected void updateSize() {
    myWidthScaled = (int) Math.max(((myImageTrue == null ? 0 : myImageTrue.getWidth(sizeObserver) * myScaleTrue)), ((myImageFalse == null ? 0 : myImageFalse.getWidth(sizeObserver) * myScaleFalse)));
    myHeightScaled = (int) Math.max(((myImageTrue == null ? 0 : myImageTrue.getHeight(sizeObserver) * myScaleTrue)), ((myImageFalse == null ? 0 : myImageFalse.getHeight(sizeObserver) * myScaleFalse)));

    if (myWidthScaled == 0.0 && myHeightScaled == 0.0) {
      myWidthScaled = 12;
      myHeightScaled = 12;
    }

  }

  public void paint(Graphics g, int x, int y, EditorComponent editorComponent) {
    Image image = (myIsChecked ? myImageTrue : myImageFalse);
    double scale = (myIsChecked ? myScaleTrue : myScaleFalse);
    int widthUnscaled = (int) (myWidthScaled / scale);
    int heightUnscaled = (int) (myHeightScaled / scale);
    int widthScaledInt = ((int) myWidthScaled);
    int heightScaledInt = ((int) myHeightScaled);

    if (image != null) {
      int offsetX = (int) ((widthUnscaled - image.getWidth(sizeObserver)) / 2 * scale);
      int offsetY = (int) ((heightUnscaled - image.getHeight(sizeObserver)) / 2 * scale);

      g = g.create();
      Graphics2D g2d = as_tospi5_a0a4a7a32(g, Graphics2D.class);
      if (g2d != null) {
        g2d.scale(scale, scale);
        g2d.translate((x + offsetX) / scale, (y + offsetY) / scale);
      }
      g.drawImage(image, 0, 0, editorComponent);
      g.dispose();
    } else {

      int dcWidth = widthScaledInt - 1;
      int dcHeight = heightScaledInt - 1;
      int dcX = x;
      int dcY = y + 1;

      Graphics2D g2d = ((Graphics2D) g.create());
      g2d.setStroke(new BasicStroke(2));
      g2d.setColor(JBColor.BLACK);
      g2d.drawRect(dcX, dcY, dcWidth, dcHeight);

      if (myIsChecked) {
        g2d.drawLine(dcX + 4, dcY + 4, dcX + dcWidth - 4, dcY + dcHeight - 4);
        g2d.drawLine(dcX + 4, dcY + dcWidth - 4, dcX + dcHeight - 4, dcY + 4);
      }
      g2d.dispose();
    }
  }

  public void setChecked(boolean newValue) {
    myIsChecked = newValue;
  }

  public int getWidth() {
    return (int) myWidthScaled;
  }

  public int getHeight() {
    return (int) myHeightScaled;
  }


  private static <T> T as_tospi5_a0a4a7a32(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
