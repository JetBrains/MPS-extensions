package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import org.eclipse.elk.core.util.BoxLayoutProvider;
import java.util.EnumSet;
import org.eclipse.elk.core.options.ContentAlignment;
import org.eclipse.elk.core.options.BoxLayouterOptions;
import org.eclipse.elk.graph.ElkNode;
import org.eclipse.elk.core.util.IElkProgressMonitor;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.editor.runtime.style.StyleAttributes;

public class BoxLayouter extends ElkLayouter {

  protected double aspectRatio;
  protected BoxLayoutProvider.PackingMode packingMode;
  protected EnumSet<ContentAlignment> contentAlignment;
  protected boolean expandNodes;
  protected double nodeSpacing;

  public BoxLayouter() {
    super();
    myAlgorithm = BoxLayouterOptions.ALGORITHM_ID;
  }

  @Override
  public boolean canLayoutLabels() {
    return true;
  }
  @Override
  protected boolean useDummyPort(EdgeDCell edge, boolean isTarget) {
    return false;
  }

  @Override
  protected void addLayoutInformationToGraph(ElkNode graph, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToGraph(graph, progressMonitor);
    ElkNode layout = graph;
    layout.setProperty(BoxLayouterOptions.ASPECT_RATIO, aspectRatio);
    layout.setProperty(BoxLayouterOptions.BOX_PACKING_MODE, packingMode);
    layout.setProperty(BoxLayouterOptions.CONTENT_ALIGNMENT, contentAlignment);
    layout.setProperty(BoxLayouterOptions.EXPAND_NODES, expandNodes);
    layout.setProperty(BoxLayouterOptions.SPACING_NODE_NODE, nodeSpacing);

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(graph, "graph", progressMonitor);
    }
  }

  @Override
  public void setParentsStyle(Style style) {
    super.setParentsStyle(style);
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-aspect-ratio"))) {
      aspectRatio = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-aspect-ratio"));
    }
    packingMode = style.get(StyleAttributes.getInstance().<BoxLayoutProvider.PackingMode>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-box-layout-mode"));
    contentAlignment = style.get(StyleAttributes.getInstance().<EnumSet<ContentAlignment>>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-content-alignment"));
    expandNodes = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-expand-nodes"));
    nodeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-node-spacing"));
  }
}
