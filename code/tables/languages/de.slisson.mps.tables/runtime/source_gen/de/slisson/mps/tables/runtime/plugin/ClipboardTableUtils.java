package de.slisson.mps.tables.runtime.plugin;

/*Generated by MPS */

import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.StringSelection;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import java.io.IOException;
import java.awt.datatransfer.UnsupportedFlavorException;
import java.awt.datatransfer.Clipboard;
import java.awt.Toolkit;

public class ClipboardTableUtils {

  private static final DataFlavor SUPPORTED_FLAVOR = DataFlavor.stringFlavor;

  public static void putIntoOSClipboard(TableData<String> data, TableDataSeparator separator) {
    StringSelection clipboardContent = new StringSelection(data.toFlatString(separator));
    getClipboard().setContents(clipboardContent, null);
  }

  public static boolean isSupportedFlavorAvailableInClipboard() {
    return Sequence.fromIterable(Sequence.fromArray(getClipboard().getAvailableDataFlavors())).contains(SUPPORTED_FLAVOR);
  }

  public static TableData<SNode> fromClipboard(SNode table, TableDataSeparator elementSeparator, EditorContext editorContext) {
    String clipboardContent;
    try {
      clipboardContent = ((String) getClipboard().getData(DataFlavor.stringFlavor));
    } catch (IOException | UnsupportedFlavorException e) {
      throw new RuntimeException(e);
    }

    TableData<String> dataAsString = new TableDataParser(elementSeparator).fromString(clipboardContent);
    return TableTransformationManager.stringDataToNodeData(table, dataAsString, editorContext);
  }

  private static Clipboard getClipboard() {
    return Toolkit.getDefaultToolkit().getSystemClipboard();
  }
}
