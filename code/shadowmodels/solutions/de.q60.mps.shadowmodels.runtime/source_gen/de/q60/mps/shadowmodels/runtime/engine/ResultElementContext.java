package de.q60.mps.shadowmodels.runtime.engine;

/*Generated by MPS */

import org.modelix.model.api.IConcept;

public class ResultElementContext extends BuilderContextWrapper implements IBuilderContext {

  protected final TransformationResult.ResultElement element;

  public ResultElementContext(IBuilderContext parentContext1, IResultElement element1) {
    super(parentContext1);
    element = ((TransformationResult.ResultElement) element1);
  }

  @Override
  public IBuilderContext createNode(IConcept concept, IBuilderContext topmost) {
    String role = topmost.getParameter(BuilderContextParameter.ROLE);
    String localLabel = topmost.getParameter(BuilderContextParameter.LOCAL_LABEL);
    IScope scope = topmost.getParameter(BuilderContextParameter.SCOPE);
    String id = idWithPrefix(topmost);
    if (role == null) {
      throw new UnsupportedOperationException("Role required");
    }
    IBuilderContext resultContext = new ResultElementContext(topmost, element.createChild(role, id, concept, scope));

    if (localLabel != null) {
      resultContext.getResultElement().addLabel(localLabel);
      resultContext = resultContext.withLabel(null);
    }

    MappingLabelCall labelCall = topmost.getParameter(BuilderContextParameter.MAPPING_LABEL);
    if (labelCall != null) {
      getTransformationResult().mappingLabels().putEntry(labelCall, resultContext.getResultElement().getCanonicalReference());
      resultContext = resultContext.withParameter(BuilderContextParameter.MAPPING_LABEL, null);
    }

    return resultContext;
  }

  @Override
  public void createNode(IContainmentTarget call, IBuilderContext topmost) {
    String role = topmost.getParameter(BuilderContextParameter.ROLE);
    String label = topmost.getParameter(BuilderContextParameter.LOCAL_LABEL);
    if (role == null) {
      throw new UnsupportedOperationException("Role required");
    }
    if (label != null) {
      throw new UnsupportedOperationException("Label not supported yet");
    }
    IScope scope = topmost.getParameter(BuilderContextParameter.SCOPE);
    IUniqueContainmentTarget<IContainmentTarget> registeredChild = element.addChild(role, call, scope);

    MappingLabelCall labelCall = topmost.getParameter(BuilderContextParameter.MAPPING_LABEL);
    if (labelCall != null) {
      getTransformationResult().mappingLabels().putEntry(labelCall, new ContainmentTargetRootNodes(getEngine().getCurrentContext(), registeredChild));
    }
  }

  @Override
  public TransformationResult.ResultElement getResultElement() {
    return element;
  }
}
