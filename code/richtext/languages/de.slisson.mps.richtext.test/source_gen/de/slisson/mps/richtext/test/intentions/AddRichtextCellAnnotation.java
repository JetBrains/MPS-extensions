package de.slisson.mps.richtext.test.intentions;

/*Generated by MPS */

import de.itemis.mps.selection.runtime.intentions.AbstractSelectionIntentionFactory;
import java.util.List;
import de.itemis.mps.selection.runtime.intentions.ISelectionIntentionExecutable;
import de.slisson.mps.richtext.runtime.selection.RichtextSelection;
import de.itemis.mps.selection.runtime.intentions.AbstractSelectionIntentionExecutable;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.action.SNodeFactoryOperations;
import jetbrains.mps.nodeEditor.inspector.InspectorEditorComponent;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.editor.runtime.selection.SelectionUtil;
import java.util.Collections;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public class AddRichtextCellAnnotation extends AbstractSelectionIntentionFactory {
  public AddRichtextCellAnnotation() {
  }

  @Override
  public List<ISelectionIntentionExecutable> getInstances(Object selection) {
    if (selection instanceof RichtextSelection) {
      ISelectionIntentionExecutable intention = new AbstractSelectionIntentionExecutable<RichtextSelection>() {
        @Override
        public void execute(RichtextSelection selection) {
          SNode node = selection.getSelectedNodes().get(0);
          EditorContext editorContext = selection.getEditorComponent().getEditorContext();

          SNode ancessor = node;
          while (ancessor != null && !(SNodeOperations.isInstanceOf(SNodeOperations.getParent(ancessor), CONCEPTS.EditorTestCase$DN))) {
            ancessor = SNodeOperations.getParent(ancessor);
          }
          SNode newAnnotation = SNodeFactoryOperations.createNewNode(CONCEPTS.RichtextCellAnnotation$2h, null);
          if (editorContext.getEditorComponent() instanceof InspectorEditorComponent) {
            SPropertyOperations.assign(newAnnotation, PROPS.isInInspector$o8Js, true);
          }

          SPropertyOperations.assign(newAnnotation, PROPS.textStartPos$AcB4, selection.getStartTextPos());
          SPropertyOperations.assign(newAnnotation, PROPS.textEndPos$Ad56, selection.getEndTextPos());
          SPropertyOperations.assign(newAnnotation, PROPS.caretPosition$nUja, selection.getCursorCell().getCaretX());

          SPropertyOperations.assign(newAnnotation, PROPS.name$MnvL, "richtext");
          ListSequence.fromList(new IAttributeDescriptor.NodeAttribute(CONCEPTS.RichtextCellAnnotation$2h).list(node)).addElement(newAnnotation);
          SelectionUtil.selectNode(editorContext, newAnnotation);
        }
        @Override
        public String getDescription(RichtextSelection selection) {
          return "Add Richtext Test Annotation (Record Cursor State)";
        }
        @Override
        public boolean isApplicable(RichtextSelection selection) {
          SNode node = selection.getSelectedNodes().get(0);
          return SNodeOperations.isInstanceOf(SNodeOperations.getParent(SNodeOperations.getNodeAncestor(node, CONCEPTS.TestNode$zF, false, false)), CONCEPTS.EditorTestCase$DN);
        }
      };
      return Collections.singletonList(intention);
    } else {
      return Collections.<ISelectionIntentionExecutable>emptyList();
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept EditorTestCase$DN = MetaAdapterFactory.getConcept(0x8585453e6bfb4d80L, 0x98deb16074f1d86cL, 0x11e314b20e0L, "jetbrains.mps.lang.test.structure.EditorTestCase");
    /*package*/ static final SConcept RichtextCellAnnotation$2h = MetaAdapterFactory.getConcept(0x72aaeb1cfe8a4e47L, 0x87d1ddb7621d2773L, 0x2bd382fd31f23fd6L, "de.slisson.mps.richtext.test.structure.RichtextCellAnnotation");
    /*package*/ static final SConcept TestNode$zF = MetaAdapterFactory.getConcept(0x8585453e6bfb4d80L, 0x98deb16074f1d86cL, 0x11b5a38fc01L, "jetbrains.mps.lang.test.structure.TestNode");
  }

  private static final class PROPS {
    /*package*/ static final SProperty isInInspector$o8Js = MetaAdapterFactory.getProperty(0x72aaeb1cfe8a4e47L, 0x87d1ddb7621d2773L, 0x2bd382fd31f23fd6L, 0x1b73330fb1241e01L, "isInInspector");
    /*package*/ static final SProperty textStartPos$AcB4 = MetaAdapterFactory.getProperty(0x72aaeb1cfe8a4e47L, 0x87d1ddb7621d2773L, 0x2bd382fd31f23fd6L, 0x56ffc0a94fe5fc33L, "textStartPos");
    /*package*/ static final SProperty textEndPos$Ad56 = MetaAdapterFactory.getProperty(0x72aaeb1cfe8a4e47L, 0x87d1ddb7621d2773L, 0x2bd382fd31f23fd6L, 0x56ffc0a94fe5fc35L, "textEndPos");
    /*package*/ static final SProperty caretPosition$nUja = MetaAdapterFactory.getProperty(0x72aaeb1cfe8a4e47L, 0x87d1ddb7621d2773L, 0x2bd382fd31f23fd6L, 0x11e31babe14L, "caretPosition");
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
