package de.q60.mps.shadowmodels.runtime.mpslike;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.internal.collections.runtime.Sequence;

public class GenplanRule_After extends GenplanRule {

  public GenplanRule_After(Iterable<MappingConfigurationId> mappingConfiguration1, Iterable<MappingConfigurationId> mappingConfiguration2) {
    super(mappingConfiguration1, mappingConfiguration2);
  }

  @Override
  public Genplan apply(Genplan plan, Map<MappingConfigurationId, MappingConfiguration> mcs, int timeout) {
    for (MappingConfigurationId mc1 : Sequence.fromIterable(getMappingConfiguration1())) {
      for (MappingConfigurationId mc2 : Sequence.fromIterable(getMappingConfiguration2())) {
        int index1 = plan.getStepNumber(mc1);
        if (index1 == -1) {
          return plan;
        }
        int index2 = plan.getStepNumber(mc2);
        if (index2 == -1) {
          return plan;
        }
        if (index1 > index2) {
          return plan;
        }

        switch (timeout % 2) {
          case 0:
            plan = plan.moveTo(index2 + 1, mc1);
            break;
          case 1:
            if (index1 == 0) {
              plan = plan.insertStep(0);
              index1++;
              index2++;
            }
            plan = plan.moveTo(index1 - 1, mc1);
            break;
          default:
            throw new RuntimeException();
        }
      }
    }
    return plan;
  }
}
