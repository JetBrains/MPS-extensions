package de.itemis.model.merge.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import java.util.Set;
import org.jetbrains.mps.openapi.language.SLanguage;
import jetbrains.mps.smodel.language.LanguageRegistry;
import de.itemis.model.merge.runtime.runtime.MergerResolverImpl;
import java.util.Collection;
import de.itemis.model.merge.runtime.runtime.ConceptPropertyAction;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import org.apache.commons.lang3.tuple.Pair;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.google.common.collect.ImmutableMap;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.Collections;
import jetbrains.mps.smodel.SLanguageHierarchy;
import com.google.common.collect.Sets;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import com.google.common.collect.Lists;
import de.itemis.model.merge.runtime.runtime.PolicyMergerResolver;
import de.itemis.model.merge.runtime.runtime.MapWrapper;
import de.itemis.model.merge.runtime.runtime.ContentHolder;
import de.itemis.model.merge.runtime.runtime.PropertyMerger;
import java.util.Deque;
import jetbrains.mps.internal.collections.runtime.LinkedListSequence;
import java.util.LinkedList;
import java.util.HashSet;
import de.itemis.model.merge.runtime.runtime.SimpleActionContentHolder;
import org.apache.commons.lang3.tuple.ImmutablePair;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.behavior.LanguageIdentity__BehaviorDescriptor;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public final class ModelMergingPolicy__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42dcce87L, "de.itemis.model.merge.structure.ModelMergingPolicy");

  public static final SMethod<Map<SNode, SNode>> conceptToDefinedMergePolicy_id3xJ_LYXj1c6 = new SMethodBuilder<Map<SNode, SNode>>(new SJavaCompoundTypeImpl((Class<Map<SNode, SNode>>) ((Class) Object.class))).name("conceptToDefinedMergePolicy").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4066635151114507014L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  public static final SMethod<Iterable<SAbstractConcept>> languageConcepts_id3xJ_LYXlmVz = new SMethodBuilder<Iterable<SAbstractConcept>>(new SJavaCompoundTypeImpl((Class<Iterable<SAbstractConcept>>) ((Class) Object.class))).name("languageConcepts").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4066635151115120355L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  public static final SMethod<Set<SLanguage>> aggregatedLanguagesTrans_id78fCHIEgrbf = new SMethodBuilder<Set<SLanguage>>(new SJavaCompoundTypeImpl((Class<Set<SLanguage>>) ((Class) Object.class))).name("aggregatedLanguagesTrans").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8218966909312414415L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2(SMethodBuilder.createJavaParameter(SLanguage.class, ""), SMethodBuilder.createJavaParameter(LanguageRegistry.class, ""));
  public static final SMethod<Iterable<SNode>> languageConceptsSnodes_idZzVzivLDVk = new SMethodBuilder<Iterable<SNode>>(new SJavaCompoundTypeImpl((Class<Iterable<SNode>>) ((Class) Object.class))).name("languageConceptsSnodes").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1145020640068542164L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  public static final SMethod<SNode> toAbstractConceptDeclaration_id6XtVDsmtlME = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("toAbstractConceptDeclaration").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8024832443728354474L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2(SMethodBuilder.createJavaParameter(SAbstractConcept.class, ""));
  public static final SMethod<MergerResolverImpl> mergePoliciesByHierarchy_id2QNuyuiMzB2 = new SMethodBuilder<MergerResolverImpl>(new SJavaCompoundTypeImpl(MergerResolverImpl.class)).name("mergePoliciesByHierarchy").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3293110062923004354L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  public static final SMethod<Collection<ConceptPropertyAction>> conceptPropertyAction_id3Wln5KIUgw5 = new SMethodBuilder<Collection<ConceptPropertyAction>>(new SJavaCompoundTypeImpl((Class<Collection<ConceptPropertyAction>>) ((Class) Object.class))).name("conceptPropertyAction").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4545640949894154245L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  public static final SMethod<String> globalId_id28CFLxJaWOS = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("globalId").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(2461409715837193528L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  public static final SMethod<Iterable<SNode>> missingConcepts_id2BHsX07250y = new SMethodBuilder<Iterable<SNode>>(new SJavaCompoundTypeImpl((Class<Iterable<SNode>>) ((Class) Object.class))).name("missingConcepts").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3021198262343847970L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2();
  /*package*/ static final SMethod<Iterable<SAbstractConcept>> languageConcepts_id78fCHIE_fQQ = new SMethodBuilder<Iterable<SAbstractConcept>>(new SJavaCompoundTypeImpl((Class<Iterable<SAbstractConcept>>) ((Class) Object.class))).name("languageConcepts").modifiers(0, AccessPrivileges.PRIVATE).concept(CONCEPT).baseMethodId(8218966909317873078L).languageId(0xa5fd25dd10137a55L, 0x539e893908ef497cL).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(conceptToDefinedMergePolicy_id3xJ_LYXj1c6, languageConcepts_id3xJ_LYXlmVz, aggregatedLanguagesTrans_id78fCHIEgrbf, languageConceptsSnodes_idZzVzivLDVk, toAbstractConceptDeclaration_id6XtVDsmtlME, mergePoliciesByHierarchy_id2QNuyuiMzB2, conceptPropertyAction_id3Wln5KIUgw5, globalId_id28CFLxJaWOS, missingConcepts_id2BHsX07250y, languageConcepts_id78fCHIE_fQQ);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static Map<SNode, SNode> conceptToDefinedMergePolicy_id3xJ_LYXj1c6(@NotNull SNode __thisNode__) {
    List<Pair<SNode, SNode>> conceptMergepolicyPairs = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(__thisNode__, LINKS.policies$z8dk), CONCEPTS.ConceptMergingPolicy$RB)).select((mp) -> Pair.of(SLinkOperations.getTarget(mp, LINKS.conceptRef$p8vY), mp)).toList();
    return ImmutableMap.copyOf(conceptMergepolicyPairs);
  }
  /*package*/ static Iterable<SAbstractConcept> languageConcepts_id3xJ_LYXlmVz(@NotNull final SNode __thisNode__) {
    SNode lang = SLinkOperations.getTarget(__thisNode__, LINKS.lang$Bfub);
    return ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.additonalLangs$4QIM)).union(SetSequence.fromSet(Collections.singleton(lang))).translate((it) -> ((Iterable<SAbstractConcept>) ModelMergingPolicy__BehaviorDescriptor.languageConcepts_id78fCHIE_fQQ.invokeSpecial(__thisNode__, it))).distinct();
  }
  /*package*/ static Set<SLanguage> aggregatedLanguagesTrans_id78fCHIEgrbf(@NotNull final SNode __thisNode__, SLanguage lang, final LanguageRegistry lr) {
    SLanguageHierarchy hierarchy = new SLanguageHierarchy(lr, Collections.singleton(lang));
    Set<SLanguage> aggregated = hierarchy.getAggregated();
    Set<SLanguage> transAggregated = Sets.newHashSet(Sets.newHashSet(SetSequence.fromSet(aggregated).translate(new _FunctionTypes._return_P1_E0<Iterable<SLanguage>, SLanguage>() {
      public Iterable<SLanguage> invoke(SLanguage lang) {
        return ((Set<SLanguage>) ModelMergingPolicy__BehaviorDescriptor.aggregatedLanguagesTrans_id78fCHIEgrbf.invoke(__thisNode__, lang, lr));
      }
    })));
    return Sets.newHashSet(SetSequence.fromSet(aggregated).union(SetSequence.fromSet(transAggregated)));
  }
  /*package*/ static Iterable<SNode> languageConceptsSnodes_idZzVzivLDVk(@NotNull final SNode __thisNode__) {
    List<SAbstractConcept> concepts = Lists.newArrayList(ModelMergingPolicy__BehaviorDescriptor.languageConcepts_id3xJ_LYXlmVz.invoke(__thisNode__));
    return (ListSequence.fromList(concepts).select((it) -> ((SNode) ModelMergingPolicy__BehaviorDescriptor.toAbstractConceptDeclaration_id6XtVDsmtlME.invoke(__thisNode__, it))));
  }
  /*package*/ static SNode toAbstractConceptDeclaration_id6XtVDsmtlME(@NotNull SNode __thisNode__, SAbstractConcept sac) {
    return (SNode) (sac.getSourceNode().resolve((SLinkOperations.getTarget(__thisNode__, LINKS.lang$Bfub)).getModel().getRepository()));
  }
  /*package*/ static MergerResolverImpl mergePoliciesByHierarchy_id2QNuyuiMzB2(@NotNull SNode __thisNode__) {
    return PolicyMergerResolver.run(__thisNode__);
  }
  /*package*/ static Collection<ConceptPropertyAction> conceptPropertyAction_id3Wln5KIUgw5(@NotNull SNode __thisNode__) {
    ImmutableMap<SAbstractConcept, MapWrapper<SNode, ContentHolder<PropertyMerger>>> propertyMergePolicy = PolicyMergerResolver.run(__thisNode__).propertyMergePolicy;

    Deque<ConceptPropertyAction> result = LinkedListSequence.fromLinkedList(new LinkedList<ConceptPropertyAction>());
    for (Map.Entry<SAbstractConcept, MapWrapper<SNode, ContentHolder<PropertyMerger>>> entry : SetSequence.fromSet(propertyMergePolicy.entrySet())) {
      SAbstractConcept sac = entry.getKey();
      Set<Pair<SNode, SNode>> result2 = SetSequence.fromSet(new HashSet<Pair<SNode, SNode>>());
      for (Map.Entry<SNode, ContentHolder<PropertyMerger>> pds : SetSequence.fromSet(entry.getValue().entries())) {
        SNode pd = pds.getKey();
        SimpleActionContentHolder stuff = ((SimpleActionContentHolder) pds.getValue());
        SNode mergeAction = ((SNode) stuff.mergeAction);
        SetSequence.fromSet(result2).addElement(ImmutablePair.of(pd, mergeAction));
      }
      LinkedListSequence.fromLinkedListNew(result).addElement(new ConceptPropertyAction(sac, result2));
    }
    return result;
  }
  /*package*/ static String globalId_id28CFLxJaWOS(@NotNull SNode __thisNode__) {
    return SPropertyOperations.getString(__thisNode__, PROPS.name$MnvL) + "_" + (SNodeOperations.getPointer(__thisNode__).getNodeId());
  }
  /*package*/ static Iterable<SNode> missingConcepts_id2BHsX07250y(@NotNull final SNode __thisNode__) {
    Iterable<SNode> languageConcepts = Sequence.fromIterable(ModelMergingPolicy__BehaviorDescriptor.languageConcepts_id3xJ_LYXlmVz.invoke(__thisNode__)).select((it) -> ((SNode) ModelMergingPolicy__BehaviorDescriptor.toAbstractConceptDeclaration_id6XtVDsmtlME.invoke(__thisNode__, it)));
    Iterable<SNode> conceptsWithPolicies = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(__thisNode__, LINKS.policies$z8dk), CONCEPTS.ConceptMergingPolicy$RB)).select((it) -> SLinkOperations.getTarget(it, LINKS.conceptRef$p8vY)).distinct();
    return Sequence.fromIterable(languageConcepts).subtract(Sequence.fromIterable(conceptsWithPolicies));
  }
  /*package*/ static Iterable<SAbstractConcept> languageConcepts_id78fCHIE_fQQ(@NotNull SNode __thisNode__, SNode lang) {
    {
      final SNode li = SLinkOperations.getTarget(lang, LINKS.languageId$xSH1);
      if (SNodeOperations.isInstanceOf(li, CONCEPTS.LanguageIdentity$cN)) {
        if (SNodeOperations.getConcept(li).isAbstract()) {
          return Collections.emptyList();
        }
        SLanguage language = LanguageIdentity__BehaviorDescriptor.getLanguage_id34EJa6aIcyj.invoke(li);
        LanguageRegistry lr = LanguageRegistry.getInstance();
        Set<SLanguage> agg = ModelMergingPolicy__BehaviorDescriptor.aggregatedLanguagesTrans_id78fCHIEgrbf.invoke(__thisNode__, language, lr);
        Iterable<SAbstractConcept> concepts = language.getConcepts();
        return SetSequence.fromSet(agg).translate((it) -> it.getConcepts()).union(Sequence.fromIterable(concepts)).distinct();
      }
    }
    return Collections.emptyList();
  }

  /*package*/ ModelMergingPolicy__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((Map<SNode, SNode>) conceptToDefinedMergePolicy_id3xJ_LYXj1c6(node));
      case 1:
        return (T) ((Iterable<SAbstractConcept>) languageConcepts_id3xJ_LYXlmVz(node));
      case 2:
        return (T) ((Set<SLanguage>) aggregatedLanguagesTrans_id78fCHIEgrbf(node, (SLanguage) parameters[0], (LanguageRegistry) parameters[1]));
      case 3:
        return (T) ((Iterable<SNode>) languageConceptsSnodes_idZzVzivLDVk(node));
      case 4:
        return (T) ((SNode) toAbstractConceptDeclaration_id6XtVDsmtlME(node, (SAbstractConcept) parameters[0]));
      case 5:
        return (T) ((MergerResolverImpl) mergePoliciesByHierarchy_id2QNuyuiMzB2(node));
      case 6:
        return (T) ((Collection<ConceptPropertyAction>) conceptPropertyAction_id3Wln5KIUgw5(node));
      case 7:
        return (T) ((String) globalId_id28CFLxJaWOS(node));
      case 8:
        return (T) ((Iterable<SNode>) missingConcepts_id2BHsX07250y(node));
      case 9:
        return (T) ((Iterable<SAbstractConcept>) languageConcepts_id78fCHIE_fQQ(node, (SNode) parameters[0]));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink policies$z8dk = MetaAdapterFactory.getContainmentLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42dcce87L, 0x1a8b8d3e42de4bf6L, "policies");
    /*package*/ static final SReferenceLink conceptRef$p8vY = MetaAdapterFactory.getReferenceLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, 0x39f51297bd7a5aedL, "conceptRef");
    /*package*/ static final SContainmentLink lang$Bfub = MetaAdapterFactory.getContainmentLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42dcce87L, 0x1ed6b4fde203a345L, "lang");
    /*package*/ static final SContainmentLink additonalLangs$4QIM = MetaAdapterFactory.getContainmentLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42dcce87L, 0x720fa2dbaa87f154L, "additonalLangs");
    /*package*/ static final SContainmentLink languageId$xSH1 = MetaAdapterFactory.getContainmentLink(0x7866978ea0f04cc7L, 0x81bc4d213d9375e1L, 0x3e6a40ba27dd70f3L, 0x312abca18ab995e2L, "languageId");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConceptMergingPolicy$RB = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, "de.itemis.model.merge.structure.ConceptMergingPolicy");
    /*package*/ static final SInterfaceConcept LanguageIdentity$cN = MetaAdapterFactory.getInterfaceConcept(0x7866978ea0f04cc7L, 0x81bc4d213d9375e1L, 0x312abca18ab8c318L, "jetbrains.mps.lang.smodel.structure.LanguageIdentity");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
