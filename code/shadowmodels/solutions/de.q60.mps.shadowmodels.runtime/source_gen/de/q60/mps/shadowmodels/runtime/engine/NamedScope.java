package de.q60.mps.shadowmodels.runtime.engine;

/*Generated by MPS */

import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Objects;
import de.q60.mps.polymorphicfunctions.runtime.ParameterList;
import java.util.List;
import java.util.Collections;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.NotNullWhereFilter;

public class NamedScope extends AbstractScope implements IScope {
  public static IScope concat(Iterable<IScope> scopes) {
    return Sequence.fromIterable(scopes).reduceLeft((a, b) -> {
      NamedScope named = ((NamedScope) b);
      return new NamedScope(a, named.name, named.parameters, named.imports);
    });
  }

  public static NamedScope getByName(IScope scope, String name) {
    if (scope == null) {
      return null;
    }
    if (scope instanceof NamedScope && Objects.equals(((NamedScope) scope).name, name)) {
      return (NamedScope) scope;
    } else {
      return getByName(scope.getParent(), name);
    }
  }

  protected IScope parent;
  private String name;
  private ParameterList parameters;
  private List<ScopeImport> imports;

  private NamedScope() {
    // for deserialization
  }

  public NamedScope(IScope parent, String name) {
    this(parent, name, ParameterList.EMPTY, Sequence.fromIterable(Collections.<ScopeImport>emptyList()));
  }

  public NamedScope(IScope parent, String name, ParameterList parameters, Iterable<ScopeImport> imports) {
    this.parent = parent;
    this.name = name;
    this.parameters = parameters;
    this.imports = ListSequence.fromListWithValues(new ArrayList<ScopeImport>(), Sequence.fromIterable(imports).where(new NotNullWhereFilter()));
  }
  public String getName() {
    return this.name;
  }

  public ParameterList getParameters() {
    return parameters;
  }

  public Iterable<ScopeImport> getImports() {
    return imports;
  }

  @Override
  public Iterable<ScopeImport> getImports(ITransformationEngine engine) {
    return imports;
  }

  @Override
  public IScope getParent() {
    return parent;
  }

  @Override
  public IStageReference getStage() {
    return parent.getStage();
  }

  @Override
  public String toString() {
    return parent + "/" + name + "(" + parameters + ")";
  }

  private transient int _cachedHashCode;
  private transient boolean _hashCodeInitialized = false;
  @Override
  public int hashCode() {
    if (!(_hashCodeInitialized)) {
      int c = 0;
      c = 31 * c + Objects.hashCode(name);
      c = 31 * c + Objects.hashCode(parameters);
      c = 31 * c + Objects.hashCode(parent);
      _cachedHashCode = c;
      _hashCodeInitialized = true;
    }
    return _cachedHashCode;
  }
  @Override
  public boolean equals(Object o) {
    if (this == o) {
      return true;
    }
    if (o == null || this.getClass() != o.getClass()) {
      return false;
    }
    NamedScope that = (NamedScope) o;
    if (!(Objects.equals(name, that.name))) {
      return false;
    }
    if (!(Objects.equals(parameters, that.parameters))) {
      return false;
    }
    if (!(Objects.equals(parent, that.parent))) {
      return false;
    }
    return true;
  }
}
