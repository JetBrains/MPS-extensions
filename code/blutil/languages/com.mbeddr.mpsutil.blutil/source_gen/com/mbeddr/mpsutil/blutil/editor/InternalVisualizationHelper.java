package com.mbeddr.mpsutil.blutil.editor;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.menus.style.EditorMenuItemStyle;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.Objects;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.extapi.model.ModelWithAttributes;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.IterableUtils;
import org.jetbrains.annotations.ApiStatus;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public final class InternalVisualizationHelper {
  public static void setDeprecationStyle(Object parameterObject, EditorMenuItemStyle style) {
    if (parameterObject != null && parameterObject instanceof SNode) {
      SNode p = (SNode) parameterObject;
      SModel model = SNodeOperations.getModel(p);

      boolean isInternal = false;
      boolean isExperimental = false;

      {
        final SNode nodeWithAnnotations = p;
        if (SNodeOperations.isInstanceOf(nodeWithAnnotations, CONCEPTS.HasAnnotation$Dg)) {
          isInternal |= ListSequence.fromList(SLinkOperations.getChildren(nodeWithAnnotations, LINKS.annotation$K49I)).any((it) -> Objects.equals(SLinkOperations.getPointer(it, LINKS.annotation$12Ek), new SNodePointer("3f233e7f-b8a6-46d2-a57f-795d56775243/java:org.jetbrains.annotations(Annotations/)", "~ApiStatus$Internal")));
          isExperimental |= ListSequence.fromList(SLinkOperations.getChildren(nodeWithAnnotations, LINKS.annotation$K49I)).any((it) -> Objects.equals(SLinkOperations.getPointer(it, LINKS.annotation$12Ek), new SNodePointer("3f233e7f-b8a6-46d2-a57f-795d56775243/java:org.jetbrains.annotations(Annotations/)", "~ApiStatus$Experimental")));
        }
      }

      if (model instanceof ModelWithAttributes) {
        ModelWithAttributes modelWithAttributes = ((ModelWithAttributes) model);
        String visibility = modelWithAttributes.getAttribute("visibility");
        isInternal |= Objects.equals(visibility, "internal");
      }

      List<String> types = ListSequence.fromList(new ArrayList<String>());

      if (isInternal) {
        ListSequence.fromList(types).addElement("internal");
      }

      if (isExperimental) {
        ListSequence.fromList(types).addElement("experimental");
      }


      if (ListSequence.fromList(types).isNotEmpty()) {
        style.setStrikeout();
        style.setPriority(-1);
        style.setDescriptionText(IterableUtils.join(ListSequence.fromList(types), "/") + " API - use with care");
      }
    }
  }

  @ApiStatus.Internal
  public static void internal() {
  }

  @ApiStatus.Experimental
  public static void experimental() {
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept HasAnnotation$Dg = MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x114a6be947aL, "jetbrains.mps.baseLanguage.structure.HasAnnotation");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink annotation$K49I = MetaAdapterFactory.getContainmentLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x114a6be947aL, 0x114a6beb0bdL, "annotation");
    /*package*/ static final SReferenceLink annotation$12Ek = MetaAdapterFactory.getReferenceLink(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x114a6b4ccabL, 0x114a6b85d40L, "annotation");
  }
}
