package de.itemis.mps.changelog.typesystem;

/*Generated by MPS */

import jetbrains.mps.errors.QuickFix_Runtime;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.Map;
import org.jetbrains.mps.openapi.language.SEnumerationLiteral;
import jetbrains.mps.internal.collections.runtime.IMapping;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.Objects;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class MergeSameChangeTypes_QuickFix extends QuickFix_Runtime {
  public MergeSameChangeTypes_QuickFix() {
    super(new SNodePointer("r:5929cd51-847d-4474-b113-e4584f35fa06(de.itemis.mps.changelog.typesystem)", "4672673781420854358"));
  }
  public String getDescription(SNode node) {
    return "Merge Changes With the Same Type";
  }
  public void execute(SNode node) {
    MapSequence.fromMap(((Map<SEnumerationLiteral, Integer>) MergeSameChangeTypes_QuickFix.this.getField("countMap")[0])).where((it) -> it.value() > 1).visitAll((final IMapping<SEnumerationLiteral, Integer> mapping) -> {
      final SNode newSection = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x638c9345261349dcL, 0xb2ae8ceadef24141L, 0xd5813f14876767fL, "de.itemis.mps.changelog.structure.ChangeSection"));
      ListSequence.fromList(SLinkOperations.getChildren(((SNode) MergeSameChangeTypes_QuickFix.this.getField("release")[0]), LINKS.sections$GrN9)).where((it) -> Objects.equals(SPropertyOperations.getEnum(it, PROPS.type$k0hX), mapping.key())).visitAll((section) -> {
        ListSequence.fromList(SLinkOperations.getChildren(newSection, LINKS.changes$k0JZ)).addSequence(ListSequence.fromList(SLinkOperations.getChildren(section, LINKS.changes$k0JZ)));
        SNodeOperations.deleteNode(section);
      });
      ListSequence.fromList(SLinkOperations.getChildren(((SNode) MergeSameChangeTypes_QuickFix.this.getField("release")[0]), LINKS.sections$GrN9)).addElement(newSection);
    });
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink sections$GrN9 = MetaAdapterFactory.getContainmentLink(0x638c9345261349dcL, 0xb2ae8ceadef24141L, 0xd5813f148757d18L, 0xd5813f148767680L, "sections");
    /*package*/ static final SContainmentLink changes$k0JZ = MetaAdapterFactory.getContainmentLink(0x638c9345261349dcL, 0xb2ae8ceadef24141L, 0xd5813f14876767fL, 0xd5813f1487676a5L, "changes");
  }

  private static final class PROPS {
    /*package*/ static final SProperty type$k0hX = MetaAdapterFactory.getProperty(0x638c9345261349dcL, 0xb2ae8ceadef24141L, 0xd5813f14876767fL, 0xd5813f1487676a3L, "type");
  }
}
