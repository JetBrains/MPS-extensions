package de.itemis.mps.editor.celllayout.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.plugins.part.ProjectPluginPart;
import jetbrains.mps.openapi.editor.extensions.EditorExtension;
import jetbrains.mps.openapi.editor.update.UpdaterListener;
import jetbrains.mps.openapi.editor.update.UpdaterListenerAdapter;
import jetbrains.mps.openapi.editor.EditorComponent;
import de.itemis.mps.editor.celllayout.runtime.LayoutInterceptor;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.AdditionalPainter;
import de.itemis.mps.editor.celllayout.runtime.BorderPainter;
import jetbrains.mps.project.MPSProject;
import org.jetbrains.annotations.NotNull;
import de.itemis.mps.editor.celllayout.runtime.CellLayoutUtil;
import jetbrains.mps.openapi.editor.extensions.EditorExtensionRegistry;

public class ProjectPlugin_ProjectPluginPart extends ProjectPluginPart {
  private EditorExtension myEditorComponentExtension;
  private UpdaterListener myUpdaterListener = new UpdaterListenerAdapter() {
    public void editorUpdated(EditorComponent editorComponent) {
      LayoutInterceptor.installWhereRequired(editorComponent);
    }
    public void cellSynchronizedWithModel(EditorCell cell) {
    }
  };
  private AdditionalPainter myRootCellChangeListener = new DoNothingAdditionalPainter() {
    @Override
    public void onUpdate(jetbrains.mps.nodeEditor.EditorComponent component) {
      LayoutInterceptor.installWhereRequired(component);
    }
  };
  private BorderPainter myBorderPainter = new BorderPainter();
  public ProjectPlugin_ProjectPluginPart() {
  }
  @Override
  public void init(MPSProject project) {
    ProjectPlugin_ProjectPluginPart.this.myEditorComponentExtension = new EditorExtension() {

      @Override
      public boolean isApplicable(@NotNull EditorComponent component) {
        return component instanceof jetbrains.mps.nodeEditor.EditorComponent;
      }
      @Override
      public void install(@NotNull EditorComponent component) {
        final jetbrains.mps.nodeEditor.EditorComponent editorComponent = (jetbrains.mps.nodeEditor.EditorComponent) component;
        editorComponent.getUpdater().addListener(ProjectPlugin_ProjectPluginPart.this.myUpdaterListener);
        editorComponent.addAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myRootCellChangeListener);
        editorComponent.addAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myBorderPainter);
        boolean installedAnywhere = LayoutInterceptor.installWhereRequired(editorComponent);
        if (installedAnywhere) {
          CellLayoutUtil.invalidateAllCells(editorComponent.getRootCell());
          editorComponent.relayout();
        }
      }
      @Override
      public void uninstall(@NotNull EditorComponent component) {
        final jetbrains.mps.nodeEditor.EditorComponent editorComponent = (jetbrains.mps.nodeEditor.EditorComponent) component;
        editorComponent.removeAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myBorderPainter);
        editorComponent.removeAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myRootCellChangeListener);
        editorComponent.getUpdater().removeListener(ProjectPlugin_ProjectPluginPart.this.myUpdaterListener);
        LayoutInterceptor.uninstall(editorComponent);
      }
    };
    project.getComponent(EditorExtensionRegistry.class).registerExtension(ProjectPlugin_ProjectPluginPart.this.myEditorComponentExtension);
  }
  @Override
  public void dispose(MPSProject project) {
    project.getComponent(EditorExtensionRegistry.class).unregisterExtension(ProjectPlugin_ProjectPluginPart.this.myEditorComponentExtension);
    ProjectPlugin_ProjectPluginPart.this.myEditorComponentExtension = null;
  }
}
