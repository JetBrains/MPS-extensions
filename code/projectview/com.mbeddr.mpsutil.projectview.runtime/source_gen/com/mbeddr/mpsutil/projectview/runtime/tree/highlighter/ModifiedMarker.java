package com.mbeddr.mpsutil.projectview.runtime.tree.highlighter;

/*Generated by MPS */

import jetbrains.mps.project.Project;
import org.jetbrains.annotations.NotNull;
import com.mbeddr.mpsutil.projectview.runtime.tree.CustomTreeNode;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.model.EditableSModel;
import javax.swing.Icon;
import com.intellij.ui.LayeredIcon;
import com.intellij.icons.AllIcons;

public class ModifiedMarker extends TreeUpdateVisitor {
  public ModifiedMarker(Project mpsProject) {
    super(mpsProject);
  }
  @Override
  public void visitModelNode(@NotNull final CustomTreeNode node) {
    scheduleModelRead(node, new Runnable() {
      @Override
      public void run() {
        SModel md = node.getModel();
        if (!(md.isLoaded())) {
          return;
        }
        if (!(md instanceof EditableSModel)) {
          return;
        }
        boolean changed = ((EditableSModel) md).isChanged();
        final Icon icon = (changed ? new LayeredIcon(node.getDefaultIcon(), AllIcons.General.Modified) : node.getDefaultIcon());
        addUpdate(node, new IconNodeUpdate(icon));
      }
    });
  }
}
