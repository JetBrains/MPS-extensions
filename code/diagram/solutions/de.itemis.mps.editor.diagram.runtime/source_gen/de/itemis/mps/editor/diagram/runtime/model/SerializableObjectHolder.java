package de.itemis.mps.editor.diagram.runtime.model;

/*Generated by MPS */

import java.io.Serializable;
import java.util.Map;
import com.intellij.util.containers.ContainerUtil;
import java.util.concurrent.atomic.AtomicLong;
import org.jetbrains.annotations.Nullable;

public class SerializableObjectHolder<E> implements Serializable {

  private static final Map<Long, Object> ourObjects = ContainerUtil.createWeakValueMap();
  private static AtomicLong ourIdSequence = new AtomicLong();

  public static <T> SerializableObjectHolder<T> create(T object) {
    return (object == null ? null : new SerializableObjectHolder<T>(object));
  }

  private transient E myObject;
  private long myId = ourIdSequence.incrementAndGet();

  public SerializableObjectHolder(@Nullable E object) {
    myObject = object;
  }

  protected Object readResolve() {
    myObject = (E) ourObjects.get(myId);
    return this;
  }

  protected Object writeReplace() {
    ourObjects.put(myId, myObject);
    return this;
  }

  @Nullable
  public E get() {
    return myObject;
  }
}
