package de.q60.mps.polymorphicfunctions.runtime;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.module.ReloadableModule;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.core.behavior.INamedConcept__BehaviorDescriptor;
import java.lang.reflect.Field;
import jetbrains.mps.classloading.ModuleClassNotFoundException;

public class ImplementationsFromFunctionModule implements IImplementationProvider {

  private SNode myModuleNode;

  public ImplementationsFromFunctionModule(SNode moduleNode) {
    myModuleNode = moduleNode;
  }

  public PFModule getModule() {
    ReloadableModule module = (ReloadableModule) SNodeOperations.getModel(myModuleNode).getModule();
    try {
      Class cls = module.getOwnClass(INamedConcept__BehaviorDescriptor.getFqName_idhEwIO9y.invoke(myModuleNode));
      Field instanceField = cls.getDeclaredField("INSTANCE");
      PFModule descriptor = (PFModule) instanceField.get(null);
      return descriptor;
    } catch (ModuleClassNotFoundException e) {
      throw new RuntimeException(e);
    } catch (ClassNotFoundException e) {
      throw new RuntimeException(e);
    } catch (IllegalAccessException e) {
      throw new RuntimeException(e);
    } catch (NoSuchFieldException e) {
      throw new RuntimeException(e);
    }
  }

  @Override
  public Iterable<IFunctionImplementation> getImplementations(IPFContext context, String declarationId, ParameterList parameters) {
    return getModule().getImplementations(context, declarationId, parameters);
  }

  @Override
  public Iterable<IPriorityRule> getPriorityRules() {
    return getModule().getPriorityRules();
  }
}
