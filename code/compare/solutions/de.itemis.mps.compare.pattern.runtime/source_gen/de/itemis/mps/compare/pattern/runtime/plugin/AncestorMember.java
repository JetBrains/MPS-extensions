package de.itemis.mps.compare.pattern.runtime.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public class AncestorMember extends PatternBuilderInitPart<IPatternEvaluator> {

  public AncestorMember(Expression<IPatternEvaluator> inner, String annotation, boolean negated) {
    super(inner, annotation, negated);
  }

  public AncestorMember(Expression<IPatternEvaluator> inner, String annotation) {
    this(inner, annotation, false);
  }

  public AncestorMember(Expression<IPatternEvaluator> inner) {
    this(inner, null);
  }

  @Override
  public MatchResult match(SNode node) {
    SNode current = SNodeOperations.getParent(node);
    while (current != null) {
      MatchResult result = inner.getFirst().match(current);

      result = result.xor(negated);

      if (result.isMatch()) {
        if (shouldAnnotate()) {
          result.put(annotation, current);
        }
        return result;
      }
      current = SNodeOperations.getParent(current);
    }
    return MatchResult.noMatch();
  }

  @Override
  public String toString() {
    return "ancestor@" + this.annotation + " = " + this.inner.getFirst();
  }

  @Override
  public SNode build(SNode node) {
    return node;
  }

}
