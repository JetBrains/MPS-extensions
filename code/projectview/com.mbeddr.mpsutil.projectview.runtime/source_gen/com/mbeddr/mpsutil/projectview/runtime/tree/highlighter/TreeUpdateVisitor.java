package com.mbeddr.mpsutil.projectview.runtime.tree.highlighter;

/*Generated by MPS */

import com.mbeddr.mpsutil.projectview.runtime.tree.ITreeVisitor;
import jetbrains.mps.project.Project;
import java.util.concurrent.Executor;
import org.jetbrains.annotations.NotNull;
import com.mbeddr.mpsutil.projectview.runtime.tree.CustomTreeNode;
import jetbrains.mps.ide.ui.tree.MPSTreeNode;
import jetbrains.mps.smodel.ModelReadRunnable;

/**
 * Visitor that updates tree elements
 */
public abstract class TreeUpdateVisitor implements ITreeVisitor {
  protected final Project myProject;
  private TreeNodeUpdater myUpdater;
  private Executor myExecutor;
  protected TreeUpdateVisitor(@NotNull Project mpsProject) {
    myProject = mpsProject;
  }
  @Override
  public void visitNamespaceNode(@NotNull CustomTreeNode node) {
  }
  @Override
  public void visitModuleNode(@NotNull CustomTreeNode node) {
  }
  @Override
  public void visitProjectNode(@NotNull CustomTreeNode node) {
  }
  @Override
  public void visitModelNode(@NotNull CustomTreeNode node) {
  }
  protected final void scheduleModelRead(final MPSTreeNode node, final Runnable readAction) {
    schedule(node, new ModelReadRunnable(myProject.getModelAccess(), readAction));
  }
  protected final void schedule(final MPSTreeNode node, final Runnable runnable) {
    final Executor ex = myExecutor;
    if (ex == null) {
      return;
    }
    ex.execute(new Runnable() {
      @Override
      public void run() {
        boolean disposed = node.getTree() == null;
        if (disposed) {
          return;
        }
        runnable.run();
      }
    });
  }
  protected void addUpdate(MPSTreeNode node, NodeUpdate r) {
    final TreeNodeUpdater u = myUpdater;
    if (u != null) {
      u.addUpdate(node, r);
    }
  }
  public TreeUpdateVisitor setUpdater(TreeNodeUpdater updater) {
    myUpdater = updater;
    return this;
  }
  public TreeUpdateVisitor setExecutor(Executor executor) {
    myExecutor = executor;
    return this;
  }
}
