package de.itemis.mps.editor.celllayout.runtime.cells;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.cells.EditorCell_Basic;
import jetbrains.mps.openapi.editor.style.StyleAttribute;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import java.awt.Color;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import java.awt.Graphics;
import jetbrains.mps.nodeEditor.cells.ParentSettings;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import jetbrains.mps.openapi.editor.TextBuilder;
import jetbrains.mps.nodeEditor.EditorSettings;
import jetbrains.mps.openapi.editor.EditorComponentSettings;
import jetbrains.mps.openapi.editor.cells.EditorFontMetrics;
import java.awt.Font;
import jetbrains.mps.editor.runtime.TextBuilderImpl;

public class VerticalLineCell extends EditorCell_Basic {
  private static final StyleAttribute<Integer> MARGIN_LEFT = StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.celllayout.styles", "_margin-left");
  private static final StyleAttribute<Integer> MARGIN_RIGHT = StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.celllayout.styles", "_margin-right");
  private static final StyleAttribute<Integer> VERTICAL_LINE_WIDTH = StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.celllayout.styles", "_vertical-line-width");
  private static final StyleAttribute<Color> VERTICAL_LINE_COLOR = StyleAttributes.getInstance().<Color>getAttribute("de.itemis.mps.editor.celllayout.styles", "_vertical-line-color");
  private static final StyleAttribute<Boolean> GROW_Y = StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.celllayout.styles", "_grow-y");
  private static final StyleAttribute<Boolean> PUSH_Y = StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.celllayout.styles", "_push-y");

  public VerticalLineCell(@NotNull EditorContext editorContext, SNode snode) {
    super(editorContext, snode);
    getStyle().set(PUSH_Y, true);
    getStyle().set(GROW_Y, true);
    setSelectable(false);
  }

  public void setColor(Color color) {
    getStyle().set(VERTICAL_LINE_COLOR, color);
  }

  public void setLineWidth(int lineWidth) {
    getStyle().set(VERTICAL_LINE_WIDTH, lineWidth);
  }

  public void setMarginLeft(int margin) {
    getStyle().set(MARGIN_LEFT, margin);
  }

  public void setMarginRight(int margin) {
    getStyle().set(MARGIN_RIGHT, margin);
  }

  protected void paintContent(Graphics g_, ParentSettings settings) {
    Graphics g = g_.create();
    int lineWidth = getWidth() - myGapLeft - myGapRight;
    try {
      EditorCell_Collection parent = getParent();
      g.setColor(getStyle().get(VERTICAL_LINE_COLOR));
      g.fillRect(getX(), parent.getY(), lineWidth, parent.getHeight());
    } finally {
      g.dispose();
    }
  }

  @Override
  protected void relayoutImpl() {
    setWidth(getStyle().get(VERTICAL_LINE_WIDTH));
  }

  @Override
  public TextBuilder renderText() {
    EditorSettings settings = EditorSettings.getInstance();
    EditorComponentSettings editorComponentSettings = getEditorComponent().getEditorComponentSettings();
    EditorFontMetrics fontMetrics = editorComponentSettings.getFontMetrics(settings.getFontFamily(), Font.PLAIN, editorComponentSettings.getFontSize());
    int heightOfOneDash = fontMetrics.getHeight();

    TextBuilder builder = new TextBuilderImpl();
    int numberOfDashes = getParent().getHeight() / heightOfOneDash;
    for (int i = 0; i < numberOfDashes; i++) {
      builder.appendToTheBottom(new TextBuilderImpl("|"));
    }
    return builder;
  }
}
