package de.itemis.mps.tooltips.runtime;

/*Generated by MPS */

import org.jetbrains.annotations.Nullable;
import java.util.Map;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;

public class TooltipLazyLoadingContext {

  private static TooltipLazyLoadingContext ourContext;

  @Nullable
  public static TooltipLazyLoadingContext getCurrentContext() {
    return ourContext;
  }

  public static void inNewContext(Runnable runnable) {
    TooltipLazyLoadingContext prevContext = ourContext;
    try {
      ourContext = new TooltipLazyLoadingContext();
      runnable.run();
    } finally {
      ourContext = prevContext;
    }
  }

  private Map<TooltipId, EditorCell> myTooltipCell = MapSequence.fromMap(new HashMap<TooltipId, EditorCell>());

  /**
   * Registers cell for the given tooltip ID in the current context, if the ID doesn't have a registered cell yet.
   * Thus, the first cell registered for the tooltip ID will be the resulting cell from the context.
   * 
   * @param id tooltip id identifying specific tooltip in the editor
   * @param cell rendered tooltip cell
   */
  public void registerTooltipCell(TooltipId id, EditorCell cell) {
    if (!(MapSequence.fromMap(myTooltipCell).containsKey(id))) {
      MapSequence.fromMap(myTooltipCell).put(id, cell);
    }
  }

  @Nullable
  public EditorCell getTooltipCell(TooltipId id) {
    return MapSequence.fromMap(myTooltipCell).get(id);
  }

}
