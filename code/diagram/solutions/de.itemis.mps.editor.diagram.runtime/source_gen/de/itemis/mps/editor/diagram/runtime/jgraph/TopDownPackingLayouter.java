package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import org.eclipse.elk.alg.topdownpacking.NodeArrangementStrategy;
import org.eclipse.elk.alg.topdownpacking.WhitespaceEliminationStrategy;
import org.eclipse.elk.alg.topdownpacking.options.TopdownpackingOptions;
import org.eclipse.elk.core.data.LayoutMetaDataService;
import org.eclipse.elk.alg.topdownpacking.options.TopdownpackingMetaDataProvider;
import org.eclipse.elk.graph.ElkNode;
import org.eclipse.elk.core.util.IElkProgressMonitor;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.editor.runtime.style.StyleAttributes;

public class TopDownPackingLayouter extends ElkLayouterWithTopDownPackingSupport {

  protected NodeArrangementStrategy nodeArrangementStrategy;
  protected double nodeSpacing;
  protected WhitespaceEliminationStrategy whitespaceEliminationStrategy;

  public TopDownPackingLayouter() {
    super();
    myAlgorithm = TopdownpackingOptions.ALGORITHM_ID;
  }

  static {
    LayoutMetaDataService.getInstance().registerLayoutMetaDataProviders(new TopdownpackingMetaDataProvider());
  }

  @Override
  public boolean canLayoutLabels() {
    return false;
  }
  @Override
  protected boolean useDummyPort(EdgeDCell edge, boolean isTarget) {
    return false;
  }

  @Override
  protected void addLayoutInformationToGraph(ElkNode graph, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToGraph(graph, progressMonitor);
    ElkNode layout = graph;

    layout.setProperty(TopdownpackingOptions.NODE_ARRANGEMENT_STRATEGY, nodeArrangementStrategy);
    layout.setProperty(TopdownpackingOptions.SPACING_NODE_NODE, nodeSpacing);
    layout.setProperty(TopdownpackingOptions.WHITESPACE_ELIMINATION_STRATEGY, whitespaceEliminationStrategy);

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(layout, "graph", progressMonitor);
    }
  }

  @Override
  public void setParentsStyle(Style style) {
    super.setParentsStyle(style);
    nodeArrangementStrategy = style.get(StyleAttributes.getInstance().<NodeArrangementStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-topdown-node-arrangement-strategy"));
    nodeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-node-spacing"));
    whitespaceEliminationStrategy = style.get(StyleAttributes.getInstance().<WhitespaceEliminationStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-topdown-whitespace-elimination-strategy"));
  }

}
