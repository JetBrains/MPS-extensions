package de.itemis.model.merge.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import de.itemis.model.merge.behavior.DeclarationPolicy__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class check_MergePolicy_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_MergePolicy_NonTypesystemRule() {
  }
  public void applyRule(final SNode mergePolicy, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    Set<SNode> propertyBuffer = SetSequence.fromSet(new HashSet<SNode>());
    for (SNode propPolicy : ListSequence.fromList(SLinkOperations.getChildren(mergePolicy, LINKS.propertyPolicies$p_0G))) {
      if (SetSequence.fromSet(propertyBuffer).contains(SLinkOperations.getTarget(propPolicy, LINKS.property$IQvu))) {
        {
          final MessageTarget errorTarget = new NodeMessageTarget();
          IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(propPolicy, "property already chosen", "r:02b6652e-c87d-4bb2-bfc0-4b5c0d5b9442(de.itemis.model.merge.typesystem)", "2222162468659408572", null, errorTarget);
        }
        break;
      }
      SetSequence.fromSet(propertyBuffer).addElement(SLinkOperations.getTarget(propPolicy, LINKS.property$IQvu));
    }

    Set<SNode> linkBuffer = SetSequence.fromSet(new HashSet<SNode>());
    for (SNode childPolicy : ListSequence.fromList(SLinkOperations.getChildren(mergePolicy, LINKS.childPolicies$7ocQ)).where((it) -> !(SNodeOperations.getConcept(it).isAbstract()))) {
      if (SetSequence.fromSet(linkBuffer).contains(DeclarationPolicy__BehaviorDescriptor.childLink_id1VmHfRx_0K2.invoke(childPolicy))) {
        {
          final MessageTarget errorTarget = new NodeMessageTarget();
          IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(childPolicy, "child already chosen", "r:02b6652e-c87d-4bb2-bfc0-4b5c0d5b9442(de.itemis.model.merge.typesystem)", "2222162468659455763", null, errorTarget);
        }
        break;
      }
      SetSequence.fromSet(linkBuffer).addElement(DeclarationPolicy__BehaviorDescriptor.childLink_id1VmHfRx_0K2.invoke(childPolicy));
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.ConceptMergingPolicy$RB;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink property$IQvu = MetaAdapterFactory.getReferenceLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42e44628L, 0x68dab8ecba09e939L, "property");
    /*package*/ static final SContainmentLink propertyPolicies$p_0G = MetaAdapterFactory.getContainmentLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, 0x1a8b8d3e42e44c7dL, "propertyPolicies");
    /*package*/ static final SContainmentLink childPolicies$7ocQ = MetaAdapterFactory.getContainmentLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, 0x74e2e0579b2effc5L, "childPolicies");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConceptMergingPolicy$RB = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42de4bf5L, "de.itemis.model.merge.structure.ConceptMergingPolicy");
  }
}
