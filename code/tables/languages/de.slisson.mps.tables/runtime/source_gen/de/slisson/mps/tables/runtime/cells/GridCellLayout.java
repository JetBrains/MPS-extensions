package de.slisson.mps.tables.runtime.cells;

/*Generated by MPS */

import de.itemis.mps.editor.celllayout.layout.AbstractLayout;
import de.itemis.mps.editor.celllayout.layout.ILayoutableContainer;
import de.itemis.mps.editor.celllayout.boxmodel.Size;
import org.jetbrains.annotations.NotNull;
import de.itemis.mps.editor.celllayout.layout.ILayoutable;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import de.itemis.mps.editor.celllayout.runtime.CellLayoutUtil;
import de.itemis.mps.editor.celllayout.boxmodel.LayoutBoxExtensions;

public class GridCellLayout extends AbstractLayout {
  public int getAscent(ILayoutableContainer container, Size sizeConstraint) {
    return 0;
  }
  @NotNull
  public Size getMaxInnerSize(ILayoutableContainer container, @NotNull Size sizeConstraint) {
    return Size.UNLIMITED_SIZE;
  }
  @NotNull
  public Size getMinInnerSize(ILayoutableContainer container, @NotNull Size sizeConstraint) {
    ILayoutable layoutable = ListSequence.fromList(container.getChildren()).first();
    if (layoutable == null) {
      return Size.ZERO;
    }
    return layoutable.getMinSize(sizeConstraint);
  }
  @NotNull
  public Size getPreferredInnerSize(ILayoutableContainer container, @NotNull Size sizeConstraint) {
    ILayoutable layoutable = ListSequence.fromList(container.getChildren()).first();
    if (layoutable == null) {
      return Size.ZERO;
    }
    return layoutable.getPreferredSize(sizeConstraint);
  }
  public void layout(ILayoutableContainer container, @NotNull Size sizeConstraint) {
    ILayoutable child = ListSequence.fromList(container.getChildren()).first();
    if (child == null) {
      return;
    }
    child.setPosition(container.getInnerX(), container.getInnerY());
    Size childSize = sizeConstraint.min(ListSequence.fromList(container.getChildren()).first().getPreferredSize(sizeConstraint));
    child.setSize(childSize.getWidth(), childSize.getHeight());
    alignCell(child, container, sizeConstraint);
    child.relayout(sizeConstraint);
  }

  protected void alignCell(ILayoutable child, ILayoutableContainer parent, Size sizeConstraint) {
    EditorCell_GridCell gridCell = ((EditorCell_GridCell) CellLayoutUtil.getEditorCell(parent));
    switch (gridCell.getHorizontalAlignment()) {
      case LEFT:
        child.getBoxModel().getMarginBox().setX(parent.getBoxModel().getContentBox().getX());
        break;
      case RIGHT:
        LayoutBoxExtensions.setRight(child.getBoxModel().getMarginBox(), parent.getBoxModel().getContentBox().getRight());
        break;
      case CENTER:
        LayoutBoxExtensions.setHorizontalCenter(child.getBoxModel().getMarginBox(), LayoutBoxExtensions.getHorizontalCenter(parent.getBoxModel().getContentBox()));
        break;
      default:
        throw new RuntimeException("Unknown alignment: " + gridCell.getHorizontalAlignment());
    }

    switch (gridCell.getVerticalAlignment()) {
      case TOP:
        child.getBoxModel().getMarginBox().setY(parent.getBoxModel().getContentBox().getY());
        break;
      case BOTTOM:
        LayoutBoxExtensions.setBottom(child.getBoxModel().getMarginBox(), parent.getBoxModel().getContentBox().getBottom());
        break;
      case CENTER:
        LayoutBoxExtensions.setVerticalCenter(child.getBoxModel().getMarginBox(), LayoutBoxExtensions.getVerticalCenter(parent.getBoxModel().getContentBox()));
        break;
      default:
        throw new RuntimeException("Unknown alignment: " + gridCell.getVerticalAlignment());
    }
  }
}
