package com.mbeddr.mpsutil.projectview.runtime.tree;

/*Generated by MPS */

import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;

public class WeightValues {

  private static final Set<Integer> blockedValues = SetSequence.fromSetAndArray(new HashSet<Integer>(), 0, 3, 4, 5, 10, 11);
  private static final Set<Integer> aquiredValues = SetSequence.fromSet(new HashSet<Integer>());

  public synchronized static AquiredValue tryAquire(int preferedValue) {
    int value;
    if (isAvailable(preferedValue)) {
      value = preferedValue;
    } else {
      int alternativeValue = 1000;
      while (!(isAvailable(alternativeValue))) {
        ++alternativeValue;
      }
      value = alternativeValue;
    }
    SetSequence.fromSet(aquiredValues).addElement(value);
    return new AquiredValue(value);
  }

  private synchronized static void releaseValue(int value) {
    SetSequence.fromSet(aquiredValues).removeElement(value);
  }

  public synchronized static boolean isAvailable(int value) {
    return !(SetSequence.fromSet(blockedValues).contains(value) || SetSequence.fromSet(aquiredValues).contains(value));
  }

  public static class AquiredValue {
    private int value;
    private AquiredValue(int value) {
      this.value = value;
    }
    public void release() {
      releaseValue(value);
    }
    public int getValue() {
      return value;
    }
  }
}
