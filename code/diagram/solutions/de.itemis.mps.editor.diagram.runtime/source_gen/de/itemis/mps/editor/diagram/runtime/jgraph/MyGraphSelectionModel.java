package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import com.mxgraph.view.mxGraphSelectionModel;
import com.mxgraph.view.mxGraph;
import java.util.Collection;
import java.util.List;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.internal.collections.runtime.Sequence;
import com.mxgraph.model.mxCell;
import jetbrains.mps.openapi.editor.selection.SelectionManager;

public class MyGraphSelectionModel extends mxGraphSelectionModel {

  private RootDiagramECell myDiagramCell;
  private boolean directionMpsToDiagram = false;

  public MyGraphSelectionModel(mxGraph graph) {
    super(graph);

  }

  /*package*/ void setDiagramCell(RootDiagramECell diagramCell) {
    myDiagramCell = diagramCell;
  }

  @Override
  protected void changeSelection(Collection<Object> added, Collection<Object> removed) {
    super.changeSelection(added, removed);

    if (myDiagramCell != null && !(directionMpsToDiagram)) {
      List<EditorCell> selectedCells = GraphSelection.extractSelectedCells(this);
      if (selectedCells.size() > 0) {
        GraphSelection selection = new GraphSelection(myDiagramCell.getEditorComponent(), myDiagramCell, Sequence.fromIterable(Sequence.fromArray(getCells())).ofType(mxCell.class).toList());
        SelectionManager selectionManager = myDiagramCell.getEditorComponent().getSelectionManager();
        if (!(selection.isSame(selectionManager.getSelection()))) {
          if (!(JGraphModelSynchronizer.getSynchronizer(myDiagramCell.getModel()).isSynchronizing())) {
            selectionManager.setSelection(selection);
          }
        }
      }
    }
  }

  public void clearFromMPS() {
    try {
      directionMpsToDiagram = true;
      clear();
    } finally {
      directionMpsToDiagram = false;
    }
  }

  public void setFromMPS(Object[] newSelection) {
    try {
      directionMpsToDiagram = true;
      setCells(newSelection);
    } finally {
      directionMpsToDiagram = false;
    }
  }
}
