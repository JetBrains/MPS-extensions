package com.mbeddr.mpsutil.grammarcells.runtime.menu;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.menus.substitute.SubstituteMenuItem;
import jetbrains.mps.openapi.editor.menus.transformation.ConstraintsVerifiableActionItem;
import jetbrains.mps.openapi.editor.menus.substitute.SubstituteMenuContext;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.util.PatternUtil;
import java.util.Objects;
import jetbrains.mps.smodel.runtime.IconResource;
import jetbrains.mps.smodel.runtime.IconResourceUtil;
import jetbrains.mps.openapi.editor.EditorComponent;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.cells.CellFinderUtil;

public abstract class GrammarCellsSubstituteMenuItem implements SubstituteMenuItem, ConstraintsVerifiableActionItem {

  private SubstituteMenuContext myContext;

  public GrammarCellsSubstituteMenuItem(SubstituteMenuContext context) {
    myContext = context;
  }

  @Override
  public SNode getType(@NotNull String string) {
    return null;
  }

  @Override
  public String getDescriptionText(@NotNull String pattern) {
    String description = getOutputConcept().getShortDescription();
    return ((description != null && description.length() > 0) ? description : getOutputConcept().getName());
  }
  @Override
  public boolean canExecute(@NotNull String pattern) {
    return PatternUtil.matchesPattern(pattern, getMatchingText(pattern));
  }
  @Override
  public boolean canExecuteStrictly(@NotNull String pattern) {
    return Objects.equals(pattern, getMatchingText(pattern));
  }

  @Override
  public IconResource getIcon(@NotNull String pattern) {
    return IconResourceUtil.getIconResourceForConcept(getOutputConcept());
  }
  @Override
  public void select(@NotNull SNode createdNode, @NotNull String pattern) {
    select(myContext.getEditorContext().getEditorComponent(), createdNode);
  }

  public static void select(EditorComponent editorComponent, SNode nodeToSelect) {
    EditorCell cell = editorComponent.findNodeCell(nodeToSelect);
    if (cell != null) {
      EditorCell errorCell = CellFinderUtil.findFirstError(cell, true);
      if (errorCell != null) {
        ((jetbrains.mps.nodeEditor.EditorComponent) editorComponent).changeSelectionWRTFocusPolicy(errorCell);
      } else {
        ((jetbrains.mps.nodeEditor.EditorComponent) editorComponent).changeSelectionWRTFocusPolicy(cell);
      }
    }
  }
}
