package de.q60.mps.shadowmodels.debugview.pf;

/*Generated by MPS */

import java.util.List;
import de.q60.mps.logging.runtime.LogEntry;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import com.google.common.collect.ListMultimap;
import com.google.common.collect.MultimapBuilder;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.Set;
import java.util.Map;
import java.util.Collection;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;

public class ErrorLog {
  public final List<LogEntry> entries;

  public ErrorLog(List<LogEntry> entries) {
    this.entries = entries;
  }

  public Iterable<Tuples._2<String, Iterable<LogEntry>>> getEntriesPerThread() {
    ListMultimap<String, LogEntry> thread2entry = MultimapBuilder.hashKeys().arrayListValues().<String,LogEntry>build();

    for (LogEntry entry : ListSequence.fromList(entries)) {
      thread2entry.put(entry.getThreadName(), entry);
    }

    Set<Map.Entry<String, Collection<LogEntry>>> set = thread2entry.asMap().entrySet();
    return SetSequence.fromSet(set).select((it) -> {
      Iterable<LogEntry> value = it.getValue();
      return MultiTuple.<String,Iterable<LogEntry>>from(it.getKey(), value);
    });
  }
}
