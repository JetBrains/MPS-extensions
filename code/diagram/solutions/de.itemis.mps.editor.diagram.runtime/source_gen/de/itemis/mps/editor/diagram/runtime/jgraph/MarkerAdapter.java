package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import com.mxgraph.shape.mxIMarker;
import java.io.Serializable;
import de.itemis.mps.editor.diagram.runtime.model.SerializableObjectHolder;
import de.itemis.mps.editor.diagram.runtime.shape.IShape;
import com.mxgraph.util.mxPoint;
import com.mxgraph.canvas.mxGraphics2DCanvas;
import com.mxgraph.view.mxCellState;
import java.awt.geom.Rectangle2D;
import java.awt.Graphics2D;
import de.itemis.mps.editor.diagram.runtime.shape.ConnectionEndShapeStyle;

public class MarkerAdapter implements mxIMarker, Serializable {

  private SerializableObjectHolder<IShape> myShape;

  public MarkerAdapter(IShape shape) {
    myShape = new SerializableObjectHolder<IShape>(shape);
  }

  public mxPoint paintMarker(mxGraphics2DCanvas canvas, mxCellState state, String type, final mxPoint endPoint, final double normX, final double normY, double size, boolean source) {
    if (size >= 2) {
      final Rectangle2D rect = new Rectangle2D.Double(-1.0 * size, -0.5 * size, 1.0 * size, 1.0 * size);

      Graphics2D graphics = canvas.getGraphics();
      DrawUtil.executeWithGraphicsCopy(graphics, (Graphics2D g) -> {
        g.translate(endPoint.getX(), endPoint.getY());
        g.rotate(-Math.atan2(normX, normY) + Math.PI / 2);

        myShape.get().draw(g, rect, new ConnectionEndShapeStyle());
      });
    }

    return new mxPoint(-normX, -normY);
  }
}
