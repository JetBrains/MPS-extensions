package de.itemis.mps.editor.diagram.runtime.model;

/*Generated by MPS */

import java.io.Serializable;
import org.jetbrains.annotations.NotNull;
import de.itemis.mps.editor.diagram.runtime.shape.IShape;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import org.jetbrains.annotations.Nullable;
import de.itemis.mps.editor.diagram.runtime.shape.TransformingShape;
import java.awt.geom.AffineTransform;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.nodeEditor.cells.EditorCell_Constant;

public class Port implements Serializable, IConnectionEndpoint_Internal {
  public static final double DEFAULT_PORT_WIDTH = 12;
  public static final double DEFAULT_PORT_HEIGHT = DEFAULT_PORT_WIDTH;

  @NotNull
  private String myName;
  private SerializableObjectHolder<IShape> myShape;
  private SerializableObjectHolder<Box> myBox;
  private SerializableObjectHolder<SNode> mySNode;
  private SerializableObjectHolder<EditorCell> myDummyCell;

  /**
   * 0.0-1.0
   * The desired position of the port center inside the parent node. Is set in the editor definition
   */
  @Nullable
  private Double myRelativeX;
  @Nullable
  private Double myRelativeY;
  private double myWidth = DEFAULT_PORT_WIDTH;
  private double myHeight = DEFAULT_PORT_HEIGHT;
  private int myOrdinal = 0;

  @Nullable
  private SerializableObjectHolder<EditorCell> myTooltipCell;

  public Port(@NotNull String name) {
    this(name, null);
  }

  public Port(@NotNull String name, IShape shape) {
    this(name, shape, null, null);
  }

  public Port(@NotNull String name, @Nullable Double positionX, @Nullable Double positionY) {
    this(name, null, positionX, positionY);
  }

  public Port(@NotNull String name, IShape shape, @Nullable Double positionX, @Nullable Double positionY) {
    myName = name;
    myShape = new SerializableObjectHolder<IShape>(shape);
    myRelativeX = positionX;
    myRelativeY = positionY;
  }

  public void setBox(@NotNull Box box) {
    myBox = new SerializableObjectHolder<Box>(box);
  }

  public Box getBox() {
    return check_qq1c_a0a72(myBox);
  }

  public void setName(String name) {
    myName = name;
  }

  public String getName() {
    return myName;
  }

  public void setShape(@Nullable IShape shape) {
    myShape = new SerializableObjectHolder(shape);
  }

  @Nullable
  public IShape getShape() {
    return myShape.get();
  }

  @Nullable
  public IShape getTransformedShape() {
    if (getShape() == null) {
      return null;
    }
    return new TransformingShape(getShape()) {
      @Nullable
      @Override
      protected AffineTransform getTransform() {
        return getBox().getPortTransform();
      }
    };
  }

  @Nullable
  public Double getRelativeX() {
    return myRelativeX;
  }
  @Nullable
  public Double getRelativeY() {
    return myRelativeY;
  }

  public double getTransformedRelativeX() {
    return getTransformedRelativePosition().getX();
  }
  public double getTransformedRelativeY() {
    return getTransformedRelativePosition().getY();
  }

  public double getRelativeXNN() {
    return (getRelativeX() == null ? 0.0 : getRelativeX());
  }

  public double getRelativeYNN() {
    return (getRelativeY() == null ? 0.5 : getRelativeY());
  }

  public Point getRelativePosition() {
    return new Point(getRelativeXNN(), getRelativeYNN());
  }
  @NotNull
  public Point getTransformedRelativePosition() {
    Box box = myBox.get();
    return (box != null ? box.transformPortPosition(getRelativePosition()) : getRelativePosition());
  }

  public void setRelativeX(@Nullable Double pos) {
    myRelativeX = pos;
  }
  public void setRelativeX(@Nullable Integer pos) {
    myRelativeX = (pos == null ? null : pos.doubleValue());
  }
  public void setRelativeY(@Nullable Double pos) {
    myRelativeY = pos;
  }
  public void setRelativeY(@Nullable Integer pos) {
    myRelativeY = (pos == null ? null : pos.doubleValue());
  }

  public void setWidth(double width) {
    myWidth = width;
  }

  public double getWidth() {
    return myWidth;
  }

  public void setHeight(double height) {
    myHeight = height;
  }

  public double getHeight() {
    return myHeight;
  }

  @NotNull
  @Override
  public IConnectionEndpointReference getEndpointReference() {
    if (myBox == null) {
      throw new IllegalStateException("parent box not set for port " + myName);
    }
    IConnectionEndpointReference ref = EndpointUtil.createEndpointReferenceForPort(myBox.get().getEndpointReference(), myName);
    if (ref == null) {
      throw new NullPointerException("reference is null");
    }
    return ref;
  }

  @Nullable
  public EditorCell getTooltipCell() {
    return check_qq1c_a0a76(myTooltipCell);
  }

  public void setTooltipCell(@Nullable EditorCell tooltipCell) {
    myTooltipCell = new SerializableObjectHolder<EditorCell>(tooltipCell);
  }

  public DiagramModel getModel() {
    return getBox().getModel();
  }

  public int getOrdinal() {
    return myOrdinal;
  }

  public void setOrdinal(int ordinal) {
    myOrdinal = ordinal;
  }

  public void setSNode(SNode snode) {
    mySNode = new SerializableObjectHolder<SNode>(snode);
  }

  public void setSNodeAndDummyCell(SNode snode, EditorContext editorContext) {
    mySNode = new SerializableObjectHolder<SNode>(snode);
    myDummyCell = new SerializableObjectHolder<EditorCell>(new EditorCell_Constant(editorContext, snode, "port dummy cell"));
  }

  public SNode getSNode() {
    return check_qq1c_a0a18(mySNode);
  }

  public EditorCell getDummyCell() {
    return check_qq1c_a0a38(myDummyCell);
  }
  private static Box check_qq1c_a0a72(SerializableObjectHolder<Box> checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.get();
    }
    return null;
  }
  private static EditorCell check_qq1c_a0a76(SerializableObjectHolder<EditorCell> checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.get();
    }
    return null;
  }
  private static SNode check_qq1c_a0a18(SerializableObjectHolder<SNode> checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.get();
    }
    return null;
  }
  private static EditorCell check_qq1c_a0a38(SerializableObjectHolder<EditorCell> checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.get();
    }
    return null;
  }
}
