package de.itemis.model.merge.constraints;

/*Generated by MPS */

import jetbrains.mps.smodel.runtime.base.BaseConstraintsDescriptor;
import jetbrains.mps.smodel.runtime.ConstraintFunction;
import jetbrains.mps.smodel.runtime.ConstraintContext_CanBeParent;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.smodel.runtime.CheckingNodeContext;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import java.util.Arrays;
import de.itemis.model.merge.behavior.OptionalPolicy__BehaviorDescriptor;
import de.itemis.model.merge.behavior.AbstractPolicy__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SEnumOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class OptionalPolicy_Constraints extends BaseConstraintsDescriptor {
  public OptionalPolicy_Constraints() {
    super(CONCEPTS.OptionalPolicy$hY);
  }

  @Override
  protected ConstraintFunction<ConstraintContext_CanBeParent, Boolean> calculateCanBeParentConstraint() {
    return new ConstraintFunction<ConstraintContext_CanBeParent, Boolean>() {
      @NotNull
      public Boolean invoke(@NotNull ConstraintContext_CanBeParent context, @Nullable CheckingNodeContext checkingNodeContext) {
        boolean result = staticCanBeAParent(context.getNode(), context.getChildNode(), context.getChildConcept(), context.getLink());

        if (!(result) && checkingNodeContext != null) {
          checkingNodeContext.setBreakingNode(canBeParentBreakingPoint);
        }

        return result;
      }
    };
  }
  private static boolean staticCanBeAParent(SNode node, SNode childNode, final SAbstractConcept childConcept, SContainmentLink link) {
    List<SAbstractConcept> allowedConcepts = ListSequence.fromList(new ArrayList<SAbstractConcept>());
    ListSequence.fromList(allowedConcepts).addSequence(ListSequence.fromList(Arrays.asList(CONCEPTS.Left$9M, CONCEPTS.Right$Y2, CONCEPTS.Drop$fB, OptionalPolicy__BehaviorDescriptor.manualAction_id1Tugx$FTy0.invoke(node))));
    if (!((boolean) AbstractPolicy__BehaviorDescriptor.childHasMultipleSubConcepts_idjF$CuWmXO_.invoke(node)) && !(SEnumOperations.isMember(SPropertyOperations.getEnum(SLinkOperations.getTarget(node, LINKS.child$kkGR), PROPS.metaClass$PeKc), 0xfc6f4e95b8L))) {
      ListSequence.fromList(allowedConcepts).addElement(CONCEPTS.Auto$g6);
    }
    return ListSequence.fromList(allowedConcepts).any((it) -> it.isSubConceptOf(childConcept));

  }
  private static final SNodePointer canBeParentBreakingPoint = new SNodePointer("r:eda8a4e8-0d4c-4435-bda0-13fbb20b741b(de.itemis.model.merge.constraints)", "8422540920009525119");

  private static final class CONCEPTS {
    /*package*/ static final SConcept OptionalPolicy$hY = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x74e2e0579b2eb40bL, "de.itemis.model.merge.structure.OptionalPolicy");
    /*package*/ static final SConcept Left$9M = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1a8b8d3e42e44bcaL, "de.itemis.model.merge.structure.Left");
    /*package*/ static final SConcept Right$Y2 = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x68dab8ecba0b4ed6L, "de.itemis.model.merge.structure.Right");
    /*package*/ static final SConcept Drop$fB = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x74e2e0579b2e78b6L, "de.itemis.model.merge.structure.Drop");
    /*package*/ static final SConcept Auto$g6 = MetaAdapterFactory.getConcept(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x74e2e0579b2e78b7L, "de.itemis.model.merge.structure.Auto");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink child$kkGR = MetaAdapterFactory.getReferenceLink(0x539e893908ef497cL, 0xa5fd25dd10137a55L, 0x1ed6b4fde1eeb12cL, 0x1ed6b4fde1eeb12fL, "child");
  }

  private static final class PROPS {
    /*package*/ static final SProperty metaClass$PeKc = MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979bd086aL, 0xf980556927L, "metaClass");
  }
}
