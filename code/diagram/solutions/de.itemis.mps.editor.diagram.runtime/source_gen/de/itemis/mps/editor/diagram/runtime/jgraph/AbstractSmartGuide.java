package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import java.util.List;
import com.mxgraph.view.mxCellState;
import com.mxgraph.view.mxGraphView;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import com.mxgraph.model.mxCell;

public abstract class AbstractSmartGuide implements ISmartGuide {

  protected abstract List<SnapResult> snap(double dx, double dy, double distanceLimit, mxCellState movingState, mxCellState otherState, mxGraphView view);

  @NotNull
  public List<SnapResult> snap(double dx, double dy, double distanceLimit, mxCellState movingState, List<mxCellState> otherStates, mxGraphView view) {
    List<SnapResult> result = ListSequence.fromList(new ArrayList<SnapResult>());
    for (mxCellState state : ListSequence.fromList(otherStates)) {
      if (isApplicable(movingState, state)) {
        ListSequence.fromList(result).addSequence(ListSequence.fromList(this.snap(dx, dy, distanceLimit, movingState, state, view)));
      }
    }
    return result;
  }

  protected boolean isApplicable(mxCellState movingState, mxCellState otherState) {
    boolean sameType = movingState.getCell().getClass().isAssignableFrom(otherState.getCell().getClass()) || otherState.getCell().getClass().isAssignableFrom(movingState.getCell().getClass());

    SubDiagramDCell subdiagram1 = JGraphUtil.getAncestor(((mxCell) movingState.getCell()), SubDiagramDCell.class);
    SubDiagramDCell subdiagram2 = JGraphUtil.getAncestor(((mxCell) otherState.getCell()), SubDiagramDCell.class);
    boolean sameSubdiagram = subdiagram1 == subdiagram2;

    return sameType && sameSubdiagram;
  }
}
