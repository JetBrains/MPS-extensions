package nl.f1re.testing.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorComponent;
import jetbrains.mps.nodeEditor.EditorComponentSettingsImpl;
import de.slisson.mps.reflection.runtime.ReflectionUtil;
import jetbrains.mps.ide.ThreadUtils;
import jetbrains.mps.openapi.editor.assist.ContextAssistantManager;

/**
 * This class can be called from places where there is no write/read access to the model like editor node test cases.
 */
public class EditorComponentTestHelper {

  private EditorComponent editorComponent;

  public EditorComponentTestHelper(EditorComponent editorComponent) {
    this.editorComponent = editorComponent;
  }

  public void increaseUIScale() {
    EditorComponentSettingsImpl settings = (EditorComponentSettingsImpl) editorComponent.getEditorComponentSettings();
    ReflectionUtil.callVoidMethod(EditorComponentSettingsImpl.class, settings, "increaseUIScale", new Class[]{}, new Object[]{});
    ThreadUtils.runInUIThreadAndWait(() -> editorComponent.getEditorContext().getRepository().getModelAccess().runReadAction(() -> editorComponent.rebuildEditorContent()));
  }

  public void decreaseUIScale() {
    EditorComponentSettingsImpl settings = (EditorComponentSettingsImpl) editorComponent.getEditorComponentSettings();
    ReflectionUtil.callVoidMethod(EditorComponentSettingsImpl.class, settings, "decreaseUIScale", new Class[]{}, new Object[]{});
    ThreadUtils.runInUIThreadAndWait(() -> editorComponent.getEditorContext().getRepository().getModelAccess().runReadAction(() -> editorComponent.rebuildEditorContent()));
  }

  public void resetUIScale() {
    EditorComponentSettingsImpl settings = (EditorComponentSettingsImpl) editorComponent.getEditorComponentSettings();
    ReflectionUtil.callVoidMethod(EditorComponentSettingsImpl.class, settings, "reset", new Class[]{}, new Object[]{});
    ThreadUtils.runInUIThreadAndWait(() -> editorComponent.getEditorContext().getRepository().getModelAccess().runReadAction(() -> editorComponent.rebuildEditorContent()));
  }

  public ContextAssistantManager openContextAssistant() {
    ContextAssistantManager manager = editorComponent.getEditorContext().getContextAssistantManager();
    manager.updateImmediately();
    return manager;
  }
}
