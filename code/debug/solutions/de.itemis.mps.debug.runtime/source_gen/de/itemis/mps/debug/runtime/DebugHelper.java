package de.itemis.mps.debug.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorComponent;
import jetbrains.mps.project.Project;
import jetbrains.mps.ide.project.ProjectHelper;
import com.intellij.openapi.fileEditor.FileEditor;
import com.intellij.openapi.fileEditor.FileEditorManager;
import jetbrains.mps.ide.editor.MPSFileNodeEditor;
import jetbrains.mps.nodeEditor.NodeEditorComponent;
import jetbrains.mps.openapi.editor.Editor;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import org.jetbrains.mps.openapi.model.SNode;

public class DebugHelper {
  public static EditorComponent getCurrentEditorComponent(Project project) {
    com.intellij.openapi.project.Project ideaProject = ProjectHelper.toIdeaProject(project);
    FileEditor editor = FileEditorManager.getInstance(ideaProject).getSelectedEditor();
    if (editor instanceof MPSFileNodeEditor) {
      return getEditorComponentFromEditor((as_xq22n4_a0a0a0c0a(editor, MPSFileNodeEditor.class)));
    }
    return null;
  }

  public static EditorComponent getEditorComponent(Project project, int hashCode) {
    com.intellij.openapi.project.Project ideaProject = ProjectHelper.toIdeaProject(project);
    FileEditor[] editors = FileEditorManager.getInstance(ideaProject).getAllEditors();
    for (FileEditor editor : editors) {
      if (editor instanceof MPSFileNodeEditor) {
        EditorComponent currentEditorComponent = getEditorComponentFromEditor(as_xq22n4_a0a0a0a0c0c(editor, MPSFileNodeEditor.class));
        if (currentEditorComponent.hashCode() == hashCode) {
          return currentEditorComponent;
        }
        if (currentEditorComponent instanceof NodeEditorComponent) {
          NodeEditorComponent currentNodeEditorComponent = ((NodeEditorComponent) currentEditorComponent);
          jetbrains.mps.nodeEditor.EditorComponent inspectorComponent = currentNodeEditorComponent.getInspector();
          if (inspectorComponent.hashCode() == hashCode) {
            return inspectorComponent;
          }
        }
      }
    }
    return null;
  }

  public static EditorComponent getEditorComponentFromEditor(MPSFileNodeEditor editor) {
    MPSFileNodeEditor mpsEditor = ((MPSFileNodeEditor) editor);
    Editor nodeEditor = mpsEditor.getNodeEditor();
    if (nodeEditor != null) {
      return nodeEditor.getCurrentEditorComponent();
    }
    return null;
  }

  public static EditorCell getEditorCell(Project project, SNode target, String cellID, int componentHashCode) {
    EditorComponent editorComponent = getEditorComponent(project, componentHashCode);
    if (editorComponent == null) {
      return null;
    }
    return editorComponent.findCellWithId(target, cellID);
  }

  private static <T> T as_xq22n4_a0a0a0c0a(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_xq22n4_a0a0a0a0c0c(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
