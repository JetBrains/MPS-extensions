package de.itemis.mps.editor.diagram.runtime.model;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.cells.EditorCell;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.openapi.editor.style.Style;
import org.jetbrains.annotations.Nullable;
import de.itemis.mps.editor.diagram.runtime.EditorUtil;
import de.itemis.mps.editor.diagram.runtime.jgraph.RootDiagramECell;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;

public abstract class AbstractDiagramElementAccessor implements IDiagramElementAccessor {
  private EditorCell myRootCell;
  @NotNull
  private IAccessorKey myId;
  protected IDiagramAccessor myDiagramAccessor;
  private Style myStyle;

  public AbstractDiagramElementAccessor(IAccessorKey id) {
    myId = id;
  }

  public void setParentDiagramAccessor(IDiagramAccessor diagramAccessor) {
    myDiagramAccessor = diagramAccessor;
  }

  public IDiagramAccessor getParentDiagramAccessor() {
    return myDiagramAccessor;
  }

  @NotNull
  @Override
  public IAccessorKey getId() {
    return myId;
  }

  @Override
  public EditorCell getRootEditorCell() {
    return myRootCell;
  }

  public void setRootCell(@Nullable EditorCell cell) {
    if (cell != null) {
      if (!(EditorUtil.descendants(cell, RootDiagramECell.class).isEmpty())) {
        throw new IllegalArgumentException("Cell contains a root diagram cell. It should contain only subdiagram cells.");
      }
    }
    if (myRootCell != null && myStyle != null) {
      getRootEditorCell().getStyle().remove(myStyle);
    }
    myRootCell = cell;
    if (myRootCell != null && myStyle != null) {
      myRootCell.getStyle().add(myStyle);
    }
  }

  @NotNull
  @Override
  public List<EditorCell> getContentCells() {
    return new ArrayList<EditorCell>();
  }

  @Nullable
  public List<? extends IDiagramElementAccessor> getElements(IAccessorFactory accessorFactory) {
    return null;
  }

  @Nullable
  public List<? extends IEndpointRedirect> getEndpointRedirects() {
    return null;
  }

  @Nullable
  public Style getStyle() {
    return (myStyle == null ? check_yh8rcp_a0a0x(getRootEditorCell(), this) : myStyle);
  }

  public void setStyle(Style style) {
    myStyle = style;
    check_yh8rcp_a1a52(check_yh8rcp_a0b0z(getRootEditorCell(), this), style, this);
  }

  @Override
  public void delete() {
    SNodeOperations.deleteNode(getSNode());
  }

  @NotNull
  protected SNode getOrCreateLayoutData(SAbstractConcept layoutDataConcept) {
    SNode layout = myDiagramAccessor.getLayoutData(getId());
    if (layout == null || !(SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(layout)), SNodeOperations.asSConcept(layoutDataConcept)))) {
      layout = SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(layoutDataConcept));
      myDiagramAccessor.storeLayoutData(getId(), layout);
    }
    return layout;
  }
  private static Style check_yh8rcp_a0a0x(EditorCell checkedDotOperand, AbstractDiagramElementAccessor checkedDotThisExpression) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getStyle();
    }
    return null;
  }
  private static void check_yh8rcp_a1a52(Style checkedDotOperand, Style style, AbstractDiagramElementAccessor checkedDotThisExpression) {
    if (null != checkedDotOperand) {
      checkedDotOperand.add(style);
    }

  }
  private static Style check_yh8rcp_a0b0z(EditorCell checkedDotOperand, AbstractDiagramElementAccessor checkedDotThisExpression) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getStyle();
    }
    return null;
  }
}
