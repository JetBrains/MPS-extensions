package de.slisson.mps.tables.runtime.gridmodel;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import de.slisson.mps.tables.runtime.cells.PartialTableExtractor;
import jetbrains.mps.openapi.editor.cells.SubstituteInfo;
import jetbrains.mps.openapi.editor.cells.CellAction;
import jetbrains.mps.openapi.editor.style.StyleAttribute;
import jetbrains.mps.openapi.editor.cells.CellActionType;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;

public class GridAdapter extends GridAdapterBase implements ITableGrid {
  private Grid myGrid;
  private EditorContext myEditorContext;
  private SNode mySNode;
  private EditorCellFactory myEditorCellFactory;

  public GridAdapter(Grid grid, EditorContext editorContext, SNode snode) {
    myGrid = grid;
    myEditorContext = editorContext;
    mySNode = snode;
    myEditorCellFactory = new EditorCellFactory(myEditorContext, mySNode, grid);
  }

  public Grid getGrid() {
    return myGrid;
  }

  public int getSizeX() {
    return myGrid.getSizeX();
  }

  public int getSizeY() {
    return myGrid.getSizeY();
  }

  public void setSize(int sizeX, int sizeY) {
    myGrid.setSize(sizeX, sizeY);
  }

  public void setCell(int x, int y, SNode node) {
    EditorCell cell = myEditorCellFactory.fromNode(node);
    setCell(x, y, cell);
  }

  public void setCell(int x, int y, EditorCell cell) {
    myGrid.replaceElement(x, y, PartialTableExtractor.getGridElementFromEditorCell(cell, myGrid));
  }

  public void setCell(int x, int y, IGridElement element) {
    myGrid.replaceElement(x, y, element);
  }

  public IGridElement getCell(int x, int y) {
    return myGrid.getElement(x, y);
  }

  protected Header createHeader(SNode node) {
    EditorCell cell = myEditorCellFactory.fromNode(node);
    HeaderReference headerReference = StringHeaderReference.fromSNode(node);
    EditorCellHeader header = new EditorCellHeader(headerReference, cell);
    return header;
  }
  protected Header createHeader(String title) {
    EditorCell cell = myEditorCellFactory.createConstant(title);
    HeaderReference headerReference = new StringHeaderReference(title);
    EditorCellHeader header = new EditorCellHeader(headerReference, cell);
    return header;
  }
  protected Header createHeader(EditorCell cell) {
    HeaderReference headerReference = StringHeaderReference.fromObject(cell);
    EditorCellHeader header = new EditorCellHeader(headerReference, cell);
    return header;
  }
  protected void setColumnHeader(int x, int y, int spanX, int spanY, Header header) {
    myGrid.setColumnHeader(x, y, header);
    for (int i = 0; i < spanX; i++) {
      for (int k = 0; k < spanY; k++) {
        if (i == 0 && k == 0) {
          continue;
        }
        myGrid.setColumnHeader(x + i, y + k, header.getReference());
      }
    }
  }
  protected void setRowHeader(int x, int y, int spanX, int spanY, Header header) {
    myGrid.setRowHeader(x, y, header);
    for (int i = 0; i < spanX; i++) {
      for (int k = 0; k < spanY; k++) {
        if (i == 0 && k == 0) {
          continue;
        }
        myGrid.setRowHeader(x + i, y + k, header.getReference());
      }
    }
  }
  public void setSubstituteInfo(int x, int y, SubstituteInfo info) {
    IGridElement element = (myGrid.isValidPosition(x, y) ? myGrid.getElement(x, y) : null);
    if (element == null || check_kx6e84_a0b0cb(as_kx6e84_a0a0b0cb(element, IGrid.class))) {
      element = new EditorCellGridLeaf(myEditorCellFactory.createPlaceholderConstant(""));
      myGrid.setElement(x, y, element);
    }
    element.setSubstituteInfo(info);
  }
  @Override
  public void setInsertAction(int x, int y, CellAction action) {
    myGrid.ensureSize(x + 1, y + 1);
    myGrid.getElement(x, y).setInsertAction(action);
  }
  @Override
  public void setInsertBeforeAction(int x, int y, CellAction action) {
    myGrid.ensureSize(x + 1, y + 1);
    myGrid.getElement(x, y).setInsertBeforeAction(action);
  }

  public void setColumnInsertAction(int x, int y, CellAction action) {
    HeaderReference headerRef = myGrid.getColumnHeader(x, y);
    Header header = myGrid.findHeader(headerRef);
    header.setInsertAction(action);
  }
  public void setColumnInsertBeforeAction(int x, int y, CellAction action) {
    HeaderReference headerRef = myGrid.getColumnHeader(x, y);
    Header header = myGrid.findHeader(headerRef);
    header.setInsertBeforeAction(action);
  }
  public void setRowInsertAction(int x, int y, CellAction action) {
    HeaderReference headerRef = myGrid.getRowHeader(x, y);
    Header header = myGrid.findHeader(headerRef);
    header.setInsertAction(action);
  }
  public void setRowInsertBeforeAction(int x, int y, CellAction action) {
    HeaderReference headerRef = myGrid.getRowHeader(x, y);
    Header header = myGrid.findHeader(headerRef);
    header.setInsertBeforeAction(action);
  }
  public <T> void setColumnHeaderStyle(int x, int y, StyleAttribute<T> styleAttribute, T value) {
    myGrid.findHeader(myGrid.getColumnHeader(x, y)).getStyle().set(styleAttribute, value);
  }
  public <T> void setRowHeaderStyle(int x, int y, StyleAttribute<T> styleAttribute, T value) {
    myGrid.findHeader(myGrid.getRowHeader(x, y)).getStyle().set(styleAttribute, value);
  }

  @Override
  public void setEndCellAction(CellActionType type, _FunctionTypes._return_P2_E0<? extends CellAction, ? super EditorCell, ? super Boolean> creator) {
    myGrid.setEndCellAction(type, creator);
  }

  @Override
  public _FunctionTypes._return_P2_E0<? extends CellAction, ? super EditorCell, ? super Boolean> getEndCellAction(CellActionType type) {
    return myGrid.getEndCellAction(type);
  }
  private static boolean check_kx6e84_a0b0cb(IGrid checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.isEmpty();
    }
    return false;
  }
  private static <T> T as_kx6e84_a0a0b0cb(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
