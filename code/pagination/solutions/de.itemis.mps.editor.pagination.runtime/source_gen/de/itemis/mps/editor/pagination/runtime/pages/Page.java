package de.itemis.mps.editor.pagination.runtime.pages;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public class Page implements PageIterator<Page> {
  private final PageNumber pageNumber;
  private final int pageSize;
  private final int fromIndex;
  private final int toIndex;

  public Page(PageNumber pageNumber, int pageSize) {
    if (pageSize < 0) {
      throw new IllegalArgumentException("The page size must be positive, given " + pageSize);
    }
    this.pageNumber = pageNumber;
    this.pageSize = pageSize;
    this.fromIndex = (pageNumber.getValue() - 1) * pageSize;
    this.toIndex = fromIndex + pageSize - 1;
  }

  public Page(int pageSize) {
    this(new PageNumber(), pageSize);
  }

  public Page(int pageNumber, int pageSize) {
    this(new PageNumber(pageNumber), pageSize);
  }

  public boolean contains(SNode n) {
    return contains(SNodeOperations.getIndexInParent(n));
  }

  public boolean contains(int index) {
    return index >= fromIndex && index <= toIndex;
  }

  public boolean hasNext() {
    return true;
  }

  public Page next() {
    return (hasNext() ? new Page(getPageNumber().next(), getPageSize()) : this);
  }

  public boolean hasPrevious() {
    return getPageNumber().hasPrevious();
  }

  public Page previous() {
    return (hasPrevious() ? new Page(getPageNumber().previous(), getPageSize()) : this);
  }

  public PageNumber getPageNumber() {
    return this.pageNumber;
  }

  public int getPageSize() {
    return this.pageSize;
  }

  @Override
  public boolean equals(Object obj) {
    if (obj instanceof Page) {
      Page otherAsPage = ((Page) obj);
      return otherAsPage.getPageNumber().equals(getPageNumber()) && otherAsPage.getPageSize() == getPageSize();
    }
    return super.equals(obj);
  }

  @Override
  public int hashCode() {
    return getPageNumber().hashCode() * 31 + getPageSize();
  }

  @Override
  public String toString() {
    return String.format("page %s of size %d", getPageNumber().toString(), getPageSize());
  }
}
