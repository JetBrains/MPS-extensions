package de.itemis.mps.changelog.intentions;

/*Generated by MPS */

import de.itemis.mps.selection.runtime.intentions.AbstractSelectionIntentionFactory;
import java.util.List;
import de.itemis.mps.selection.runtime.intentions.ISelectionIntentionExecutable;
import jetbrains.mps.lang.text.editor.WordRangeSelection;
import de.itemis.mps.selection.runtime.intentions.AbstractSelectionIntentionExecutable;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.IterableUtils;
import jetbrains.mps.lang.text.behavior.TextElement__BehaviorDescriptor;
import java.util.Collections;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public class MergeIntoOneWord extends AbstractSelectionIntentionFactory {
  public MergeIntoOneWord() {
  }

  @Override
  public List<ISelectionIntentionExecutable> getInstances(Object selection) {
    if (selection instanceof WordRangeSelection) {
      ISelectionIntentionExecutable intention = new AbstractSelectionIntentionExecutable<WordRangeSelection>() {
        @Override
        public void execute(WordRangeSelection selection) {
          List<SNode> selectedNodes = selection.getSelectedNodes();
          List<SNode> selectedWords = ListSequence.fromList(selectedNodes).select((it) -> SNodeOperations.as(it, CONCEPTS.Word$Dn)).toList();
          String newText = IterableUtils.join(ListSequence.fromList(selectedWords).select((it) -> (String) TextElement__BehaviorDescriptor.getTextualRepresentation_idfB3l81it7u.invoke(it)), "Â ");
          SNode newWord = createWord_lmmf70_a0d0a(newText);
          SNodeOperations.replaceWithAnother(ListSequence.fromList(selectedWords).first(), newWord);
          ListSequence.fromList(selectedWords).skip(1).visitAll((it) -> SNodeOperations.deleteNode(it));
          selection.getEditorComponent().getEditorContext().selectWRTFocusPolicy(newWord);
        }
        @Override
        public String getDescription(WordRangeSelection selection) {
          return "Merge Into One Word";
        }
        @Override
        public boolean isApplicable(WordRangeSelection selection) {
          List<SNode> selectedNodes = selection.getSelectedNodes();
          return ListSequence.fromList(selectedNodes).all((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.Word$Dn)) && ListSequence.fromList(selectedNodes).count() > 1;
        }
      };
      return Collections.singletonList(intention);
    } else {
      return Collections.<ISelectionIntentionExecutable>emptyList();
    }
  }
  private static SNode createWord_lmmf70_a0d0a(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.Word$Dn);
    n0.setProperty(PROPS.value$zQr_, p0);
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Word$Dn = MetaAdapterFactory.getConcept(0xc7fb639fbe784307L, 0x89b0b5959c3fa8c8L, 0x229012ddae35f04L, "jetbrains.mps.lang.text.structure.Word");
  }

  private static final class PROPS {
    /*package*/ static final SProperty value$zQr_ = MetaAdapterFactory.getProperty(0xc7fb639fbe784307L, 0x89b0b5959c3fa8c8L, 0x229012ddae35f04L, 0x229012ddae35f05L, "value");
  }
}
