package de.itemis.mps.editor.math.runtime;

/*Generated by MPS */

import java.awt.Graphics2D;
import java.awt.geom.Rectangle2D;
import java.awt.Stroke;
import java.awt.BasicStroke;
import java.awt.geom.Path2D;
import java.awt.geom.AffineTransform;
import java.awt.geom.Arc2D;
import java.awt.geom.Line2D;

public class MathDrawUtil {

  private Graphics2D myGraphics;
  private static final double thickScaleFactor = 0.045;
  private static final double thinScaleFactor = 0.008;
  private static final double offset = 1.0;

  public MathDrawUtil(Graphics2D g) {
    myGraphics = g;
  }

  public Graphics2D createRelativeGraphics(Rectangle2D rect) {
    Graphics2D g = (Graphics2D) myGraphics.create();
    g.translate(rect.getX(), rect.getY());
    g.scale(rect.getWidth(), rect.getHeight());
    return g;
  }

  private double getCharacteristicNumber(Rectangle2D rect) {
    return rect.getHeight();
  }

  public Stroke getThinStroke(Rectangle2D rect) {
    return new BasicStroke((float) (getCharacteristicNumber(rect) * thinScaleFactor + offset), BasicStroke.CAP_BUTT, BasicStroke.JOIN_BEVEL);
  }
  public void setThinStroke(Rectangle2D rect) {
    myGraphics.setStroke(getThinStroke(rect));
  }
  public void setThickStroke(Rectangle2D rect) {
    myGraphics.setStroke(getThickStroke(rect));
  }
  public Stroke getThickStroke(Rectangle2D rect) {
    return new BasicStroke((float) (getCharacteristicNumber(rect) * thickScaleFactor + offset), BasicStroke.CAP_BUTT, BasicStroke.JOIN_ROUND);
  }

  public void drawString(String text, Rectangle2D targetRect) {
    drawString(myGraphics, text, targetRect);
  }

  public static Path2D changeBounds(Path2D path, Rectangle2D bounds) {
    Path2D copy = (Path2D) path.clone();
    Rectangle2D pathBounds = path.getBounds2D();
    AffineTransform toRelative = AffineTransform.getScaleInstance(1.0 / pathBounds.getWidth(), 1.0 / pathBounds.getHeight());
    toRelative.translate(-pathBounds.getX(), -pathBounds.getY());
    copy.transform(toRelative);

    AffineTransform toTarget = AffineTransform.getTranslateInstance(bounds.getX(), bounds.getY());
    toTarget.scale(bounds.getWidth(), bounds.getHeight());
    copy.transform(toTarget);
    return copy;
  }

  public static void drawString(Graphics2D g, String text, Rectangle2D targetRect) {
    if (targetRect.getWidth() == 0.0 && targetRect.getHeight() == 0.0) {
      return;
    }
    Graphics2D g2 = (Graphics2D) g.create();
    Rectangle2D symbolSize = g2.getFontMetrics().getStringBounds(text, g2);
    g2.translate(targetRect.getX(), targetRect.getY());
    g2.scale(targetRect.getWidth() / symbolSize.getWidth(), targetRect.getHeight() / symbolSize.getHeight());
    g2.drawString(text, (float) -symbolSize.getX(), (float) -symbolSize.getY());
    g2.dispose();
  }

  public void drawLeftParenthesis(Rectangle2D rect) {
    drawLeftParenthesis(myGraphics, rect);
  }

  public static void drawLeftParenthesis(Graphics2D g, Rectangle2D rect) {
    Path2D.Double path = new Path2D.Double();

    path.append(buildArcLeft(rect, Math.PI / 6, false), false);

    Rectangle2D bounds2 = rect.getBounds2D();
    bounds2.setRect(bounds2.getX() + bounds2.getWidth() / 3, bounds2.getY(), bounds2.getWidth() / 3 * 2, bounds2.getHeight());
    Arc2D arc2 = buildArcLeft(bounds2, Math.PI / 6, true);
    path.append(arc2, true);
    g.fill(path);
    g.draw(buildArcLeft(rect, Math.PI / 6, false));
  }

  public static void drawRightParenthesis(Graphics2D g, Rectangle2D rect) {
    Graphics2D g2 = (Graphics2D) g.create();
    g2.scale(-1.0, 1.0);
    g2.translate(-(rect.getX() * 2 + rect.getWidth()), 0);
    drawLeftParenthesis(g2, rect);
  }

  public void drawRightParenthesis(Rectangle2D rect) {
    drawRightParenthesis(myGraphics, rect);
  }

  public static Arc2D buildArcLeft(Rectangle2D rect, double halfAngle, boolean reversed) {
    double arcHalfAngle = halfAngle;
    double arcRelWidth = 1.0 - Math.cos(arcHalfAngle);
    double arcRelHeight = Math.sin(arcHalfAngle) * 2;

    double circleX = rect.getX();
    double circleHeight = rect.getHeight() / arcRelHeight * 2;
    double circleY = rect.getY() - (circleHeight - rect.getHeight()) / 2;
    double circleWidth = rect.getWidth() / arcRelWidth * 2;

    double startAngle = (reversed ? Math.PI + arcHalfAngle : Math.PI - arcHalfAngle);
    double extendAngle = arcHalfAngle * 2 * ((reversed ? -1 : 1));
    Arc2D.Double arc = new Arc2D.Double(circleX, circleY, circleWidth, circleHeight, (startAngle) * 180 / Math.PI, extendAngle * 180 / Math.PI, Arc2D.OPEN);
    return arc;
  }

  public Arc2D buildArcRight(Rectangle2D rect, double halfAngle, boolean reversed) {
    double arcHalfAngle = halfAngle;
    double arcRelWidth = 1.0 - Math.cos(arcHalfAngle);
    double arcRelHeight = Math.sin(arcHalfAngle) * 2;

    double circleWidth = rect.getWidth() / arcRelWidth * 2;
    double circleX = rect.getX() - circleWidth + rect.getWidth();
    double circleHeight = rect.getHeight() / arcRelHeight * 2;
    double circleY = rect.getY() - (circleHeight - rect.getHeight()) / 2;

    double startAngle = (reversed ? arcHalfAngle : -arcHalfAngle);
    double extendAngle = arcHalfAngle * 2 * ((reversed ? -1 : 1));
    Arc2D.Double arc = new Arc2D.Double(circleX, circleY, circleWidth, circleHeight, (startAngle) * 180 / Math.PI, extendAngle * 180 / Math.PI, Arc2D.OPEN);
    return arc;
  }

  public void drawLineTop(Rectangle2D rect) {
    myGraphics.draw(new Line2D.Double(rect.getX(), rect.getY(), rect.getX() + rect.getWidth(), rect.getY()));
  }


  public void drawLineBottom(Rectangle2D rect) {
    myGraphics.draw(new Line2D.Double(rect.getX(), rect.getY() + rect.getHeight(), rect.getX() + rect.getWidth(), rect.getY() + rect.getHeight()));
  }

  public void drawLineLeft(Rectangle2D rect) {
    drawLineLeft(rect, 0);
  }
  public void drawLineLeft(Rectangle2D rect, int offset) {
    myGraphics.draw(new Line2D.Double(rect.getX() + offset, rect.getY(), rect.getX() + offset, rect.getY() + rect.getHeight()));
  }

  public void drawLineRight(Rectangle2D rect) {
    drawLineRight(rect, 0);
  }
  public void drawLineRight(Rectangle2D rect, int offset) {
    myGraphics.draw(new Line2D.Double(rect.getX() + rect.getWidth() - offset, rect.getY(), rect.getX() + rect.getWidth() - offset, rect.getY() + rect.getHeight()));
  }
}
