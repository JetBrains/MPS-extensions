package de.q60.mps.shadowmodels.runtime.mpslike;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.Sequence;

public class Genplan {
  private List<GenplanStep> steps = ListSequence.fromList(new ArrayList<GenplanStep>());

  public Genplan(Iterable<GenplanStep> steps) {
    this.steps = ListSequence.fromListWithValues(new ArrayList<GenplanStep>(), steps);
  }

  public Iterable<GenplanStep> getSteps() {
    return steps;
  }

  public int getStepNumber(final MappingConfigurationId id) {
    return ListSequence.fromList(steps).select((it) -> it.contains(id)).indexOf(true);
  }

  public Genplan insertStep(int index) {
    if (index < 0) {
      throw new IllegalArgumentException(index + " < 0");
    }
    if (index > ListSequence.fromList(steps).count()) {
      throw new IllegalArgumentException(index + " < " + ListSequence.fromList(steps).count());
    }
    return new Genplan(ListSequence.fromList(steps).headListSequence(index).concat(Sequence.fromIterable(Sequence.<GenplanStep>singleton(new GenplanStep()))).concat(ListSequence.fromList(steps).skip(index)));
  }

  public Genplan moveTo(int targetIndex, MappingConfigurationId mappingConfiguration) {
    int currentIndex = getStepNumber(mappingConfiguration);
    if (currentIndex == targetIndex) {
      return this;
    }

    List<GenplanStep> newSteps = ListSequence.fromListWithValues(new ArrayList<GenplanStep>(), steps);
    while (ListSequence.fromList(newSteps).count() <= targetIndex) {
      ListSequence.fromList(newSteps).addElement(new GenplanStep());
    }

    ListSequence.fromList(newSteps).setElement(currentIndex, ListSequence.fromList(newSteps).getElement(currentIndex).without(mappingConfiguration));
    ListSequence.fromList(newSteps).setElement(targetIndex, ListSequence.fromList(newSteps).getElement(targetIndex).with(mappingConfiguration));

    return new Genplan(newSteps);
  }

  public GenplanStep getStep(int stepNumber) {
    return ListSequence.fromList(steps).getElement(stepNumber);
  }

  @Override
  public boolean equals(Object o) {
    if (this == o) {
      return true;
    }
    if (o == null || this.getClass() != o.getClass()) {
      return false;
    }

    Genplan that = (Genplan) o;
    if ((steps != null ? !(((Object) steps).equals(that.steps)) : that.steps != null)) {
      return false;
    }

    return true;
  }

  @Override
  public int hashCode() {
    int result = 0;
    result = 31 * result + ((steps != null ? ((Object) steps).hashCode() : 0));
    return result;
  }

  @Override
  public String toString() {
    StringBuilder sb = new StringBuilder();
    sb.append("genplan\n");
    int stepNumber = 0;
    for (GenplanStep step : ListSequence.fromList(steps)) {
      sb.append("  step ").append(stepNumber).append("\n");
      for (MappingConfigurationId mc : Sequence.fromIterable(step.getMappingConfigurations())) {
        sb.append("    ").append(mc.getId()).append("\n");
      }
      stepNumber++;
    }
    return sb.toString();
  }
}
