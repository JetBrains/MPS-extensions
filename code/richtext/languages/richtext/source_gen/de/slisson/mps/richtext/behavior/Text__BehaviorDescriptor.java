package de.slisson.mps.richtext.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.annotations.Nullable;
import de.slisson.mps.hacks.editor.SavedCaretPosition;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public final class Text__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9e4e61L, "de.slisson.mps.richtext.structure.Text");

  public static final SMethod<Void> normalizeStructure_id4Lll81Ty9os = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("normalizeStructure").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5500395430674470428L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2(SMethodBuilder.createJavaParameter(EditorContext.class, ""));
  public static final SMethod<Boolean> isNormalized_idIKrxbBHaGP = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isNormalized").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(842294157794126645L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2();
  public static final SMethod<Void> ensureNormalized_id3mI$71cQ6Aw = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("ensureNormalized").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3868187941957822880L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2();
  public static final SMethod<Void> ensureNormalized_id1xf6IA5Se_N = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("ensureNormalized").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1751648370346223987L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2(SMethodBuilder.createJavaParameter(EditorContext.class, ""));
  public static final SMethod<Iterable<String>> getTextLines_id7T88Na6$wwy = new SMethodBuilder<Iterable<String>>(new SJavaCompoundTypeImpl((Class<Iterable<String>>) ((Class) Object.class))).name("getTextLines").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(9099561747015141410L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2();
  public static final SMethod<String> asTextString_id3Q5enzfMT4l = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("asTextString").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4433012599261204757L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2();
  public static final SMethod<SNode> getSelectedWord_id5Zn2KFQUdoe = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("getSelectedWord").modifiers(1, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6906000695315977742L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2(SMethodBuilder.createJavaParameter(EditorContext.class, ""));
  public static final SMethod<Boolean> isEmpty_id2ZHlC004czC = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isEmpty").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3453511597019941096L).languageId(0xa676c7604efe3504L, 0x92d2ea165a424fdfL).build2();

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(normalizeStructure_id4Lll81Ty9os, isNormalized_idIKrxbBHaGP, ensureNormalized_id3mI$71cQ6Aw, ensureNormalized_id1xf6IA5Se_N, getTextLines_id7T88Na6$wwy, asTextString_id3Q5enzfMT4l, getSelectedWord_id5Zn2KFQUdoe, isEmpty_id2ZHlC004czC);

  private static void ___init___(@NotNull SNode __thisNode__) {
    SLinkOperations.addNewChild(__thisNode__, LINKS.words$C8QZ, CONCEPTS.Word$5r);
  }

  /*package*/ static void normalizeStructure_id4Lll81Ty9os(@NotNull SNode __thisNode__, @Nullable EditorContext editorContext) {
    SavedCaretPosition caretPosition = null;
    if (editorContext != null) {
      caretPosition = new SavedCaretPosition(editorContext);
      caretPosition.save();
    }

    List<SNode> newWords = new ArrayList<SNode>();
    for (SNode word : ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ))) {
      if (SNodeOperations.isInstanceOf(word, CONCEPTS.Word$5r) && SNodeOperations.isInstanceOf(ListSequence.fromList(newWords).last(), CONCEPTS.Word$5r)) {
        // Merge two consecutive 'Word's
        String leftText = SPropertyOperations.getString(SNodeOperations.cast(ListSequence.fromList(newWords).last(), CONCEPTS.Word$5r), PROPS.escapedValue$2Lqz);
        String rightText = SPropertyOperations.getString(SNodeOperations.cast(word, CONCEPTS.Word$5r), PROPS.escapedValue$2Lqz);
        if (leftText == null) {
          leftText = "";
        }
        if (rightText == null) {
          rightText = "";
        }
        SPropertyOperations.assign(SNodeOperations.cast(ListSequence.fromList(newWords).last(), CONCEPTS.Word$5r), PROPS.escapedValue$2Lqz, leftText + "" + rightText);

      } else {
        // Always a 'Word' between two embedded nodes
        if (!(SNodeOperations.isInstanceOf(word, CONCEPTS.Word$5r)) && !(SNodeOperations.isInstanceOf(ListSequence.fromList(newWords).last(), CONCEPTS.Word$5r))) {
          ListSequence.fromList(newWords).addElement(SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9f2e0cL, "de.slisson.mps.richtext.structure.Word")));
        }
        // Everything is fine
        ListSequence.fromList(newWords).addElement(word);
      }
    }

    // End with a word
    if (!(SNodeOperations.isInstanceOf(ListSequence.fromList(newWords).last(), CONCEPTS.Word$5r))) {
      ListSequence.fromList(newWords).addElement(SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9f2e0cL, "de.slisson.mps.richtext.structure.Word")));
    }

    ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ)).clear();
    ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ)).addSequence(ListSequence.fromList(newWords));
    if (caretPosition != null) {
      caretPosition.restore();
    }
  }
  /*package*/ static boolean isNormalized_idIKrxbBHaGP(@NotNull SNode __thisNode__) {
    // contains at least one child
    if (ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ)).isEmpty()) {
      return false;
    }
    // starts with a 'Word'
    if (!(SNodeOperations.isInstanceOf(ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ)).first(), CONCEPTS.Word$5r))) {
      return false;
    }
    // ends with a 'Word'
    if (!(SNodeOperations.isInstanceOf(ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ)).last(), CONCEPTS.Word$5r))) {
      return false;
    }
    // A 'Word' between two embedded nodes and not two consecutive 'Word's
    for (SNode word : ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ))) {
      if ((SNodeOperations.getNextSibling(word) == null)) {
        continue;
      }
      if (!(SNodeOperations.isInstanceOf(word, CONCEPTS.Word$5r)) ^ SNodeOperations.isInstanceOf(SNodeOperations.getNextSibling(word), CONCEPTS.Word$5r)) {
        return false;
      }
    }

    return true;
  }
  /*package*/ static void ensureNormalized_id3mI$71cQ6Aw(@NotNull SNode __thisNode__) {
    Text__BehaviorDescriptor.ensureNormalized_id1xf6IA5Se_N.invoke(__thisNode__, null);
  }
  /*package*/ static void ensureNormalized_id1xf6IA5Se_N(@NotNull SNode __thisNode__, @Nullable EditorContext editorContext) {
    if (!((boolean) Text__BehaviorDescriptor.isNormalized_idIKrxbBHaGP.invoke(__thisNode__))) {
      Text__BehaviorDescriptor.normalizeStructure_id4Lll81Ty9os.invoke(__thisNode__, editorContext);
      if (!((boolean) Text__BehaviorDescriptor.isNormalized_idIKrxbBHaGP.invoke(__thisNode__))) {
        throw new RuntimeException("Failed to normalize the Text");
      }
    }
  }
  /*package*/ static Iterable<String> getTextLines_id7T88Na6$wwy(@NotNull SNode __thisNode__) {
    String textAsString = Text__BehaviorDescriptor.asTextString_id3Q5enzfMT4l.invoke(__thisNode__);
    textAsString = textAsString.replace("\r", "");
    return Sequence.fromArray(textAsString.split("\n"));
  }
  /*package*/ static String asTextString_id3Q5enzfMT4l(@NotNull SNode __thisNode__) {
    StringBuffer buffer = new StringBuffer();
    for (SNode word : ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.words$C8QZ))) {
      if (word != null) {
        buffer.append(IWord__BehaviorDescriptor.toTextString_id3Q5enzfMT4t.invoke(word));
      }
    }
    return trim_253g9j_a0c0u(buffer.toString());
  }
  @Nullable
  /*package*/ static SNode getSelectedWord_id5Zn2KFQUdoe(@NotNull SAbstractConcept __thisConcept__, EditorContext editorContext) {
    return SNodeOperations.as(editorContext.getSelectedNode(), CONCEPTS.Word$5r);
  }
  /*package*/ static boolean isEmpty_id2ZHlC004czC(@NotNull SNode __thisNode__) {
    return isEmptyString(Text__BehaviorDescriptor.asTextString_id3Q5enzfMT4l.invoke(__thisNode__));
  }

  /*package*/ Text__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        normalizeStructure_id4Lll81Ty9os(node, (EditorContext) parameters[0]);
        return null;
      case 1:
        return (T) ((Boolean) isNormalized_idIKrxbBHaGP(node));
      case 2:
        ensureNormalized_id3mI$71cQ6Aw(node);
        return null;
      case 3:
        ensureNormalized_id1xf6IA5Se_N(node, (EditorContext) parameters[0]);
        return null;
      case 4:
        return (T) ((Iterable<String>) getTextLines_id7T88Na6$wwy(node));
      case 5:
        return (T) ((String) asTextString_id3Q5enzfMT4l(node));
      case 7:
        return (T) ((Boolean) isEmpty_id2ZHlC004czC(node));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 6:
        return (T) ((SNode) getSelectedWord_id5Zn2KFQUdoe(concept, (EditorContext) parameters[0]));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }
  public static String trim_253g9j_a0c0u(String str) {
    return (str == null ? null : str.trim());
  }
  private static boolean isEmptyString(String str) {
    return str == null || str.isEmpty();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink words$C8QZ = MetaAdapterFactory.getContainmentLink(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9e4e61L, 0x237c8da86a9e7aeeL, "words");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Word$5r = MetaAdapterFactory.getConcept(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9f2e0cL, "de.slisson.mps.richtext.structure.Word");
  }

  private static final class PROPS {
    /*package*/ static final SProperty escapedValue$2Lqz = MetaAdapterFactory.getProperty(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9f2e0cL, 0x237c8da86a9f2e0eL, "escapedValue");
  }
}
