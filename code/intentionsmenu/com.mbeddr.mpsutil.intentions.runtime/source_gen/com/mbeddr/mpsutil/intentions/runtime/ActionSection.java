package com.mbeddr.mpsutil.intentions.runtime;

/*Generated by MPS */

import com.intellij.openapi.util.Key;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;
import com.mbeddr.mpsutil.intentions.behavior.SectionAnnotation__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import com.intellij.openapi.actionSystem.Presentation;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public final class ActionSection {
  private ActionSection() {
  }

  private static final Key<String> SECTION_KEY = new Key<>("section");

  private static Tuples._2<String, String> parseSectionAndText(String originalText) {
    if (originalText == null) {
      return MultiTuple.<String,String>from("", "");
    }

    int separatorPosition = originalText.indexOf(SectionAnnotation__BehaviorDescriptor.getSeparator_id24lzbKWhznQ.invoke(SNodeOperations.asSConcept(CONCEPTS.SectionAnnotation$yF)));
    if (separatorPosition < 0) {
      return MultiTuple.<String,String>from("", originalText);
    }

    String section = originalText.substring(0, separatorPosition);
    String text = StringUtils.stripStart(originalText.substring(separatorPosition + 1), " \n\r\t");

    return MultiTuple.<String,String>from(section, text);
  }

  /**
   * Update {@code presentation} section and text based on {@code originalText} .
   * 
   * @return the section parsed from originalText
   */
  public static String setSectionAndText(Presentation presentation, String originalText) {
    Tuples._2<String, String> sectionAndText = parseSectionAndText(originalText);

    setSection(presentation, sectionAndText._0());
    presentation.setText(sectionAndText._1());

    return sectionAndText._0();
  }

  public static void setSection(Presentation presentation, String section) {
    presentation.putClientProperty(SECTION_KEY, section);
  }

  public static String getSection(Presentation presentation) {
    return presentation.getClientProperty(SECTION_KEY);
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept SectionAnnotation$yF = MetaAdapterFactory.getConcept(0xb92f861d0184446dL, 0xb88b6dcf0e070241L, 0x5123265c29d0499fL, "com.mbeddr.mpsutil.intentions.structure.SectionAnnotation");
  }
}
