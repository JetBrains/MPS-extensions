package de.itemis.mps.editor.celllayout.runtime;

/*Generated by MPS */

import jetbrains.mps.logging.Logger;

public class LayoutWatchdog {
  private static final Logger LOG = Logger.getLogger(LayoutWatchdog.class);
  public static int DEFAULT_MAX_LAYOUTING_OPERATIONS = 1000000;

  public static int myLayoutingCountdown = -1;

  public static void enter(int timeoutValue, Runnable runnable) {
    int prevTimeout = myLayoutingCountdown;
    try {
      myLayoutingCountdown = timeoutValue;
      runnable.run();
    } catch (LayoutTimeoutException ex) {
      if (LOG.isWarningLevel()) {
        LOG.warning("Layouting timed out.", ex);
      }
    } finally {
      myLayoutingCountdown = prevTimeout;
    }
  }

  public static void enterIfRequired(int timeoutValue, Runnable runnable) {
    if (myLayoutingCountdown <= 0) {
      enter(timeoutValue, runnable);
    }

  }

  public static void countDown() {
    if (myLayoutingCountdown == 0) {
      throw new LayoutTimeoutException();
    }
    if (myLayoutingCountdown > 0) {
      myLayoutingCountdown--;
    }
  }

  public static class LayoutTimeoutException extends RuntimeException {
    public LayoutTimeoutException() {
      super("Layouting timed out.");
    }
  }
}
