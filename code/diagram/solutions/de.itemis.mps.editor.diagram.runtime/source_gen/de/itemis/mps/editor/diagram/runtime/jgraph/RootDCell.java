package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import java.util.List;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import com.mxgraph.view.mxCellState;
import de.itemis.mps.editor.diagram.runtime.model.DiagramModel;
import jetbrains.mps.openapi.editor.style.StyleAttribute;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.openapi.editor.EditorComponent;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import org.jetbrains.annotations.Nullable;
import de.itemis.mps.editor.diagram.runtime.model.IDiagramElement;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class RootDCell extends BaseDiagramDCell {
  protected Map<Integer, Boolean> buttonVisibility = MapSequence.fromMap(new HashMap<Integer, Boolean>());

  protected _FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState> rootButtonsCreator = null;
  protected _FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState> vertexButtonsCreator = null;
  protected _FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState> edgeButtonsCreator = null;

  public RootDCell(MyGraph graph) {
    super(graph);
  }

  public DiagramModel getDiagramModel() {
    return _getGraph().getRootDiagramModel();
  }
  public RootDiagramECell getECell() {
    return _getGraph().getGraphComponent().getDiagramCell();
  }

  public _FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState> getRootButtonsCreator() {
    return rootButtonsCreator;
  }

  public _FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState> getVertexButtonsCreator() {
    return vertexButtonsCreator;
  }

  public _FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState> getEdgeButtonsCreator() {
    return edgeButtonsCreator;
  }

  @Override
  public Map<Integer, Boolean> getButtonVisibilityMap() {
    return buttonVisibility;
  }

  public List<StyleAttribute> getButtonStyleAttributes() {
    return Sequence.fromIterable(Sequence.fromArray(new StyleAttribute[]{StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__move-to-diagram-viewer-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__move-to-diagram-viewer-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__maximize-diagram-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__reset-view-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__zoom-in-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__zoom-out-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__fit-size-all-diagram-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__show_ports_labels-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__translate-to-origin-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__show-grid-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__use_grid-snapping-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__export-png-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__export-svg-button"), StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__clear-layout-information-button")})).toList();
  }

  @Override
  public void updateButtonConfig(final Style style) {
    super.updateButtonConfig(style);
    ListSequence.fromList(getButtonStyleAttributes()).visitAll(new _FunctionTypes._void_P1_E0<StyleAttribute>() {
      public void invoke(StyleAttribute it) {
        setButtonVisibilityFromStyle(style, it);
      }
    });
    rootButtonsCreator = (_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState>) style.get(StyleAttributes.getInstance().<_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super jetbrains.mps.nodeEditor.EditorContext, ? super SNode, ? super mxCellState>>getAttribute("de.itemis.mps.editor.diagram.styles", "__root-button-creator"));
    vertexButtonsCreator = (_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState>) style.get(StyleAttributes.getInstance().<_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super jetbrains.mps.nodeEditor.EditorContext, ? super SNode, ? super mxCellState>>getAttribute("de.itemis.mps.editor.diagram.styles", "__vertex-button-creator"));
    edgeButtonsCreator = (_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super EditorContext, ? super SNode, ? super mxCellState>) style.get(StyleAttributes.getInstance().<_FunctionTypes._return_P3_E0<? extends List<ContextButton>, ? super jetbrains.mps.nodeEditor.EditorContext, ? super SNode, ? super mxCellState>>getAttribute("de.itemis.mps.editor.diagram.styles", "__edge-button-creator"));
  }

  @Override
  public void resetButtonConfig() {
    super.resetButtonConfig();
    ListSequence.fromList(getButtonStyleAttributes()).visitAll(new _FunctionTypes._void_P1_E0<StyleAttribute>() {
      public void invoke(StyleAttribute it) {
        resetButtonVisibility(it);
      }
    });
    rootButtonsCreator = null;
    vertexButtonsCreator = null;
    edgeButtonsCreator = null;
  }

  @Override
  protected List<ContextButton> createButtons(final mxCellState mxCellState) {
    final Wrappers._T<List<ContextButton>> buttons = new Wrappers._T<List<ContextButton>>();
    EditorComponent editorComponent = this._getGraph().getEditorComponent();
    EditorContext editorContext = editorComponent.getEditorContext();
    final SNode node = editorComponent.getEditedNode();

    if (rootButtonsCreator != null) {
      buttons.value = rootButtonsCreator.invoke(editorContext, node, mxCellState);
      return buttons.value;
    } else {
      buttons.value = super.createButtons(mxCellState);
    }

    final double size = ContextButton.DEFAULT_BUTTON_SIZE * getScale();


    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__maximize-diagram-button"))) {
      ListSequence.fromList(buttons.value).addElement(new MaximizeDiagramButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__reset-view-button"))) {
      ListSequence.fromList(buttons.value).addElement(new ResetViewButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__zoom-in-button"))) {
      ListSequence.fromList(buttons.value).addElement(new ZoomInButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__zoom-out-button")) && _getGraph().getView().getScale() > getDiagramModel().getDiagramAccessor().getMinimumScale()) {
      ListSequence.fromList(buttons.value).addElement(new ZoomOutButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__fit-size-all-diagram-button"))) {
      ListSequence.fromList(buttons.value).addElement(new FitSizeAllDiagramButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__show_ports_labels-button"))) {
      ListSequence.fromList(buttons.value).addElement(new TogglePortsLabelsButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__root-show-all-edges-button")) && Sequence.fromIterable(this.getDiagramModel().getBoxes()).any((it) -> it.getModel().hasInvisibleEdges(it))) {
      ListSequence.fromList(buttons.value).addElement(new ShowRootAllEdgesButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__translate-to-origin-button"))) {
      ListSequence.fromList(buttons.value).addElement(new TranslateToOriginButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__translate-to-origin-button"))) {
      ListSequence.fromList(buttons.value).addElement(new TranslateToOriginButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__show-grid-button"))) {
      ListSequence.fromList(buttons.value).addElement(new ToggleGridDiagramButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__use_grid-snapping-button"))) {
      ListSequence.fromList(buttons.value).addElement(new ToggleGridSnappingDiagramButton(size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__export-png-button"))) {
      ListSequence.fromList(buttons.value).addElement(new ExportDiagramAsPNGButton(size * 2, size, mxCellState));
    }

    if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__export-svg-button"))) {
      ListSequence.fromList(buttons.value).addElement(new ExportDiagramAsSVGButton(size * 2, size, mxCellState));
    }

    editorContext.getRepository().getModelAccess().runReadAction(() -> {
      if (getButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__clear-layout-information-button")) && (new IAttributeDescriptor.NodeAttribute(CONCEPTS.LayoutMap$4m).get(node) != null)) {
        ListSequence.fromList(buttons.value).addElement(new ClearLayoutDataButton(size, mxCellState));
      }
    });

    return buttons.value;
  }


  @Override
  protected void moveButtonsContainer(mxCellState state, ContextButtonContainer container) {
    container.moveTo(ContextButtonContainer.BUTTON_SPACING, ContextButtonContainer.BUTTON_SPACING);
  }

  @Nullable
  public IDiagramElement getDiagramElement() {
    return null;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept LayoutMap$4m = MetaAdapterFactory.getConcept(0x8ca79d43eb454791L, 0xbdd40d6130ff895bL, 0x7c646f09bb3f148eL, "de.itemis.mps.editor.diagram.layout.structure.LayoutMap");
  }
}
