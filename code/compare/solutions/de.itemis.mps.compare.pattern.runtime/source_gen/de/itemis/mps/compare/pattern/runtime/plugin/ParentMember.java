package de.itemis.mps.compare.pattern.runtime.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public class ParentMember extends PatternBuilderInitPart<IPatternEvaluator> {

  public ParentMember(Expression<IPatternEvaluator> inner, String annotation, boolean negated) {
    super(inner, annotation, negated);
  }

  public ParentMember(Expression<IPatternEvaluator> inner, String annotation) {
    this(inner, annotation, false);
  }

  public ParentMember(Expression<IPatternEvaluator> inner) {
    this(inner, null);
  }

  @Override
  public MatchResult match(SNode node) {
    if (node != null && SNodeOperations.getParent(node) != null) {
      MatchResult result;

      if (inner.getFirst() == null) {
        result = new MatchResult(true, null);
      } else {
        result = inner.getFirst().match(SNodeOperations.getParent(node));
      }

      result = result.xor(negated);

      if (result.isMatch() && shouldAnnotate()) {
        result.put(annotation, SNodeOperations.getParent(node));
      }
      return result;
    }
    return MatchResult.noMatch();
  }

  @Override
  public String toString() {
    return "parent@" + this.annotation + " = " + this.inner.getFirst();
  }

  @Override
  public SNode build(SNode node) {
    return node;
  }

}
