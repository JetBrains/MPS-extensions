package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import com.mxgraph.view.mxCellState;
import java.awt.Graphics2D;
import java.awt.BasicStroke;
import de.itemis.mps.editor.diagram.runtime.model.Bounds;
import de.itemis.mps.editor.diagram.runtime.model.Point;
import java.awt.geom.Line2D;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;

public class OpenNodeButton extends ContextButton {

  private SNode myTarget;

  public OpenNodeButton(double size, mxCellState state, SNode target) {
    super(size, state);
    myTarget = target;
  }

  @Override
  public void paint(Graphics2D g, boolean highlighted) {
    paintBackground(g, highlighted);

    g.setColor(LINE_COLOR);

    // frame
    g.setStroke(new BasicStroke((float) getLineWidth()));
    Bounds bounds = getBounds();
    drawLine(g, new Point(bounds.getCenterX(), bounds.getY()), bounds.getLeftTop());
    drawLine(g, bounds.getLeftTop(), bounds.getLeftBottom());
    drawLine(g, bounds.getLeftBottom(), bounds.getRightBottom());
    drawLine(g, bounds.getRightBottom(), new Point(bounds.getMaxX(), bounds.getCenterY()));

    // arrow
    g.setStroke(new BasicStroke((float) getLineWidth(), BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND));
    Bounds arrowBounds = getBounds();
    arrowBounds.scale(0.3);
    arrowBounds.setRightTop(getBounds().getRightTop());
    drawLine(g, arrowBounds.getLeftTop(), arrowBounds.getRightTop());
    drawLine(g, arrowBounds.getRightTop(), arrowBounds.getRightBottom());
    drawLine(g, arrowBounds.getRightTop(), bounds.getCenter());

  }

  public void drawLine(Graphics2D g, Point p1, Point p2) {
    g.draw(new Line2D.Double(ExtensionMethods.toPoint2D(p1), ExtensionMethods.toPoint2D(p2)));
  }

  @Override
  protected void execute() {
    DiagramActionsUtil.openNode(getGraph(), myTarget);
  }

  @Override
  public String getTooltip() {
    BaseDCell baseDCell = (BaseDCell) myCellState.getCell();
    MyGraph graph = baseDCell._getGraph();
    final Wrappers._T<String> presentation = new Wrappers._T<String>(null);
    graph.getRootDiagramModel().getEditorContext().getRepository().getModelAccess().runReadAction(() -> presentation.value = BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(myTarget));
    return "Jump to node: " + presentation.value;
  }
}
