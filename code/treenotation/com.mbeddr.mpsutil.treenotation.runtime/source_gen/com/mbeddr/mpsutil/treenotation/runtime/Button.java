package com.mbeddr.mpsutil.treenotation.runtime;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.cells.EditorCell_Basic;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import java.awt.Graphics;
import jetbrains.mps.nodeEditor.cells.ParentSettings;
import jetbrains.mps.editor.runtime.cells.ReadOnlyUtil;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.AlphaComposite;
import java.awt.geom.Rectangle2D;
import com.intellij.ui.JBColor;
import java.awt.BasicStroke;
import jetbrains.mps.nodeEditor.EditorComponent;
import java.awt.Rectangle;
import java.awt.event.MouseEvent;

public class Button extends EditorCell_Basic {

  public static int BUTTON_SIZE = 13;
  public static int BUTTON_HALF_SIZE = (BUTTON_SIZE + 1) / 2;

  private float myOpacity = 0.0f;

  public Button(@NotNull EditorContext editorContext, SNode node) {
    super(editorContext, node);
    setSelectable(true);
  }
  @Override
  protected void paintSelectionIfRequired(Graphics graphics, ParentSettings settings) {
  }

  protected boolean drawWhenReadonly() {
    return false;
  }

  protected void paintContent(Graphics g, ParentSettings settings) {
    if (ReadOnlyUtil.isCellReadOnly(this) && !(drawWhenReadonly())) {
      return;
    }

    float opacity = getOpacity();
    if (opacity > 0.0f) {
      Graphics2D g2 = ((Graphics2D) g.create());
      g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
      try {
        g2.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, opacity));
        Rectangle2D.Double bounds = new Rectangle2D.Double(getX(), getY(), getWidth(), getHeight());

        g2.setColor(JBColor.WHITE);
        g2.fill(bounds);

        g2.setColor(JBColor.BLACK);
        g2.setStroke(new BasicStroke(1.0f));
        if (opacity >= 1.0f) {
          g2.draw(bounds);
        }
        paintSymbol(g2);
      } finally {
        g2.dispose();
      }
    }
  }

  protected void paintSymbol(Graphics2D g) {
  }

  @Override
  protected void relayoutImpl() {
    myWidth = BUTTON_SIZE;
    myHeight = BUTTON_SIZE;
  }

  public void setOpacity(float opacity) {
    if (opacity != myOpacity) {
      myOpacity = opacity;
      EditorComponent component = ((EditorComponent) getEditorComponent());
      // Because of a bug in EditorComponent, we have to invalidate the whole width, otherwise, the highlighting
      // of the current line is not painted properly
      component.repaint(new Rectangle(0, getY() - 1, component.getWidth(), getHeight() + 2));
    }
  }

  public float getOpacity() {
    return myOpacity;
  }

  @Override
  public void onAdd() {
    super.onAdd();
    ButtonsMouseListener.registerCell(this);
  }

  @Override
  public void onRemove() {
    ButtonsMouseListener.unregisterUsage(this);
    super.onRemove();
  }

  @Deprecated
  public void onClick() {
  }

  public void onClick(MouseEvent event) {
    onClick();
  }
}
