package de.itemis.mps.editor.celllayout.layout;

/*Generated by MPS */

import org.jetbrains.annotations.Nullable;
import de.itemis.mps.editor.celllayout.runtime.CellLayoutUtil;
import de.itemis.mps.editor.celllayout.runtime.AbstractLayoutableAdapter;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.openapi.editor.TextBuilder;
import jetbrains.mps.editor.runtime.TextBuilderImpl;

public abstract class AbstractLayout implements ILayouter {

  protected int getGapBetweenCells(@Nullable ILayoutable left, @Nullable ILayoutable right) {
    return (hasGapBetweenCells(left, right) ? CellLayoutUtil.getCellGap(left.getParent()) : 0);
  }
  protected boolean hasGapBetweenCells(@Nullable ILayoutable left, @Nullable ILayoutable right) {
    if (left == null || right == null) {
      return false;
    }
    if (isEmptyCollection(left)) {
      return false;
    }

    if (check_7in3t2_a3a2(as_7in3t2_a0a3a2(left, AbstractLayoutableAdapter.class))) {
      return false;
    }
    if (check_7in3t2_a4a2(as_7in3t2_a0a4a2(right, AbstractLayoutableAdapter.class))) {
      return false;
    }

    if (check_7in3t2_a0g0c_0(as_7in3t2_a0a0g0c_0(left, AbstractLayoutableAdapter.class)) && check_7in3t2_a0g0c(as_7in3t2_a0a0g0c(right, AbstractLayoutableAdapter.class))) {
      // cells with a border already have a padding
      return false;
    }

    return true;
  }

  private boolean isEmptyCollection(ILayoutable layoutable) {
    return layoutable instanceof ILayoutableContainer && ListSequence.fromList(((ILayoutableContainer) layoutable).getChildren()).count() == 0;
  }

  protected boolean isChildGrowX(ILayoutable child) {
    if (child == null) {
      return false;
    }
    return child.isGrowX();
  }

  protected boolean isChildGrowY(ILayoutable child) {
    if (child == null) {
      return false;
    }
    return child.isGrowY();
  }

  protected boolean isChildPushX(ILayoutable child) {
    if (child == null) {
      return false;
    }
    return child.isPushX();
  }

  protected boolean isChildPushY(ILayoutable child) {
    if (child == null) {
      return false;
    }
    return child.isPushY();
  }

  protected Iterable<ILayoutable> getChildrenToMove(ILayoutableContainer container) {
    return container.getChildren();
  }

  @Override
  public void moveChildren(ILayoutableContainer container, int deltaX, int deltaY) {
    for (ILayoutable child : Sequence.fromIterable(getChildrenToMove(container))) {
      child.setPosition(child.getX() + deltaX, child.getY() + deltaY);
      child.relayout(LayoutableExtensions.getSize(child));
    }
  }

  @Override
  public Iterable<ILayoutable> getCellsForSelectionPainting(ILayoutableContainer container) {
    return Sequence.<ILayoutable>singleton(container);
  }

  @Override
  public TextBuilder toText(ILayoutableContainer container) {
    TextBuilderImpl text = new TextBuilderImpl();
    for (ILayoutable child : ListSequence.fromList(container.getChildren())) {
      text.appendToTheRight(child.toText(), true);
    }
    container.getChildren();
    return text;
  }

  @Override
  public boolean usesPunctuation() {
    return true;
  }
  private static boolean check_7in3t2_a3a2(AbstractLayoutableAdapter checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.hasPunctuationRight();
    }
    return false;
  }
  private static boolean check_7in3t2_a4a2(AbstractLayoutableAdapter checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.hasPunctuationLeft();
    }
    return false;
  }
  private static boolean check_7in3t2_a0g0c(AbstractLayoutableAdapter checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.hasBorder(true);
    }
    return false;
  }
  private static boolean check_7in3t2_a0g0c_0(AbstractLayoutableAdapter checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.hasBorder(false);
    }
    return false;
  }
  private static <T> T as_7in3t2_a0a3a2(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_7in3t2_a0a4a2(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_7in3t2_a0a0g0c(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_7in3t2_a0a0g0c_0(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
