package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import org.eclipse.elk.core.options.Direction;
import org.eclipse.elk.core.math.ElkMargin;
import org.eclipse.elk.alg.layered.options.EdgeStraighteningStrategy;
import org.eclipse.elk.alg.layered.options.FixedAlignment;
import org.eclipse.elk.alg.layered.options.OrderingStrategy;
import org.eclipse.elk.alg.layered.components.ComponentOrderingStrategy;
import java.util.EnumSet;
import org.eclipse.elk.core.options.ContentAlignment;
import org.eclipse.elk.alg.layered.options.CrossingMinimizationStrategy;
import org.eclipse.elk.alg.layered.options.CuttingStrategy;
import org.eclipse.elk.alg.layered.options.CycleBreakingStrategy;
import org.eclipse.elk.alg.layered.options.DirectionCongruency;
import org.eclipse.elk.alg.layered.options.CenterEdgeLabelPlacementStrategy;
import org.eclipse.elk.alg.layered.options.EdgeLabelSideSelection;
import org.eclipse.elk.alg.layered.options.WrappingStrategy;
import org.eclipse.elk.alg.layered.options.GreedySwitchType;
import org.eclipse.elk.alg.layered.options.InteractiveReferencePoint;
import org.eclipse.elk.alg.layered.options.LongEdgeOrderingStrategy;
import java.util.List;
import org.eclipse.elk.alg.layered.options.NodeFlexibility;
import org.eclipse.elk.core.math.ElkPadding;
import org.eclipse.elk.alg.layered.options.LayeringStrategy;
import org.eclipse.elk.alg.layered.options.NodePlacementStrategy;
import org.eclipse.elk.alg.layered.options.NodePromotionStrategy;
import org.eclipse.elk.alg.layered.options.PortSortingStrategy;
import org.eclipse.elk.alg.layered.options.ConstraintCalculationStrategy;
import org.eclipse.elk.alg.layered.options.GraphCompactionStrategy;
import org.eclipse.elk.alg.layered.options.SplineRoutingMode;
import org.eclipse.elk.alg.layered.options.ValidifyStrategy;
import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import org.eclipse.elk.alg.layered.options.LayerConstraint;
import org.eclipse.elk.alg.layered.options.SelfLoopDistributionStrategy;
import org.eclipse.elk.alg.layered.options.SelfLoopOrderingStrategy;
import org.eclipse.elk.alg.layered.options.LayeredOptions;
import org.eclipse.elk.core.data.LayoutMetaDataService;
import org.eclipse.elk.alg.layered.options.LayeredMetaDataProvider;
import org.eclipse.elk.graph.ElkNode;
import org.eclipse.elk.core.util.IElkProgressMonitor;
import de.itemis.mps.editor.diagram.runtime.model.IAccessorKey;
import org.eclipse.elk.graph.ElkPort;
import org.eclipse.elk.graph.ElkEdge;
import org.eclipse.elk.graph.ElkLabel;
import de.itemis.mps.editor.diagram.runtime.model.EdgeLabelType;
import jetbrains.mps.openapi.editor.style.Style;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import de.itemis.mps.editor.diagram.behavior.NonStandardLayeredDefaultValue;

public class LayeredLayouter extends ElkLayouterWithTopDownPackingSupport {
  protected Direction subDirection = Direction.UNDEFINED;

  protected ElkMargin additionalPortSpace;
  protected boolean addUnnecessaryBendpoints;
  protected double additionalWrappedEdgesSpacing;
  protected Double aspectRatio;
  protected EdgeStraighteningStrategy bkEdgeStraightening;
  protected FixedAlignment bkFixedAlignment;
  protected double commentCommentSpacing;
  protected double commentNodeSpacing;
  protected double componentsSpacing;
  protected boolean connectedComponentsCompaction;
  protected OrderingStrategy considerModelOrderStrategy;
  protected ComponentOrderingStrategy considerModelOrderForComponents;
  protected boolean considerPortOrder;
  protected EnumSet<ContentAlignment> contentAlignment;
  protected double correctionFactorForWrapping;
  protected double crossingCounterNodeInfluence;
  protected double crossingCounterPortInfluence;
  protected CrossingMinimizationStrategy crossingMinimizationStrategy;
  protected CuttingStrategy cuttingStrategy;
  protected CycleBreakingStrategy cycleBreakingStrategy;
  protected DirectionCongruency directionCongruence;
  protected double multiEdgeDistancePenalty;
  protected CenterEdgeLabelPlacementStrategy edgeCenterLabelPlacementStrategy;
  protected double edgeEdgeBetweenLayersSpacing;
  protected EdgeLabelSideSelection edgeLabelSideSelection;
  protected double edgeLabelSpacing;
  protected double edgeNodeBetweenLayersSpacing;
  protected double edgeNodeSpacing;
  protected double edgeSpacing;
  protected double edgeThickness;
  protected Boolean favorStraightEdgesOverBalancing;
  protected boolean feedbackEdges;
  protected boolean fixedGraphSize;
  protected boolean forceNodeModelOrder;
  protected boolean generatePositionAndLayerIDs;
  protected WrappingStrategy graphWrappingStrategy;
  protected int greedySwitchActivationThreshold;
  protected GreedySwitchType greedySwitchCrossingminimization;
  protected GreedySwitchType greedySwitchCrossingminimizationHierarchical;
  protected double hierarchicalSweepiness;
  protected int highDegreeNodeMaximumTreeHeight;
  protected int highDegreeNodeThreshold;
  protected boolean highDegreeNodeTreatment;
  protected double horizontalSpacingBetweenLabelAndPort;
  protected boolean improveCuts;
  protected boolean improveWrappedEdges;
  protected InteractiveReferencePoint interactiveReferencePoint;
  protected double labelNodeSpacing;
  protected double labelSpacing;
  protected int layerBound;
  protected Integer layoutPartition;
  protected boolean activateLayoutPartitioning;
  protected double linearSegmentDeflectionDampening;
  protected LongEdgeOrderingStrategy longEdgeOrderingStrategy;
  protected List<Integer> manuallySpecifiedCuts;
  protected int maxNodePromotionIterations;
  protected boolean mergeEdges;
  protected boolean mergeHierarchyCrossingEdges;
  protected int msdFreedom;
  protected NodeFlexibility nodeFlexibilityDefault;
  protected ElkPadding nodeLabelPadding;
  protected LayeringStrategy nodeLayeringStrategy;
  protected double nodeNodeBetweenLayersSpacing;
  protected NodePlacementStrategy nodePlacementStrategy;
  protected NodePromotionStrategy nodePromotionStrategy;
  protected double nodeSelfLoopSpacing;
  protected double nodeSpacing;
  protected PortSortingStrategy portSortingStrategy;
  protected double portSpacing;
  protected ConstraintCalculationStrategy postCompactionConstraintCalculation;
  protected GraphCompactionStrategy postCompactionStrategy;
  protected int randomizationSeed;
  protected boolean semiInteractiveCrossingMinimization;
  protected Boolean separateConnectedComponents;
  protected double slopedEdgeZoneWidth;
  protected double sloppySplineLayerSpacingFactor;
  protected double spacingBaseValue;
  protected SplineRoutingMode splineRoutingMode;
  protected int thoroughness;
  protected double topdownScaleFactor;
  protected int upperBoundOnWidthMinWidthLayerer;
  protected int upperLayerEstimationScalingFactorMinWidthLayerer;
  protected List<Integer> validIndicesForWrapping;
  protected ValidifyStrategy validificationStrategy;
  protected double verticalSpacingBetweenLabelAndPort;

  protected Map<Object, String> myInLayerPredecessorOf = MapSequence.fromMap(new HashMap<Object, String>());
  protected Map<Object, String> myInLayerSuccessorOf = MapSequence.fromMap(new HashMap<Object, String>());
  protected Map<Object, Integer> myLayerChoiceConstraints = MapSequence.fromMap(new HashMap<Object, Integer>());
  protected Map<Object, LayerConstraint> myLayerConstraints = MapSequence.fromMap(new HashMap<Object, LayerConstraint>());
  protected Map<Object, Boolean> myNoModelOrders = MapSequence.fromMap(new HashMap<Object, Boolean>());
  protected Map<Object, NodeFlexibility> myNodeFlexibility = MapSequence.fromMap(new HashMap<Object, NodeFlexibility>());
  protected Map<Object, Integer> myPositionChoiceConstraints = MapSequence.fromMap(new HashMap<Object, Integer>());

  protected Map<Object, Boolean> myAllowNonFlowPortsToSwitchSides = MapSequence.fromMap(new HashMap<Object, Boolean>());

  protected Map<Object, Integer> myDirectionPriorities = MapSequence.fromMap(new HashMap<Object, Integer>());
  protected Map<Object, Integer> myShortnessPriorities = MapSequence.fromMap(new HashMap<Object, Integer>());
  protected Map<Object, Integer> myStraightnessPriorities = MapSequence.fromMap(new HashMap<Object, Integer>());
  protected Map<Object, SelfLoopDistributionStrategy> mySelfLoopDistributions = MapSequence.fromMap(new HashMap<Object, SelfLoopDistributionStrategy>());
  protected Map<Object, SelfLoopOrderingStrategy> mySelfLoopOrderings = MapSequence.fromMap(new HashMap<Object, SelfLoopOrderingStrategy>());

  protected Map<Object, CenterEdgeLabelPlacementStrategy> myEdgeCenterLabelPlacementStrategies = MapSequence.fromMap(new HashMap<Object, CenterEdgeLabelPlacementStrategy>());

  public LayeredLayouter(Direction direction) {
    super(direction);
    myAlgorithm = LayeredOptions.ALGORITHM_ID;
  }
  public LayeredLayouter() {
  }

  static {
    LayoutMetaDataService.getInstance().registerLayoutMetaDataProviders(new LayeredMetaDataProvider());
  }

  @Override
  protected void addLayoutInformationToGraph(ElkNode graph, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToGraph(graph, progressMonitor);
    ElkNode layout = graph;
    if (additionalPortSpace != null) {
      layout.setProperty(LayeredOptions.SPACING_PORTS_SURROUNDING, additionalPortSpace);
    }
    layout.setProperty(LayeredOptions.UNNECESSARY_BENDPOINTS, addUnnecessaryBendpoints);
    layout.setProperty(LayeredOptions.WRAPPING_ADDITIONAL_EDGE_SPACING, additionalWrappedEdgesSpacing);
    if (aspectRatio != null) {
      layout.setProperty(LayeredOptions.ASPECT_RATIO, aspectRatio);
    }
    layout.setProperty(LayeredOptions.NODE_PLACEMENT_BK_EDGE_STRAIGHTENING, bkEdgeStraightening);
    layout.setProperty(LayeredOptions.NODE_PLACEMENT_BK_FIXED_ALIGNMENT, bkFixedAlignment);
    layout.setProperty(LayeredOptions.SPACING_COMMENT_COMMENT, commentCommentSpacing);
    layout.setProperty(LayeredOptions.SPACING_COMPONENT_COMPONENT, componentsSpacing);
    layout.setProperty(LayeredOptions.COMPACTION_CONNECTED_COMPONENTS, connectedComponentsCompaction);
    layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_STRATEGY, considerModelOrderStrategy);
    layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_COMPONENTS, considerModelOrderForComponents);
    layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_PORT_MODEL_ORDER, considerPortOrder);
    layout.setProperty(LayeredOptions.CONTENT_ALIGNMENT, contentAlignment);
    layout.setProperty(LayeredOptions.WRAPPING_CORRECTION_FACTOR, correctionFactorForWrapping);
    layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_CROSSING_COUNTER_NODE_INFLUENCE, crossingCounterNodeInfluence);
    layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_CROSSING_COUNTER_PORT_INFLUENCE, crossingCounterPortInfluence);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_STRATEGY, crossingMinimizationStrategy);
    layout.setProperty(LayeredOptions.WRAPPING_CUTTING_STRATEGY, cuttingStrategy);
    layout.setProperty(LayeredOptions.CYCLE_BREAKING_STRATEGY, cycleBreakingStrategy);
    layout.setProperty(LayeredOptions.DIRECTION, myDirection);
    layout.setProperty(LayeredOptions.DIRECTION_CONGRUENCY, directionCongruence);
    layout.setProperty(LayeredOptions.WRAPPING_CUTTING_CUTS, manuallySpecifiedCuts);
    layout.setProperty(LayeredOptions.WRAPPING_MULTI_EDGE_DISTANCE_PENALTY, multiEdgeDistancePenalty);
    layout.setProperty(LayeredOptions.EDGE_LABELS_CENTER_LABEL_PLACEMENT_STRATEGY, edgeCenterLabelPlacementStrategy);
    layout.setProperty(LayeredOptions.SPACING_EDGE_EDGE_BETWEEN_LAYERS, edgeEdgeBetweenLayersSpacing);
    layout.setProperty(LayeredOptions.EDGE_LABELS_SIDE_SELECTION, edgeLabelSideSelection);
    layout.setProperty(LayeredOptions.SPACING_EDGE_LABEL, edgeLabelSpacing);
    layout.setProperty(LayeredOptions.SPACING_EDGE_NODE_BETWEEN_LAYERS, edgeNodeBetweenLayersSpacing);
    layout.setProperty(LayeredOptions.SPACING_EDGE_NODE, edgeNodeSpacing);
    layout.setProperty(LayeredOptions.SPACING_EDGE_EDGE, edgeSpacing);
    layout.setProperty(LayeredOptions.EDGE_THICKNESS, edgeThickness);
    if (favorStraightEdgesOverBalancing != null) {
      layout.setProperty(LayeredOptions.NODE_PLACEMENT_FAVOR_STRAIGHT_EDGES, favorStraightEdgesOverBalancing);
    }
    layout.setProperty(LayeredOptions.FEEDBACK_EDGES, feedbackEdges);
    layout.setProperty(LayeredOptions.NODE_SIZE_FIXED_GRAPH_SIZE, fixedGraphSize);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_FORCE_NODE_MODEL_ORDER, forceNodeModelOrder);
    layout.setProperty(LayeredOptions.GENERATE_POSITION_AND_LAYER_IDS, generatePositionAndLayerIDs);
    layout.setProperty(LayeredOptions.WRAPPING_STRATEGY, graphWrappingStrategy);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_GREEDY_SWITCH_ACTIVATION_THRESHOLD, greedySwitchActivationThreshold);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_GREEDY_SWITCH_TYPE, greedySwitchCrossingminimization);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_GREEDY_SWITCH_HIERARCHICAL_TYPE, greedySwitchCrossingminimizationHierarchical);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_HIERARCHICAL_SWEEPINESS, hierarchicalSweepiness);
    layout.setProperty(LayeredOptions.HIGH_DEGREE_NODES_TREE_HEIGHT, highDegreeNodeMaximumTreeHeight);
    layout.setProperty(LayeredOptions.HIGH_DEGREE_NODES_THRESHOLD, highDegreeNodeThreshold);
    layout.setProperty(LayeredOptions.HIGH_DEGREE_NODES_TREATMENT, highDegreeNodeTreatment);
    layout.setProperty(LayeredOptions.SPACING_LABEL_PORT_HORIZONTAL, horizontalSpacingBetweenLabelAndPort);
    layout.setProperty(LayeredOptions.WRAPPING_MULTI_EDGE_IMPROVE_CUTS, improveCuts);
    layout.setProperty(LayeredOptions.WRAPPING_MULTI_EDGE_IMPROVE_WRAPPED_EDGES, improveWrappedEdges);
    layout.setProperty(LayeredOptions.INTERACTIVE_REFERENCE_POINT, interactiveReferencePoint);
    layout.setProperty(LayeredOptions.SPACING_LABEL_NODE, labelNodeSpacing);
    layout.setProperty(LayeredOptions.SPACING_LABEL_LABEL, labelSpacing);
    layout.setProperty(LayeredOptions.LAYERING_COFFMAN_GRAHAM_LAYER_BOUND, layerBound);
    if (layoutPartition != null) {
      layout.setProperty(LayeredOptions.PARTITIONING_PARTITION, layoutPartition);
    }
    layout.setProperty(LayeredOptions.PARTITIONING_ACTIVATE, activateLayoutPartitioning);
    layout.setProperty(LayeredOptions.NODE_PLACEMENT_LINEAR_SEGMENTS_DEFLECTION_DAMPENING, linearSegmentDeflectionDampening);
    layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_LONG_EDGE_STRATEGY, longEdgeOrderingStrategy);
    layout.setProperty(LayeredOptions.LAYERING_NODE_PROMOTION_MAX_ITERATIONS, maxNodePromotionIterations);
    layout.setProperty(LayeredOptions.MERGE_EDGES, mergeEdges);
    layout.setProperty(LayeredOptions.MERGE_HIERARCHY_EDGES, mergeHierarchyCrossingEdges);
    layout.setProperty(LayeredOptions.WRAPPING_CUTTING_MSD_FREEDOM, msdFreedom);
    layout.setProperty(LayeredOptions.NODE_PLACEMENT_NETWORK_SIMPLEX_NODE_FLEXIBILITY_DEFAULT, nodeFlexibilityDefault);
    layout.setProperty(LayeredOptions.NODE_LABELS_PADDING, nodeLabelPadding);
    layout.setProperty(LayeredOptions.LAYERING_STRATEGY, nodeLayeringStrategy);
    layout.setProperty(LayeredOptions.SPACING_NODE_NODE_BETWEEN_LAYERS, nodeNodeBetweenLayersSpacing);
    layout.setProperty(LayeredOptions.NODE_PLACEMENT_STRATEGY, nodePlacementStrategy);
    layout.setProperty(LayeredOptions.LAYERING_NODE_PROMOTION_STRATEGY, nodePromotionStrategy);
    layout.setProperty(LayeredOptions.SPACING_NODE_SELF_LOOP, nodeSelfLoopSpacing);
    layout.setProperty(LayeredOptions.SPACING_NODE_NODE, nodeSpacing);
    layout.setProperty(LayeredOptions.PORT_SORTING_STRATEGY, portSortingStrategy);
    layout.setProperty(LayeredOptions.SPACING_PORT_PORT, portSpacing);
    layout.setProperty(LayeredOptions.COMPACTION_POST_COMPACTION_CONSTRAINTS, postCompactionConstraintCalculation);
    layout.setProperty(LayeredOptions.COMPACTION_POST_COMPACTION_STRATEGY, postCompactionStrategy);
    layout.setProperty(LayeredOptions.RANDOM_SEED, randomizationSeed);
    layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_SEMI_INTERACTIVE, semiInteractiveCrossingMinimization);
    if (separateConnectedComponents != null) {
      layout.setProperty(LayeredOptions.SEPARATE_CONNECTED_COMPONENTS, separateConnectedComponents);
    }
    layout.setProperty(LayeredOptions.EDGE_ROUTING_POLYLINE_SLOPED_EDGE_ZONE_WIDTH, slopedEdgeZoneWidth);
    layout.setProperty(LayeredOptions.EDGE_ROUTING_SPLINES_SLOPPY_LAYER_SPACING_FACTOR, sloppySplineLayerSpacingFactor);
    layout.setProperty(LayeredOptions.SPACING_BASE_VALUE, spacingBaseValue);
    layout.setProperty(LayeredOptions.EDGE_ROUTING_SPLINES_MODE, splineRoutingMode);
    layout.setProperty(LayeredOptions.THOROUGHNESS, thoroughness);
    layout.setProperty(LayeredOptions.TOPDOWN_SCALE_FACTOR, topdownScaleFactor);
    layout.setProperty(LayeredOptions.LAYERING_MIN_WIDTH_UPPER_BOUND_ON_WIDTH, upperBoundOnWidthMinWidthLayerer);
    layout.setProperty(LayeredOptions.LAYERING_MIN_WIDTH_UPPER_LAYER_ESTIMATION_SCALING_FACTOR, upperLayerEstimationScalingFactorMinWidthLayerer);
    layout.setProperty(LayeredOptions.WRAPPING_VALIDIFY_STRATEGY, validificationStrategy);
    layout.setProperty(LayeredOptions.WRAPPING_VALIDIFY_FORBIDDEN_INDICES, validIndicesForWrapping);
    layout.setProperty(LayeredOptions.SPACING_LABEL_PORT_VERTICAL, verticalSpacingBetweenLabelAndPort);

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(layout, "graph", progressMonitor);
    }
  }


  @Override
  protected void addLayoutInformationToNode(ElkNode knode, BoxDCell box, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToNode(knode, box, progressMonitor);
    IAccessorKey ID = box.getBox().getAccessor().getId();
    ElkNode layout = knode;

    String inLayerPredecessor = MapSequence.fromMap(myInLayerPredecessorOf).get(ID);
    if (inLayerPredecessor != null) {
      layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_IN_LAYER_PRED_OF, inLayerPredecessor);
    }

    String inLayerSuccessor = MapSequence.fromMap(myInLayerSuccessorOf).get(ID);
    if (inLayerSuccessor != null) {
      layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_IN_LAYER_SUCC_OF, inLayerSuccessor);
    }

    Integer layerChoiceConstraint = MapSequence.fromMap(myLayerChoiceConstraints).get(ID);
    if (layerChoiceConstraint != null) {
      layout.setProperty(LayeredOptions.LAYERING_LAYER_CHOICE_CONSTRAINT, layerChoiceConstraint);
    }

    LayerConstraint layerConstraint = MapSequence.fromMap(myLayerConstraints).get(ID);
    if (layerConstraint != null) {
      layout.setProperty(LayeredOptions.LAYERING_LAYER_CONSTRAINT, layerConstraint);
    }

    Boolean noModelOrder = MapSequence.fromMap(myNoModelOrders).get(ID);
    if (noModelOrder != null) {
      layout.setProperty(LayeredOptions.CONSIDER_MODEL_ORDER_NO_MODEL_ORDER, noModelOrder);
    }

    NodeFlexibility nodeFlexibility = MapSequence.fromMap(myNodeFlexibility).get(ID);
    if (nodeFlexibility != null) {
      layout.setProperty(LayeredOptions.NODE_PLACEMENT_NETWORK_SIMPLEX_NODE_FLEXIBILITY, nodeFlexibility);
    }

    Integer positionChoiceConstraint = MapSequence.fromMap(myPositionChoiceConstraints).get(ID);
    if (positionChoiceConstraint != null) {
      layout.setProperty(LayeredOptions.CROSSING_MINIMIZATION_POSITION_CHOICE_CONSTRAINT, positionChoiceConstraint);
    }

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(layout, "node", progressMonitor);
    }
  }

  @Override
  protected void addLayoutInformationToPort(ElkNode knode, ElkPort kport, BoxDCell node, PortDCell port, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToPort(knode, kport, node, port, progressMonitor);
    IAccessorKey ID = node.getBox().getAccessor().getId();
    Boolean allowSwitchSides = MapSequence.fromMap(myAllowNonFlowPortsToSwitchSides).get(ID);
    if (allowSwitchSides != null) {
      kport.setProperty(LayeredOptions.ALLOW_NON_FLOW_PORTS_TO_SWITCH_SIDES, allowSwitchSides);
    }

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(kport, "port", progressMonitor);
    }
  }

  @Override
  protected void addLayoutInformationToEdge(ElkEdge kedge, EdgeDCell edge, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToEdge(kedge, edge, progressMonitor);
    IAccessorKey ID = edge.getEdge().getAccessor().getId();

    Integer directionPriority = MapSequence.fromMap(myDirectionPriorities).get(ID);
    if (directionPriority != null) {
      kedge.setProperty(LayeredOptions.PRIORITY_DIRECTION, directionPriority);
    }

    Integer shortnessPriority = MapSequence.fromMap(myShortnessPriorities).get(ID);
    if (shortnessPriority != null) {
      kedge.setProperty(LayeredOptions.PRIORITY_SHORTNESS, shortnessPriority);
    }

    Integer straightnessPriority = MapSequence.fromMap(myStraightnessPriorities).get(ID);
    if (straightnessPriority != null) {
      kedge.setProperty(LayeredOptions.PRIORITY_STRAIGHTNESS, straightnessPriority);
    }

    SelfLoopDistributionStrategy selfLoopDistribution = MapSequence.fromMap(mySelfLoopDistributions).get(ID);
    if (selfLoopDistribution != null) {
      kedge.setProperty(LayeredOptions.EDGE_ROUTING_SELF_LOOP_DISTRIBUTION, selfLoopDistribution);
    }

    SelfLoopOrderingStrategy selfLoopOrderingStrategy = MapSequence.fromMap(mySelfLoopOrderings).get(ID);
    if (selfLoopOrderingStrategy != null) {
      kedge.setProperty(LayeredOptions.EDGE_ROUTING_SELF_LOOP_ORDERING, selfLoopOrderingStrategy);
    }

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(kedge, "edge", progressMonitor);
    }
  }

  @Override
  protected void addLayoutInformationToEdgeLabel(ElkEdge kedge, ElkLabel klabel, EdgeDCell edge, EdgeLabelType type, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToEdgeLabel(kedge, klabel, edge, type, progressMonitor);
    IAccessorKey ID = edge.getEdge().getAccessor().getId();
    CenterEdgeLabelPlacementStrategy placementStrategy = MapSequence.fromMap(myEdgeCenterLabelPlacementStrategies).get(ID);
    if (placementStrategy != null) {
      kedge.setProperty(LayeredOptions.EDGE_LABELS_CENTER_LABEL_PLACEMENT_STRATEGY, placementStrategy);
    }

    if (LOG.isDebugEnabled()) {
      JGraphUtil.dumpOptions(kedge, "edge label", progressMonitor);
    }
  }

  @Override
  public void addNodesStyle(Style style, Object key) {
    super.addNodesStyle(style, key);

    MapSequence.fromMap(myInLayerPredecessorOf).put(key, style.get(StyleAttributes.getInstance().<String>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-in-layer-predecessor-of")));
    MapSequence.fromMap(myInLayerSuccessorOf).put(key, style.get(StyleAttributes.getInstance().<String>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-in-layer-sucessor-of")));
    MapSequence.fromMap(myLayerChoiceConstraints).put(key, style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layer-choice-constraint")));
    MapSequence.fromMap(myLayerConstraints).put(key, style.get(StyleAttributes.getInstance().<LayerConstraint>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-layer-constraint")));
    MapSequence.fromMap(myNoModelOrders).put(key, style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-no-model-order")));
    MapSequence.fromMap(myNodeFlexibility).put(key, style.get(StyleAttributes.getInstance().<NodeFlexibility>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-flexibility")));
    MapSequence.fromMap(myPositionChoiceConstraints).put(key, style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-position-choice-constraint")));
  }

  @Override
  public void addEdgesStyle(Style style, Object key) {
    super.addEdgesStyle(style, key);
    MapSequence.fromMap(myDirectionPriorities).put(key, style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-direction-priority")));
    MapSequence.fromMap(myShortnessPriorities).put(key, style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-shortness-priority")));
    MapSequence.fromMap(myStraightnessPriorities).put(key, style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-straightness-priority")));
    MapSequence.fromMap(mySelfLoopDistributions).put(key, style.get(StyleAttributes.getInstance().<SelfLoopDistributionStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-self-loop-distribution")));
    MapSequence.fromMap(mySelfLoopOrderings).put(key, style.get(StyleAttributes.getInstance().<SelfLoopOrderingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-self-loop-ordering")));
  }

  @Override
  public void addLabelsStyle(Style style, Object key) {
    super.addLabelsStyle(style, key);
    MapSequence.fromMap(myEdgeCenterLabelPlacementStrategies).put(key, style.get(StyleAttributes.getInstance().<CenterEdgeLabelPlacementStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-center-label-placement-strategy")));
  }


  @Override
  public void addPortsStyle(Style style, Object key) {
    super.addPortsStyle(style, key);
    MapSequence.fromMap(myAllowNonFlowPortsToSwitchSides).put(key, style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-allow-non-flow-ports-to-switch-sides")));
  }

  @Override
  public void setParentsStyle(Style style) {
    super.setParentsStyle(style);
    subDirection = style.get(StyleAttributes.getInstance().<Direction>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-subdiagram-direction"));

    if (style.isSpecified(StyleAttributes.getInstance().<ElkMargin>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-additional-port-space"))) {
      this.additionalPortSpace = style.get(StyleAttributes.getInstance().<ElkMargin>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-additional-port-space"));
    }
    this.addUnnecessaryBendpoints = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-unnecessary-bend-points"));
    this.additionalWrappedEdgesSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-additional-wrapped-edges-spacing"));
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-aspect-ratio"))) {
      this.aspectRatio = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-aspect-ratio"));
    }
    this.bkEdgeStraightening = style.get(StyleAttributes.getInstance().<EdgeStraighteningStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-brandes-koepf-edge-straightening"));
    this.bkFixedAlignment = style.get(StyleAttributes.getInstance().<FixedAlignment>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-brandes-koepf-fixed-alignment"));
    this.commentCommentSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-comment-comment-spacing"));
    this.commentNodeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-comment-node-spacing"));
    this.componentsSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-components-spacing"));
    this.connectedComponentsCompaction = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-connected-component-compaction"));
    this.considerModelOrderStrategy = style.get(StyleAttributes.getInstance().<OrderingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-consider-model-order"));
    this.considerModelOrderForComponents = style.get(StyleAttributes.getInstance().<ComponentOrderingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-consider-model-order-for-components"));
    this.considerPortOrder = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-consider-port-order"));
    this.contentAlignment = style.get(StyleAttributes.getInstance().<EnumSet<ContentAlignment>>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-content-alignment"));
    this.correctionFactorForWrapping = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-correction-factor-for-wrapping"));
    this.crossingCounterNodeInfluence = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-crossing-counter-node-order-influence"));
    this.crossingCounterPortInfluence = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-crossing-counter-port-order-influence"));
    this.crossingMinimizationStrategy = style.get(StyleAttributes.getInstance().<CrossingMinimizationStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-crossing-minimization-strategy"));
    this.cuttingStrategy = style.get(StyleAttributes.getInstance().<CuttingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-cutting-strategy"));
    if (style.isSpecified(StyleAttributes.getInstance().<CycleBreakingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-cycle-breaking-strategy"))) {
      this.cycleBreakingStrategy = style.get(StyleAttributes.getInstance().<CycleBreakingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-cycle-breaking-strategy"));
    } else {
      this.cycleBreakingStrategy = style.get(StyleAttributes.getInstance().<CycleBreakingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-cycle-breaking-strategy"));
    }

    if (style.isSpecified(StyleAttributes.getInstance().<Direction>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-direction"))) {
      this.myDirection = style.get(StyleAttributes.getInstance().<Direction>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-direction"));
    } else if (myDirection == null) {
      this.myDirection = Direction.UNDEFINED;
    }
    this.directionCongruence = style.get(StyleAttributes.getInstance().<DirectionCongruency>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-direction-congruence"));
    this.multiEdgeDistancePenalty = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-multi-edge-distance-penalty"));
    this.edgeCenterLabelPlacementStrategy = style.get(StyleAttributes.getInstance().<CenterEdgeLabelPlacementStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-center-label-placement-strategy"));
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-edge-between-layers-spacing"))) {
      this.edgeEdgeBetweenLayersSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-edge-between-layers-spacing"));
    } else {
      this.edgeEdgeBetweenLayersSpacing = NonStandardLayeredDefaultValue.getEdgeEdgeBetweenLayersSpacing();
    }
    this.edgeLabelSideSelection = style.get(StyleAttributes.getInstance().<EdgeLabelSideSelection>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-label-side-selection"));
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-label-spacing"))) {
      this.edgeLabelSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-label-spacing"));
    } else {
      this.edgeLabelSpacing = NonStandardLayeredDefaultValue.getEdgeLabelSpacing();
    }
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-node-between-layers-spacing"))) {
      this.edgeNodeBetweenLayersSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-edge-node-between-layers-spacing"));
    } else {
      this.edgeNodeBetweenLayersSpacing = NonStandardLayeredDefaultValue.getEdgeNodeBetweenLayersSpacing();
    }
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-node-spacing"))) {
      this.edgeNodeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-node-spacing"));
    } else {
      this.edgeNodeSpacing = NonStandardLayeredDefaultValue.getEdgeNodeSpacing();
    }
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-spacing"))) {
      this.edgeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-spacing"));
    } else {
      this.edgeSpacing = NonStandardLayeredDefaultValue.getEdgeEdgeSpacing();
    }
    this.edgeThickness = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-edge-thickness"));
    if (style.isSpecified(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-favor-straight-edges-over-balancing"))) {
      this.favorStraightEdgesOverBalancing = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-favor-straight-edges-over-balancing"));
    }
    this.feedbackEdges = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-feedback-edges"));
    this.fixedGraphSize = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-fixed-graph-size"));
    this.forceNodeModelOrder = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-force-node-model-order"));
    this.generatePositionAndLayerIDs = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-generate-position-and-layer-ids"));
    this.graphWrappingStrategy = style.get(StyleAttributes.getInstance().<WrappingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-graph-wrapping-strategy"));
    this.greedySwitchActivationThreshold = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-greedy-switch-activation-threshold"));
    this.greedySwitchCrossingminimization = style.get(StyleAttributes.getInstance().<GreedySwitchType>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-greedy-switch-crossing-minimization"));
    this.greedySwitchCrossingminimizationHierarchical = style.get(StyleAttributes.getInstance().<GreedySwitchType>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-greedy-switch-crossing-minimization-hierarchical"));
    this.hierarchicalSweepiness = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-hierarchical-sweepiness"));
    this.highDegreeNodeMaximumTreeHeight = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-high-degree-node-maximum-tree-height"));
    this.highDegreeNodeThreshold = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-high-degree-node-threshold"));
    this.highDegreeNodeTreatment = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-high-degree-node-treatment"));
    this.horizontalSpacingBetweenLabelAndPort = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-horizontal-spacing-between-label-and-port"));
    this.improveCuts = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-improve-cuts"));
    this.improveWrappedEdges = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-improve-wrapped-edges"));
    this.interactiveReferencePoint = style.get(StyleAttributes.getInstance().<InteractiveReferencePoint>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-interactive-reference-point"));
    this.labelNodeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-label-node-spacing"));
    this.labelSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-label-spacing"));
    this.layerBound = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-layer-bound"));
    if (style.isSpecified(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layout-partition"))) {
      this.layoutPartition = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layout-partition"));
    }
    this.activateLayoutPartitioning = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-partition-activate"));
    this.linearSegmentDeflectionDampening = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-linear-segments-deflection-dampening"));
    this.longEdgeOrderingStrategy = style.get(StyleAttributes.getInstance().<LongEdgeOrderingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-long-edge-ordering-strategy"));
    this.maxNodePromotionIterations = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-max-node-promotion-iterations"));
    this.mergeEdges = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-merge-edges"));
    this.mergeHierarchyCrossingEdges = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-merge-hierarchy-crossing-edges"));
    this.msdFreedom = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-msd-freedom"));
    this.nodeFlexibilityDefault = style.get(StyleAttributes.getInstance().<NodeFlexibility>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-flexibility-default"));
    this.nodeLabelPadding = style.get(StyleAttributes.getInstance().<ElkPadding>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-node-label-padding"));
    this.nodeLayeringStrategy = style.get(StyleAttributes.getInstance().<LayeringStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-layering-strategy"));
    this.nodeNodeBetweenLayersSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-node-between-layers-spacing"));
    this.nodePlacementStrategy = style.get(StyleAttributes.getInstance().<NodePlacementStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-placement-strategy"));
    this.nodePromotionStrategy = style.get(StyleAttributes.getInstance().<NodePromotionStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-node-promotion-strategy"));
    this.nodeSelfLoopSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-self-loop-spacing"));
    this.nodeSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-node-spacing"));
    this.portSortingStrategy = style.get(StyleAttributes.getInstance().<PortSortingStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-port-sorting-strategy"));
    if (style.isSpecified(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-port-spacing"))) {
      this.portSpacing = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-port-spacing"));
    } else {
      this.portSpacing = NonStandardLayeredDefaultValue.getPortPortSpacing();
    }
    this.postCompactionConstraintCalculation = style.get(StyleAttributes.getInstance().<ConstraintCalculationStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-post-compaction-constraint-calculation"));
    this.postCompactionStrategy = style.get(StyleAttributes.getInstance().<GraphCompactionStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-post-compaction-strategy"));
    this.randomizationSeed = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-randomization-seed"));
    this.semiInteractiveCrossingMinimization = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-semi-interactive-crossing-minimization"));
    if (style.isSpecified(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-separate-connected-components"))) {
      this.separateConnectedComponents = style.get(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-separate-connected-components"));
    }
    this.slopedEdgeZoneWidth = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-sloped-edge-zone-width"));
    this.sloppySplineLayerSpacingFactor = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-sloppy-spline-layer-spacing-factor"));
    this.spacingBaseValue = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-spacing-base-value"));
    this.splineRoutingMode = style.get(StyleAttributes.getInstance().<SplineRoutingMode>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-spline-routing-mode"));
    this.thoroughness = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-thoroughness"));
    this.topdownScaleFactor = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-topdown-scale-factor"));
    this.upperBoundOnWidthMinWidthLayerer = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-upper-bound-on-width"));
    this.upperLayerEstimationScalingFactorMinWidthLayerer = style.get(StyleAttributes.getInstance().<Integer>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-upper-layer-estimation-scaling-factor"));
    this.validificationStrategy = style.get(StyleAttributes.getInstance().<ValidifyStrategy>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-layered-validification-strategy"));
    this.verticalSpacingBetweenLabelAndPort = style.get(StyleAttributes.getInstance().<Double>getAttribute("de.itemis.mps.editor.diagram", "diagram-layout-vertical-spacing-between-label-and-port"));
  }

  @Override
  protected void addLayoutInformationToSubdiagram(ElkNode knode, SubDiagramDCell dcell, IElkProgressMonitor progressMonitor) {
    super.addLayoutInformationToSubdiagram(knode, dcell, progressMonitor);
    knode.setProperty(LayeredOptions.DIRECTION, subDirection);
  }
  @Override
  public boolean canLayoutLabels() {
    return true;
  }
}
