package de.itemis.mps.editor.diagram.runtime;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.cells.SubstituteAction;
import jetbrains.mps.nodeEditor.cellMenu.CompletionActionItemAsSubstituteAction;
import jetbrains.mps.lang.editor.menus.transformation.SubstituteMenuItemAsActionItem;
import jetbrains.mps.openapi.editor.menus.transformation.CompletionActionItem;
import de.slisson.mps.reflection.runtime.ReflectionUtil;
import jetbrains.mps.lang.editor.menus.substitute.ReferenceScopeSubstituteMenuItem;
import jetbrains.mps.openapi.editor.menus.substitute.SubstituteMenuItem;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.openapi.editor.cells.CellTraversalUtil;
import jetbrains.mps.openapi.editor.cells.EditorCell_Collection;
import jetbrains.mps.openapi.editor.EditorComponent;

public class DiagramUtil {
  public static double parseDoubleSafe(String stringValue, double defaultValue) {
    if (stringValue == null) {
      return 0.0;
    }
    try {
      double result = Double.parseDouble(stringValue);
      if (Double.isInfinite(result) || Double.isNaN(result)) {
        return defaultValue;
      }
      return result;
    } catch (NumberFormatException ex) {
      return defaultValue;
    }
  }

  public static SNode getReferenceTarget(SubstituteAction action) {
    if (action instanceof CompletionActionItemAsSubstituteAction) {
      CompletionActionItemAsSubstituteAction a2 = as_xnnmp6_a0a0a0a2(action, CompletionActionItemAsSubstituteAction.class);
      if (a2 != null) {
        SubstituteMenuItemAsActionItem a3 = as_xnnmp6_a0a0a1a0a2(((CompletionActionItem) ReflectionUtil.readField(CompletionActionItemAsSubstituteAction.class, a2, "myActionItem")), SubstituteMenuItemAsActionItem.class);
        if (a3 != null) {
          ReferenceScopeSubstituteMenuItem a4 = as_xnnmp6_a0a0a1a1a0a2(((SubstituteMenuItem) ReflectionUtil.readField(SubstituteMenuItemAsActionItem.class, a3, "mySubstituteItem")), ReferenceScopeSubstituteMenuItem.class);
          if (a4 != null) {
            return ((SNode) ReflectionUtil.readField(ReferenceScopeSubstituteMenuItem.class, a4, "myReferent"));
          }
        }
      }
    }

    return null;
  }

  public static EditorCell getCellIfNotEmpty(EditorCell cell) {
    if (cell == null) {
      return null;
    }
    return (CellTraversalUtil.getFirstLeaf(cell) instanceof EditorCell_Collection ? null : cell);
  }

  public static void checkInUpdateSession(EditorComponent editorComponent) {
    if (editorComponent.getUpdater().getCurrentUpdateSession() == null) {
      throw new IllegalStateException("Not in an update session");
    }
  }
  private static <T> T as_xnnmp6_a0a0a0a2(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_xnnmp6_a0a0a1a0a2(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_xnnmp6_a0a0a1a1a0a2(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
