package de.itemis.mps.editor.celllayout.runtime.plugin;

/*Generated by MPS */

import jetbrains.mps.plugins.part.ProjectPluginPart;
import de.slisson.mps.hacks.editor.EditorComponentCreationListener;
import jetbrains.mps.openapi.editor.update.UpdaterListener;
import jetbrains.mps.openapi.editor.update.UpdaterListenerAdapter;
import jetbrains.mps.openapi.editor.EditorComponent;
import de.itemis.mps.editor.celllayout.runtime.LayoutInterceptor;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.nodeEditor.AdditionalPainter;
import de.itemis.mps.editor.celllayout.runtime.BorderPainter;
import jetbrains.mps.project.MPSProject;
import de.itemis.mps.editor.celllayout.runtime.CellLayoutUtil;

public class ProjectPlugin_ProjectPluginPart extends ProjectPluginPart {
  private EditorComponentCreationListener myEditorComponentCreationListener;
  private UpdaterListener myUpdaterListener = new UpdaterListenerAdapter() {
    public void editorUpdated(EditorComponent editorComponent) {
      LayoutInterceptor.installWhereRequired(editorComponent);
    }
    public void cellSynchronizedWithModel(EditorCell cell) {
    }
  };
  private AdditionalPainter myRootCellChangeListener = new DoNothingAdditionalPainter() {
    @Override
    public void onUpdate(jetbrains.mps.nodeEditor.EditorComponent component) {
      LayoutInterceptor.installWhereRequired(component);
    }
  };
  private BorderPainter myBorderPainter = new BorderPainter();
  public ProjectPlugin_ProjectPluginPart() {
  }
  @Override
  public void init(MPSProject project) {
    ProjectPlugin_ProjectPluginPart.this.myEditorComponentCreationListener = new EditorComponentCreationListener(project) {
      public void editorComponentCreate(jetbrains.mps.nodeEditor.EditorComponent editorComponent) {
        editorComponent.getUpdater().addListener(ProjectPlugin_ProjectPluginPart.this.myUpdaterListener);
        editorComponent.addAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myRootCellChangeListener);
        editorComponent.addAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myBorderPainter);
        boolean installedAnywhere = LayoutInterceptor.installWhereRequired(editorComponent);
        if (installedAnywhere) {
          CellLayoutUtil.invalidateAllCells(editorComponent.getRootCell());
          editorComponent.relayout();
        }
      }
      public void editorComponentDisposed(jetbrains.mps.nodeEditor.EditorComponent editorComponent) {
        editorComponent.removeAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myBorderPainter);
        editorComponent.removeAdditionalPainter(ProjectPlugin_ProjectPluginPart.this.myRootCellChangeListener);
        editorComponent.getUpdater().removeListener(ProjectPlugin_ProjectPluginPart.this.myUpdaterListener);
        LayoutInterceptor.uninstall(editorComponent);
      }
    };
    ProjectPlugin_ProjectPluginPart.this.myEditorComponentCreationListener.start(true);
  }
  @Override
  public void dispose(MPSProject project) {
    ProjectPlugin_ProjectPluginPart.this.myEditorComponentCreationListener.stop();
  }
}
