package de.itemis.mps.editor.celllayout.runtime;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.openapi.editor.cells.EditorCell_Collection;
import de.itemis.mps.editor.celllayout.layout.ILayouter;
import org.jetbrains.annotations.Nullable;

public class LayoutableAdapters {
  private static final String USER_OBJECT_KEY = "LayoutableAdapter";

  private static IEditorCellBasedLayoutable createAdapter(EditorCell cell) {
    if (cell instanceof ISupportsTopDownLayout) {
      IEditorCellBasedLayoutable layoutable = ((ISupportsTopDownLayout) cell).getTopDownLayoutable();
      if (layoutable != null) {
        return layoutable;
      }
    }
    if (cell instanceof EditorCell_Collection) {
      ILayouter layouter = LayoutableCollectionAdapter.getLayouter(((EditorCell_Collection) cell));
      if (layouter != null) {
        return new LayoutableCollectionAdapter(((EditorCell_Collection) cell), layouter);
      }
    }

    return new LayoutableAdapter(cell);
  }

  public static IEditorCellBasedLayoutable getAdapter(@Nullable EditorCell cell) {
    if (cell == null) {
      return null;
    }
    IEditorCellBasedLayoutable adapter = as_yva6p0_a0a1a4(cell.getUserObject(USER_OBJECT_KEY), IEditorCellBasedLayoutable.class);
    if (adapter instanceof LayoutableCollectionAdapter) {
      ILayouter currentLayouter = ((LayoutableCollectionAdapter) adapter).getLayouter();
      ILayouter expectedLayouter = LayoutableCollectionAdapter.getLayouter(((EditorCell_Collection) cell));
      if (expectedLayouter == null || currentLayouter.getClass() != expectedLayouter.getClass()) {
        adapter = null;
      }
    }
    if (adapter == null) {
      adapter = createAdapter(cell);
      if (adapter != null) {
        cell.putUserObject(USER_OBJECT_KEY, adapter);
      }
    }
    return adapter;
  }

  public static void clear(EditorCell cell) {
    if (cell.getUserObject(USER_OBJECT_KEY) != null) {
      cell.putUserObject(USER_OBJECT_KEY, null);
    }
  }

  public static boolean isSupportedCollection(EditorCell cell) {
    return cell instanceof EditorCell_Collection && LayoutableCollectionAdapter.getLayouter(((EditorCell_Collection) cell)) != null;
  }
  private static <T> T as_yva6p0_a0a1a4(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
