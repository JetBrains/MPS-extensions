package de.slisson.mps.tables.scripts;

/*Generated by MPS */

import jetbrains.mps.lang.script.runtime.BaseMigrationScript;
import jetbrains.mps.lang.script.runtime.AbstractMigrationRefactoring;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.List;
import java.util.ArrayList;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.mps.openapi.model.SNodeReference;
import org.jetbrains.mps.openapi.persistence.PersistenceFacade;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public final class ChildCollections_MigrationScript extends BaseMigrationScript {
  public ChildCollections_MigrationScript() {
    super("Child Collections");
    this.addRefactoring(new AbstractMigrationRefactoring() {
      @Override
      public String getName() {
        return "C";
      }
      @Override
      public String getAdditionalInfo() {
        return "C";
      }
      @Override
      public SAbstractConcept getApplicableConcept() {
        return CONCEPTS.ChildsHorizontal$Ux;
      }
      @Override
      public boolean isApplicableInstanceNode(SNode node) {
        return ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.headers$ekz_)).isNotEmpty();
      }
      @Override
      public void doUpdateInstanceNode(SNode node) {
        SNode headerCollection = SLinkOperations.setNewChild(node, LINKS.columnHeaders$Tc27, CONCEPTS.HeaderCollection$J9);
        List<SNode> headers = new ArrayList<SNode>();
        ListSequence.fromList(headers).addSequence(ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.headers$ekz_)));
        ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.headers$ekz_)).clear();
        ListSequence.fromList(SLinkOperations.getChildren(headerCollection, LINKS.childs$eDqj)).addSequence(ListSequence.fromList(headers));
      }
      @Override
      public boolean isShowAsIntention() {
        return false;
      }
    });
  }

  @Nullable
  @Override
  public SNodeReference getScriptNode() {
    return PersistenceFacade.getInstance().createNodeReference("r:dce2fe60-41fa-4ce0-82ea-e87b74e57986(de.slisson.mps.tables.scripts)/2199447184410006712");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ChildsHorizontal$Ux = MetaAdapterFactory.getConcept(0x7e450f4e1ac341efL, 0xa8514598161bdb94L, 0x13666975885ce54dL, "de.slisson.mps.tables.structure.ChildsHorizontal");
    /*package*/ static final SConcept HeaderCollection$J9 = MetaAdapterFactory.getConcept(0x7e450f4e1ac341efL, 0xa8514598161bdb94L, 0x136669758869be2fL, "de.slisson.mps.tables.structure.HeaderCollection");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink headers$ekz_ = MetaAdapterFactory.getContainmentLink(0x7e450f4e1ac341efL, 0xa8514598161bdb94L, 0x13666975885dec3dL, 0x13666975887089a6L, "headers");
    /*package*/ static final SContainmentLink columnHeaders$Tc27 = MetaAdapterFactory.getContainmentLink(0x7e450f4e1ac341efL, 0xa8514598161bdb94L, 0x13666975885dec3dL, 0x1e86018fa0cd9104L, "columnHeaders");
    /*package*/ static final SContainmentLink childs$eDqj = MetaAdapterFactory.getContainmentLink(0x7e450f4e1ac341efL, 0xa8514598161bdb94L, 0x136669758869be2fL, 0x5f66401441c7c2faL, "childs");
  }
}
