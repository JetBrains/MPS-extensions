package de.slisson.mps.tables.runtime.gridmodel;

/*Generated by MPS */

import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import java.awt.Color;
import jetbrains.mps.nodeEditor.cells.EditorCell_Constant;
import jetbrains.mps.nodeEditor.MPSFonts;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import de.slisson.mps.tables.runtime.cells.ChildsTracker;
import jetbrains.mps.nodeEditor.cells.EditorCell_Error;
import de.slisson.mps.tables.runtime.cells.RowEndCell;

public class EditorCellFactory {
  private EditorContext myContext;
  private SNode myNode;
  private Grid myContextGrid;

  public EditorCellFactory(EditorContext context, SNode node, Grid contextGrid) {
    myContext = context;
    myNode = node;
    myContextGrid = contextGrid;
  }

  public EditorCell createConstant(String text) {
    return createConstant(text, null, false, false);
  }

  public EditorCell createConstant(String text, Color color, boolean bold, boolean italic) {
    EditorCell_Constant cell = new EditorCell_Constant(myContext, myNode, text);
    setFontStyle(cell, bold, italic);
    setColor(cell, color);
    return trackCreatedCell(cell);
  }

  public EditorCell createPlaceholderConstant(String text) {
    EditorCell_Constant cell = new EditorCell_Constant(myContext, myNode, "");
    cell.setDefaultText(text);
    cell.setEditable(true);
    return trackCreatedCell(cell);
  }

  public EditorCell setFontStyle(EditorCell cell, boolean bold, boolean italic) {
    int fontStyle;
    if (bold && italic) {
      fontStyle = MPSFonts.BOLD_ITALIC;
    } else if (bold) {
      fontStyle = MPSFonts.BOLD;
    } else if (italic) {
      fontStyle = MPSFonts.ITALIC;
    } else {
      fontStyle = MPSFonts.PLAIN;
    }
    cell.getStyle().set(StyleAttributes.FONT_STYLE, fontStyle);
    return cell;
  }

  public EditorCell setColor(EditorCell cell, Color color) {
    if (color != null) {
      cell.getStyle().set(StyleAttributes.TEXT_COLOR, color);
    }
    return cell;
  }

  private <T extends EditorCell> T trackCreatedCell(T cell) {
    ChildsTracker.getInstance().registerChild(cell);
    return cell;
  }

  public EditorCell createError(String text) {
    return trackCreatedCell(new EditorCell_Error(myContext, myNode, text));
  }

  public EditorCell fromNode(SNode node) {
    if (node == null) {
      return trackCreatedCell(createPlaceholderConstant(""));
    } else {
      return trackCreatedCell(myContext.getEditorComponent().getUpdater().getCurrentUpdateSession().updateChildNodeCell(node));
    }
  }

  public RowEndCell createRowEndCell(boolean leftEnd) {
    RowEndCell cell = new RowEndCell(myContext, myNode, leftEnd);
    cell.initializeActions(myContextGrid);
    return trackCreatedCell(cell);
  }
}
