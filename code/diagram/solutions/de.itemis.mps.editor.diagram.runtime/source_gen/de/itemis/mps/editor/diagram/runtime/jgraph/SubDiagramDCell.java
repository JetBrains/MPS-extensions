package de.itemis.mps.editor.diagram.runtime.jgraph;

/*Generated by MPS */

import de.itemis.mps.editor.diagram.runtime.model.SerializableObjectHolder;
import com.mxgraph.model.mxGeometry;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import com.mxgraph.model.mxICell;
import java.util.List;
import com.mxgraph.util.mxPoint;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;
import de.itemis.mps.editor.diagram.runtime.model.DiagramModel;
import java.awt.Color;
import com.intellij.ui.ColorUtil;
import com.intellij.ui.JBColor;
import jetbrains.mps.openapi.editor.style.Style;
import java.awt.Stroke;
import de.itemis.mps.editor.diagram.styles.editor.LineStyle;
import de.itemis.mps.editor.diagram.styles.editor.StyleUtils;
import java.awt.BasicStroke;
import de.itemis.mps.editor.diagram.runtime.shape.AbstractShape;
import java.awt.geom.Rectangle2D;
import java.awt.geom.RoundRectangle2D;
import java.awt.Graphics2D;
import org.jetbrains.annotations.Nullable;
import de.itemis.mps.editor.diagram.runtime.model.IDiagramElement;

public class SubDiagramDCell extends BaseDiagramDCell implements IDiagramDCell {
  private static final int PADDING = 10;

  private SerializableObjectHolder<SubDiagramECell> myECell;

  public SubDiagramDCell(MyGraph graph) {
    super(graph);
    setShape(new ShapeAdapter(new Shape()));
    setVertex(true);
    setGeometry(new mxGeometry(0, 0, 50, 50));
    setButtonVisibility(StyleAttributes.getInstance().<Boolean>getAttribute("de.itemis.mps.editor.diagram.styles", "__layout-diagram-button"), false);
  }

  public void fitSize() {
    Tuples._2<Double, Double> preferredSize = getPreferredSize();
    CellExtensions.setSize(this, (double) preferredSize._0(), (double) preferredSize._1());
  }

  public Tuples._2<Double, Double> getPreferredSize() {
    double wmax = 0;
    double hmax = 0;
    for (int i = 0; i < getChildCount(); ++i) {
      mxICell child = getChildAt(i);
      wmax = Math.max(wmax, ExtensionMethods.toRectangle2D(CellExtensions.getBounds(child)).getMaxX() + PADDING);
      hmax = Math.max(hmax, ExtensionMethods.toRectangle2D(CellExtensions.getBounds(child)).getMaxY() + PADDING);

      List<mxPoint> points = check_1fw13d_a0e0c0i(child.getGeometry());
      if (points != null) {
        for (mxPoint point : ListSequence.fromList(points)) {
          wmax = Math.max(wmax, point.getX() + PADDING);
          hmax = Math.max(hmax, point.getY() + PADDING);
        }
      }
    }
    return MultiTuple.<Double,Double>from(wmax, hmax);
  }

  @Override
  public void setParent(mxICell cell) {
    super.setParent(cell);
  }
  @Override
  public mxICell getParent() {
    return super.getParent();
  }

  public SubDiagramECell getECell() {
    return check_1fw13d_a0a31(myECell);
  }

  public void setECell(SubDiagramECell eCell) {
    myECell = new SerializableObjectHolder<SubDiagramECell>(eCell);
  }

  public DiagramModel getDiagramModel() {
    return check_1fw13d_a0a71(getECell(), this);
  }

  protected Color getBackgroundColor() {
    SubDiagramECell ecell = getECell();
    if (ecell != null) {
      Color color = ecell.getStyle().get(StyleAttributes.getInstance().<Color>getAttribute("de.itemis.mps.editor.diagram.styles", "__shade-color"));
      if (color != null) {
        return color;
      }
    }
    return ColorUtil.withAlpha(JBColor.BLACK, 0.039);
  }

  protected Color getBorderColor() {
    SubDiagramECell ecell = getECell();
    if (ecell != null) {
      Style style = ecell.getStyle();
      if (style.isSpecified(StyleAttributes.getInstance().<Color>getAttribute("de.itemis.mps.editor.diagram.styles", "__line-color"))) {
        Color color = style.get(StyleAttributes.getInstance().<Color>getAttribute("de.itemis.mps.editor.diagram.styles", "__line-color"));
        if (color != null) {
          return color;
        }
      }
    }
    return ColorUtil.withAlpha(JBColor.BLACK, 0.039);
  }

  protected Stroke getBorderStroke() {
    SubDiagramECell ecell = getECell();
    if (ecell != null) {
      Style style = ecell.getStyle();
      Float lineWidth = style.get(StyleAttributes.getInstance().<Float>getAttribute("de.itemis.mps.editor.diagram.styles", "__line-width"));
      LineStyle lineStyle = style.get(StyleAttributes.getInstance().<LineStyle>getAttribute("de.itemis.mps.editor.diagram.styles", "__line-style"));
      return StyleUtils.createStroke(lineWidth, lineStyle);
    }
    return new BasicStroke(1.0f);
  }

  public class Shape extends AbstractShape {
    @Override
    public java.awt.Shape getShape(Rectangle2D bounds) {
      return new RoundRectangle2D.Double(bounds.getX(), bounds.getY(), bounds.getWidth(), bounds.getHeight(), 20, 20);
    }
    @Override
    public void drawShape(Graphics2D g, java.awt.Shape shape) {
      g.setColor(getBackgroundColor());
      super.drawShape(g, shape);
    }

    @Override
    public void drawShapeBorder(Graphics2D g, java.awt.Shape shape) {
      if (Palette.isActive(getECell())) {
        g.setColor(Palette.DIAGRAM_HIGHLIGHT_COLOR);
        g.setStroke(new BasicStroke(Palette.DIAGRAM_HIGHLIGHT_WIDTH));
        RoundRectangle2D.Double rr = ((RoundRectangle2D.Double) shape);
        g.draw(new RoundRectangle2D.Double(rr.getX() + 2, rr.getY() + 2, rr.getWidth() - 4, rr.getHeight() - 4, rr.getArcWidth(), rr.getArcHeight()));
      }

      g.setColor(getBorderColor());
      g.setStroke(getBorderStroke());
      super.drawShapeBorder(g, shape);
    }
  }

  @Nullable
  public IDiagramElement getDiagramElement() {
    return null;
  }
  private static List<mxPoint> check_1fw13d_a0e0c0i(mxGeometry checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getPoints();
    }
    return null;
  }
  private static SubDiagramECell check_1fw13d_a0a31(SerializableObjectHolder<SubDiagramECell> checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.get();
    }
    return null;
  }
  private static DiagramModel check_1fw13d_a0a71(SubDiagramECell checkedDotOperand, SubDiagramDCell checkedDotThisExpression) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getDiagramModel();
    }
    return null;
  }
}
